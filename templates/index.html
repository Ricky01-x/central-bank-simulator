<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè¶ ÂÖ®ÁêÉÂ§ÆË°åÊ®°Êì¨Âô®</title>
    
    <!-- Socket.IO CDN -->
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #2c3e50;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ÈÅäÊà≤‰∏ª‰ªãÈù¢‰ΩàÂ±Ä */
        .game-content {
            display: none;
        }

        .game-interface {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 20px;
            margin-top: 20px;
        }

        .side-panel, .main-panel, .controls-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            height: fit-content;
        }

        /* ÊôÇÈñìÈ°ØÁ§∫ */
        .time-display {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border-radius: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255,255,255,0.3);
            border-radius: 6px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #fff;
            border-radius: 6px;
            transition: all 0.3s ease;
            width: 0%;
        }

        /* ÂÖ®Â±ÄÁãÄÊÖã */
        .global-status {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }

        /* ‰∏ªÂãïÊäÄËÉΩÈù¢Êùø */
        .active-skill-panel {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 3px solid #3498db;
        }

        .skill-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* ÊåáÊ®ôÁ∂≤Ê†º */
        .indicators-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .indicator {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .indicator.positive {
            border-color: #27ae60;
            background: linear-gradient(135deg, #d5f4e6, #f8f9fa);
        }

        .indicator.negative {
            border-color: #e74c3c;
            background: linear-gradient(135deg, #fadbd8, #f8f9fa);
        }

        .indicator-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
        }

        .indicator-value {
            font-size: 1.4em;
            font-weight: bold;
            color: #2c3e50;
        }

        /* ÊîøÁ≠ñÂ∑•ÂÖ∑Èù¢Êùø */
        .tool-group {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #3498db;
        }

        .tool-group h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .tool-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .tool-controls label {
            min-width: 80px;
            font-weight: bold;
        }

        .tool-controls input[type="range"] {
            flex: 1;
            margin: 0 10px;
        }

        .value-display {
            min-width: 80px;
            text-align: center;
            font-weight: bold;
            color: #3498db;
            background: #f8f9fa;
            padding: 5px 10px;
            border-radius: 6px;
            border: 2px solid #3498db;
        }

        /* ÊåâÈàïÊ®£Âºè */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 5px;
            position: relative;
            overflow: hidden;
            width: 100%;
        }

        .btn-primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-skill {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
            color: white;
            font-size: 1em;
            padding: 15px 20px;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-cooldown {
            background: #95a5a6 !important;
            cursor: not-allowed !important;
            position: relative;
            overflow: hidden;
        }

        /* ÂÜ∑ÂçªÁ≥ªÁµ±Ê®£Âºè */
        .cooldown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: rgba(231, 76, 60, 0.9);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            font-weight: bold;
            transition: width 0.1s linear;
            z-index: 2;
        }

        .cooldown-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 4px;
            background: #e74c3c;
            transition: width 0.1s linear;
            z-index: 1;
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        /* ÂúãÂÆ∂ÈÅ∏ÊìáÁï´Èù¢ */
        .country-selection {
            text-align: center;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }

        .country-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .country-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }

        .country-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            border-color: #3498db;
        }

        .country-card.selected {
            border-color: #e74c3c;
            background: linear-gradient(135deg, #fff, #f8f9fa);
        }

        .country-flag-large {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .country-card h2 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .skill-preview {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: left;
        }

        .skill-preview h4 {
            color: #e74c3c;
            margin-bottom: 8px;
        }

        .btn-start {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 30px;
        }

        .btn-start:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-start:not(:disabled):hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(39, 174, 96, 0.4);
        }

        /* Á≠âÂæÖÂ§ßÂª≥ */
        .waiting-lobby {
            display: none;
            text-align: center;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }

        .players-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .player-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #3498db;
        }

        .player-card.host {
            border-left-color: #e74c3c;
            background: linear-gradient(135deg, #fff, #ffe6e6);
        }

        /* ÈÅäÊà≤Êó•Ë™å */
        .game-log {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
        }

        .log-entry {
            padding: 8px;
            margin-bottom: 5px;
            background: white;
            border-radius: 6px;
            border-left: 3px solid #3498db;
            font-size: 0.9em;
        }

        /* ÂÖ∂‰ªñÁé©ÂÆ∂ÂàóË°® */
        .other-player {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #3498db;
        }

        .player-name {
            font-weight: bold;
            margin-bottom: 8px;
        }

        .player-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 0.85em;
        }

        .stat {
            background: white;
            padding: 5px;
            border-radius: 4px;
            text-align: center;
        }

        .stat.confidential {
            background: #95a5a6 !important;
            color: white !important;
            font-style: italic;
        }

        /* Á∂ìÊøüË≠¶Â†± */
        #economicAlerts {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 300px;
            z-index: 1000;
        }

        .prosperity-notice {
            padding: 12px 16px;
            margin: 5px 0;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            animation: slideInFromRight 0.3s ease-out;
        }

        .success-notice {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        }

        .error-notice {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
        }

        @keyframes slideInFromRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Âø´Ë®äÁ≥ªÁµ±Ê®£Âºè */
        .news-alert-container {
            position: fixed !important;
            top: 20px !important;
            left: 50% !important;
            transform: translateX(-50%) !important;
            z-index: 10000 !important;
            max-width: 500px !important;
            width: 90% !important;
        }
        
        .news-alert {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: newsSlideDown 0.5s ease-out;
            position: relative;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .news-alert.global-good {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        }
        
        .news-alert.global-bad {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
        }
        
        .news-alert.country-good {
            background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%);
        }
        
        .news-alert.country-bad {
            background: linear-gradient(135deg, #F44336 0%, #E91E63 100%);
        }
        
        @keyframes newsSlideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .news-alert-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .news-alert-title {
            font-size: 18px;
            font-weight: bold;
            margin: 0;
            line-height: 1.3;
            flex: 1;
        }
        
        .news-alert-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            color: white;
            font-size: 16px;
            font-weight: bold;
            margin-left: 10px;
            transition: background 0.2s;
        }
        
        .news-alert-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .news-alert-description {
            font-size: 15px;
            line-height: 1.4;
            margin-bottom: 15px;
            opacity: 0.95;
        }
        
        .news-alert-effects {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .effect-tag {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .news-alert-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 4px;
            background: rgba(255, 255, 255, 0.5);
            transition: width 5s linear;
            width: 100%;
        }

        /* ÈüøÊáâÂºèË®≠Ë®à */
        @media (max-width: 1200px) {
            .game-interface {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            .indicators-grid {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                flex-direction: column;
            }
        }

       /* Ë©ïÂàÜÈù¢ÊùøÊ®£Âºè */
        .scoring-panel {
            position: fixed;
            top: 10%;
            right: 20px;
            width: 400px;
            max-height: 80vh;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            overflow-y: auto;
        }

        .scoring-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 2px solid #eee;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px 10px 0 0;
        }

        .standing-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .standing-item:hover {
            background-color: #e9ecef !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .ranking {
            display: flex;
            align-items: center;
            min-width: 60px;
        }

        .rank {
            font-weight: bold;
            font-size: 18px;
            margin-right: 8px;
        }

        .grade {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .grade-S { background: #ffd700; color: #000; }
        .grade-A { background: #c0c0c0; color: #000; }
        .grade-B { background: #cd7f32; color: #fff; }
        .grade-C { background: #4CAF50; color: #fff; }
        .grade-D { background: #ff9800; color: #fff; }
        .grade-F { background: #f44336; color: #fff; }

        .player-info {
            flex: 1;
            margin-left: 10px;
        }

        .player-info .flag {
            font-size: 20px;
        }
        
        .player-info .name {
            font-weight: bold;
        }
        
        .player-info .country {
            color: #6c757d;
        }

        .score {
            text-align: right;
            font-weight: bold;
            font-size: 16px;
            color: #007bff;
        }
        .score-breakdown {
            padding: 15px;
        }

        .score-section {
            margin-bottom: 15px;
        }

        .score-item {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }

        .final-results-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            min-width: 500px;
            max-width: 90vw;
        }

        .final-ranking.winner {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
            font-weight: bold;
            border-radius: 8px;
            margin-bottom: 5px;
            padding: 10px;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Á∂ìÊøüË≠¶Â†±ÂçÄÂüü -->
        <div id="economicAlerts"></div>

        <!-- ÂúãÂÆ∂ÈÅ∏ÊìáÁï´Èù¢ -->
        <div class="country-selection" id="countrySelection">
            <h1>üåç ÈÅ∏Êìá‰Ω†Ë¶ÅÊâÆÊºîÁöÑÂúãÂÆ∂</h1>
            <div class="country-cards">
                <div class="country-card" data-country="USA">
                    <div class="country-flag-large">üá∫üá∏</div>
                    <h2>ÁæéÂúã</h2>
                    <div class="country-description">
                        <p><strong>ÁâπËâ≤Ôºö</strong>ÂÖ®ÁêÉÈú∏‰∏ªÔºåÊîøÁ≠ñÂΩ±ÈüøÂÖ®‰∏ñÁïå</p>
                        <p><strong>ÂÑ™Âã¢Ôºö</strong>ÁæéÂÖÉÈú∏Ê¨äÔºåÊîøÁ≠ñÂÇ≥Â∞éÂäõÂº∑</p>
                        <p><strong>ÊåëÊà∞Ôºö</strong>ÂÖ®ÁêÉË≤¨‰ªªÈáçÂ§ßÔºåÊîøÁ≠ñÂ§±Ë™§ÂΩ±ÈüøÂª£</p>
                        <div class="skill-preview">
                            <h4>‚öîÔ∏è Â∞àÂ±¨ÊäÄËÉΩÔºöÁ∂ìÊøüÂà∂Ë£Å</h4>
                            <p>Â∞çÁõÆÊ®ôÂúãÂÆ∂ÂØ¶ÊñΩÂö¥Âé≤Âà∂Ë£ÅÔºåÈÄ†ÊàêÊåÅÁ∫å2Â≠£ÁöÑÈ°ØËëóË≤†Èù¢ÂΩ±ÈüøÔºå‰ΩÜÊúâ35%Ê©üÁéáÂèçÂô¨Ëá™Ë∫´</p>
                        </div>
                    </div>
                </div>
                
                <div class="country-card" data-country="CHN">
                    <div class="country-flag-large">üá®üá≥</div>
                    <h2>‰∏≠Âúã</h2>
                    <div class="country-description">
                        <p><strong>ÁâπËâ≤Ôºö</strong>‰∏ñÁïåÂ∑•Âª†ÔºåÈ´òÈÄüÁôºÂ±ï‰∏≠Á∂ìÊøüÈ´î</p>
                        <p><strong>ÂÑ™Âã¢Ôºö</strong>ÊîøÁ≠ñÂü∑Ë°åÂäõÂº∑ÔºåÊàêÈï∑ÊΩõÂäõÂ§ß</p>
                        <p><strong>ÊåëÊà∞Ôºö</strong>ÁµêÊßãËΩâÂûãÂ£ìÂäõÔºåÂ§ñÈÉ®‰æùË≥¥Â∫¶È´ò</p>
                        <div class="skill-preview">
                            <h4>üöÄ Â∞àÂ±¨ÊäÄËÉΩÔºö‰∫∫Â§öÂ•ΩËæ¶‰∫ã</h4>
                            <p>ÈõÜ‰∏≠ÂäõÈáèËæ¶Â§ß‰∫ãÔºåÂØ¶ÁèæÈáçÂ§ßÁßëÊäÄÁ™ÅÁ†¥ÔºåÂ§ßÂπÖÊèêÂçáGDPÊàêÈï∑ÂíåÊ∞ëÁúæ‰ø°ÂøÉÔºåÁÑ°ÊòéÈ°ØÂâØ‰ΩúÁî®</p>
                        </div>
                    </div>
                </div>
                
                <div class="country-card" data-country="JPN">
                    <div class="country-flag-large">üáØüáµ</div>
                    <h2>Êó•Êú¨</h2>
                    <div class="country-description">
                        <p><strong>ÁâπËâ≤Ôºö</strong>ÊàêÁÜüÁôºÈÅîÁ∂ìÊøüÈ´îÔºåÊäÄË°ìÂÖàÈÄ≤</p>
                        <p><strong>ÂÑ™Âã¢Ôºö</strong>Ë≤®Âπ£ÊîøÁ≠ñÁ∂ìÈ©óË±êÂØåÔºåÊäÄË°ìÈ†òÂÖà</p>
                        <p><strong>ÊåëÊà∞Ôºö</strong>‰∫∫Âè£ËÄÅÂåñÔºåÈÄöÁ∏ÆÈ¢®Èö™</p>
                        <div class="skill-preview">
                            <h4>üéØ Â∞àÂ±¨ÊäÄËÉΩÔºöÊîπÂñÑËÄÅ‰∫∫Â∞±Ê•≠ÂïèÈ°å</h4>
                            <p>ÈÄèÈÅéÊï∏‰ΩçÂåñÂüπË®ìÂíåÂΩàÊÄßÂ∑•‰ΩúÂà∂Â∫¶ÔºåÊèêÂçáÈ´òÈΩ°ÂãûÂãïÂèÉËàáÁéáÔºåËß£Ê±∫ÈÄöÁ∏ÆÂíå‰ø°ÂøÉÂïèÈ°å</p>
                        </div>
                    </div>
                </div>

                <div class="country-card" data-country="TWN">
                    <div class="country-flag-large">üáπüáº</div>
                    <h2>Âè∞ÁÅ£</h2>
                    <div class="country-description">
                        <p><strong>ÁâπËâ≤Ôºö</strong>Â∞èËÄåÁæéÁ∂ìÊøüÈ´îÔºåÈùàÊ¥ªÊáâËÆä</p>
                        <p><strong>ÂÑ™Âã¢Ôºö</strong>ÁßëÊäÄË£ΩÈÄ†Ê•≠ÁôºÈÅîÔºåÊîøÁ≠ñÂΩàÊÄßÈ´ò</p>
                        <p><strong>ÊåëÊà∞Ôºö</strong>ÊòìÂèóÂ§ñÈÉ®Ë°ùÊìäÔºåÂÖßÈúÄÂ∏ÇÂ†¥Â∞è</p>
                        <div class="skill-preview">
                            <h4>üé≤ Â∞àÂ±¨ÊäÄËÉΩÔºöÂ§æÁ∏´‰∏≠Ê±ÇÁîüÂ≠ò</h4>
                            <p>ÈÅ∏ÊìáÊê≠‰πòÊüêÂúãÁ∂ìÊøüÈ†ÜÈ¢®ËªäÔºåËã•Ë©≤ÂúãË°®ÁèæËâØÂ•ΩÂâáÁç≤ÂæóÈ°çÂ§ñÊî∂ÁõäÔºåÈ´îÁèæÂ∞èÂúãÈùàÊ¥ªÂ§ñ‰∫§</p>
                        </div>
                    </div>
                </div>

                <div class="country-card" data-country="BRA">
                    <div class="country-flag-large">üáßüá∑</div>
                    <h2>Â∑¥Ë•ø</h2>
                    <div class="country-description">
                        <p><strong>ÁâπËâ≤Ôºö</strong>Êñ∞ËààÂ∏ÇÂ†¥‰ª£Ë°®ÔºåË≥áÊ∫êË±êÂØå</p>
                        <p><strong>ÂÑ™Âã¢Ôºö</strong>Ëá™ÁÑ∂Ë≥áÊ∫êË±êÂØåÔºåÂÖßÈúÄÂ∏ÇÂ†¥ÈæêÂ§ß</p>
                        <p><strong>ÊåëÊà∞Ôºö</strong>Ë≤™ËÖêÂïèÈ°åÂö¥ÈáçÔºåÊîøÁ≠ñ‰∏çÁ©©ÂÆö</p>
                        <div class="skill-preview">
                            <h4>‚öñÔ∏è Â∞àÂ±¨ÊäÄËÉΩÔºöÂèçË≤™ËÖêË°åÂãï</h4>
                            <p>ÁôºÂãïÂ§ßË¶èÊ®°ÂèçË≤™ËÖêÈÅãÂãïÔºåÂ§ßÂπÖÊèêÂçáÊîøÂ∫úÊïàËÉΩÂíåÊ∞ëÁúæ‰ø°ÂøÉÔºåÊîπÂñÑË≤°ÊîøÁãÄÊ≥Å</p>
                        </div>
                    </div>
                </div>

                <div class="country-card" data-country="SAU">
                    <div class="country-flag-large">üá∏üá¶</div>
                    <h2>Ê≤ôÁÉèÂú∞ÈòøÊãâ‰ºØ</h2>
                    <div class="country-description">
                        <p><strong>ÁâπËâ≤Ôºö</strong>Áü≥Ê≤πÂ§ßÂúãÔºåËΩâÂûã‰∏≠Á∂ìÊøü</p>
                        <p><strong>ÂÑ™Âã¢Ôºö</strong>Áü≥Ê≤πË≥áÊ∫êÊéßÂà∂ÂäõÔºåË≤°ÊîøÂÖÖË£ï</p>
                        <p><strong>ÊåëÊà∞Ôºö</strong>ÈÅéÂ∫¶‰æùË≥¥Áü≥Ê≤πÔºåÂ§öÂÖÉÂåñÊÄ•ÈúÄ</p>
                        <div class="skill-preview">
                            <h4>üè≠ Â∞àÂ±¨ÊäÄËÉΩÔºöÁî¢Ê•≠ËΩâÂûã</h4>
                            <p>Êé®ÈÄ≤Á∂ìÊøüÂ§öÂÖÉÂåñÔºåÈÄêÊ≠•Èôç‰ΩéÁü≥Ê≤π‰æùË≥¥Â∫¶ÔºåÂª∫Á´ãÂèØÊåÅÁ∫åÁôºÂ±ïÁöÑÁ∂ìÊøüÁµêÊßã</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="game-room-controls">
                <div style="margin: 20px 0;">
                    <input type="text" id="playerNameInput" placeholder="Ëº∏ÂÖ•‰Ω†ÁöÑÂêçÁ®±" style="padding: 10px; margin-right: 10px; border-radius: 8px; border: 2px solid #ddd;">
                    <button onclick="createGame()" class="btn btn-primary" id="createGameBtn">ÂâµÂª∫ÈÅäÊà≤</button>
                </div>
                <div style="margin: 20px 0;">
                    <input type="text" id="gameIdInput" placeholder="Ëº∏ÂÖ•ÈÅäÊà≤ÊàøÈñì‰ª£Á¢º" style="padding: 10px; margin-right: 10px; border-radius: 8px; border: 2px solid #ddd;">
                    <button onclick="joinGame()" class="btn btn-success" id="joinGameBtn">Âä†ÂÖ•ÈÅäÊà≤</button>
                </div>
            </div>
        </div>

        <!-- Á≠âÂæÖÂ§ßÂª≥ -->
        <div class="waiting-lobby" id="waitingLobby">
            <h1>üéÆ ÈÅäÊà≤Â§ßÂª≥</h1>
            <p>ÊàøÈñì‰ª£Á¢ºÔºö<strong id="roomCode">-</strong></p>
            <p>Á≠âÂæÖÂÖ∂‰ªñÁé©ÂÆ∂Âä†ÂÖ•...</p>
            
            <h3>Â∑≤Âä†ÂÖ•Áé©ÂÆ∂</h3>
            <div class="players-list" id="playersInLobby">
                <!-- ÂãïÊÖãÁîüÊàê -->
            </div>
            
            <button class="btn-start" id="startGameBtn" onclick="startGame()" disabled>ÈñãÂßãÈÅäÊà≤</button>
        </div>

        <!-- ÈÅäÊà≤‰∏ªÁïåÈù¢ -->
        <div class="game-content" id="gameContent">
            <h1 id="gameTitle">üè¶ ÂÖ®ÁêÉÂ§ÆË°åÊ®°Êì¨Âô®</h1>
            
            <div class="game-interface">
                <!-- Â∑¶ÂÅ¥Èù¢Êùø -->
                <div class="side-panel">
                    <div class="time-display">
                        <h3>‚è∞ Á¨¨ <span id="currentQuarter">1</span> Â≠£</h3>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <p>Ââ©È§òÊôÇÈñìÔºö<span id="timeRemaining">0:30</span></p>
                    </div>

                    <div class="global-status">
                        <h4>üõ¢Ô∏è ÂÖ®ÁêÉÁü≥Ê≤πÂÉπÊ†º</h4>
                        <p id="globalOilPrice">$80.0</p>
                    </div>
                    
                    <h3>üåç ÂÖ∂‰ªñÁé©ÂÆ∂</h3>
                    <div id="otherPlayersList">
                        <!-- ÂãïÊÖãÁîüÊàê -->
                    </div>

                    <h3>üì∞ ÈÅäÊà≤ÂãïÊÖã</h3>
                    <div class="game-log" id="gameLogContainer">
                        <!-- ÂãïÊÖãÁîüÊàê -->
                    </div>
                </div>

                <!-- ‰∏≠ÈñìÈù¢Êùø -->
                <div class="main-panel">
                    <h2 id="myCountryTitle">üá∫üá∏ ÁæéÂúãÂ§ÆË°å</h2>
                    
                    <div class="active-skill-panel" id="activeSkillPanel">
                        <h3 id="skillTitle">‚öîÔ∏è ÁôºÂãïË≤øÊòìÊà∞Áà≠</h3>
                        <div class="skill-description" id="skillDescription">
                            Â∞çÁõÆÊ®ôÂúãÂÆ∂ÁôºÂãïË≤øÊòìÊà∞ÔºåÈÄ†ÊàêÈáçÂ§ßÁ∂ìÊøüÊêçÂ§±Ôºå‰ΩÜÊúâ35%Ê©üÁéáÂèçÂô¨Ëá™Ë∫´
                        </div>
                        <div class="skill-controls" id="skillControls">
                            <button class="btn btn-skill" id="activeSkillBtn">
                                <span class="cooldown-text">‚öîÔ∏è ÁôºÂãïÊäÄËÉΩ</span>
                                <div class="cooldown-overlay" id="activeSkillCooldown" style="width: 0%;"></div>
                                <div class="cooldown-progress" id="activeSkillProgress" style="width: 0%;"></div>
                            </button>
                            
                            <!-- Ê≤ôÁÉèÂú∞Â∞àÂ±¨Áü≥Ê≤πÊéßÂà∂ÊåâÈàïÔºàÈªòË™çÈö±ËóèÔºâ-->
                            <div id="saudiOilControls" style="display: none; margin-top: 15px;">
                                <h4 style="color: white; margin-bottom: 10px;">üõ¢Ô∏è Áü≥Ê≤πÁî¢ÈáèÊéßÂà∂</h4>
                                <div style="display: flex; gap: 10px;">
                                    <button class="btn btn-warning" id="increaseOilBtn" style="flex: 1;">
                                        <span class="cooldown-text">üìà Â¢ûÁî¢ÈôçÂÉπ</span>
                                        <div class="cooldown-overlay" id="increaseOilCooldown" style="width: 0%;"></div>
                                        <div class="cooldown-progress" id="increaseOilProgress" style="width: 0%;"></div>
                                    </button>
                                    <button class="btn btn-danger" id="decreaseOilBtn" style="flex: 1;">
                                        <span class="cooldown-text">üìâ Ê∏õÁî¢ÂçáÂÉπ</span>
                                        <div class="cooldown-overlay" id="decreaseOilCooldown" style="width: 0%;"></div>
                                        <div class="cooldown-progress" id="decreaseOilProgress" style="width: 0%;"></div>
                                    </button>
                                </div>
                                <p style="color: rgba(255,255,255,0.8); font-size: 0.9em; margin-top: 8px; text-align: center;">
                                    ÊéßÂà∂ÂÖ®ÁêÉÁü≥Ê≤πÂÉπÊ†ºÔºåÂΩ±ÈüøÊâÄÊúâÂúãÂÆ∂Á∂ìÊøü
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="indicators-grid">
                        <div class="indicator" id="gdpIndicator">
                            <div class="indicator-label">üìä GDPÊàêÈï∑Áéá</div>
                            <div class="indicator-value" id="gdpGrowth">2.8%</div>
                        </div>
                        <div class="indicator" id="inflationIndicator">
                            <div class="indicator-label">üíπ ÈÄöËÜ®Áéá</div>
                            <div class="indicator-value" id="inflation">2.1%</div>
                        </div>
                        <div class="indicator" id="unemploymentIndicator">
                            <div class="indicator-label">üë• Â§±Ê•≠Áéá</div>
                            <div class="indicator-value" id="unemployment">4.2%</div>
                        </div>
                        <div class="indicator" id="confidenceIndicator">
                            <div class="indicator-label">üòä Ê∞ëÁúæ‰ø°ÂøÉ</div>
                            <div class="indicator-value" id="confidence">65</div>
                        </div>
                        <div class="indicator" id="deficitIndicator">
                            <div class="indicator-label">üí∞ Ë≤°ÊîøËµ§Â≠ó</div>
                            <div class="indicator-value" id="deficit">3.2%</div>
                        </div>
                        <div class="indicator" id="stockIndicator">
                            <div class="indicator-label">üìà ËÇ°ÂÉπÊåáÊï∏ËÆäÂåñÁéá</div>
                            <div class="indicator-value" id="stockIndex">+2.5%</div>
                        </div>
                    </div>
                </div>

                <!-- Âè≥ÂÅ¥Èù¢Êùø -->
                <div class="controls-panel">
                    <h2>üõ†Ô∏è ÊîøÁ≠ñÂ∑•ÂÖ∑</h2>
                    
                    <!-- Âà©ÁéáÊîøÁ≠ñ -->
                    <div class="tool-group">
                        <h3>üí∞ Âà©ÁéáÊîøÁ≠ñ</h3>
                        <div class="tool-controls">
                            <div class="value-display" id="interestRateValue">2.5%</div>
                            <input type="range" id="interestRateSlider" min="-2" max="20" step="0.25" value="2.5">
                        </div>
                        <button class="btn btn-primary" id="interestRateBtn">
                            <span class="cooldown-text">üéØ Ë™øÊï¥Âà©Áéá</span>
                            <div class="cooldown-overlay" id="interestRateCooldown" style="width: 0%;"></div>
                            <div class="cooldown-progress" id="interestRateProgress" style="width: 0%;"></div>
                        </button>
                    </div>

                    <!-- Â≠òÊ¨æÊ∫ñÂÇôÈáëÁéá -->
                    <div class="tool-group">
                        <h3>üè¶ Â≠òÊ¨æÊ∫ñÂÇôÈáëÁéá</h3>
                        <div class="tool-controls">
                            <div class="value-display" id="reserveRatioValue">10%</div>
                            <input type="range" id="reserveRatioSlider" min="0" max="30" step="0.5" value="10">
                        </div>
                        <button class="btn btn-primary" id="reserveRatioBtn">
                            <span class="cooldown-text">üè¶ Ë™øÊï¥Ê∫ñÂÇôÈáëÁéá</span>
                            <div class="cooldown-overlay" id="reserveRatioCooldown" style="width: 0%;"></div>
                            <div class="cooldown-progress" id="reserveRatioProgress" style="width: 0%;"></div>
                        </button>
                    </div>

                    <!-- Ë≤°ÊîøÊîøÁ≠ñ -->
                    <div class="tool-group">
                        <h3>üèõÔ∏è Ë≤°ÊîøÊîøÁ≠ñ</h3>
                        <div class="btn-group">
                            <button class="btn btn-success" id="increaseSpendingBtn">
                                <span class="cooldown-text">üìà Â¢ûÂä†ÊîØÂá∫</span>
                                <div class="cooldown-overlay" id="increaseSpendingCooldown" style="width: 0%;"></div>
                                <div class="cooldown-progress" id="increaseSpendingProgress" style="width: 0%;"></div>
                            </button>
                            <button class="btn btn-warning" id="decreaseSpendingBtn">
                                <span class="cooldown-text">üìâ Ê∏õÂ∞ëÊîØÂá∫</span>
                                <div class="cooldown-overlay" id="decreaseSpendingCooldown" style="width: 0%;"></div>
                                <div class="cooldown-progress" id="decreaseSpendingProgress" style="width: 0%;"></div>
                            </button>
                        </div>
                    </div>

                    <!-- ÈáèÂåñÂØ¨È¨ÜÊîøÁ≠ñ -->
                    <div class="tool-group">
                        <h3>üéõÔ∏è ÈáèÂåñÂØ¨È¨ÜÊîøÁ≠ñ</h3>
                        <div class="btn-group">
                            <button class="btn btn-success" id="qeBtn">
                                <span class="cooldown-text">üí∏ ÈáèÂåñÂØ¨È¨Ü</span>
                                <div class="cooldown-overlay" id="qeCooldown" style="width: 0%;"></div>
                                <div class="cooldown-progress" id="qeProgress" style="width: 0%;"></div>
                            </button>
                            <button class="btn btn-warning" id="qtBtn">
                                <span class="cooldown-text">üîí ÈáèÂåñÁ∑äÁ∏Æ</span>
                                <div class="cooldown-overlay" id="qtCooldown" style="width: 0%;"></div>
                                <div class="cooldown-progress" id="qtProgress" style="width: 0%;"></div>
                            </button>
                        </div>
                    </div>

                    <!-- Á∑äÊÄ•Â∑•ÂÖ∑ -->
                    <div class="tool-group" style="background: linear-gradient(135deg, #ff6b6b, #ee5a24); color: white;">
                        <h3>üö® Á∑äÊÄ•ÊîøÁ≠ñÂ∑•ÂÖ∑</h3>
                        <button class="btn btn-danger" id="cashDistributionBtn">
                            <span class="cooldown-text">üí∞ Á∑äÊÄ•ÊôÆÁôºÁèæÈáë</span>
                            <div class="cooldown-overlay" id="cashDistributionCooldown" style="width: 0%;"></div>
                            <div class="cooldown-progress" id="cashDistributionProgress" style="width: 0%;"></div>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ë©ïÂàÜÈù¢Êùø -->
        <div class="scoring-panel" id="scoringPanel" style="display: none;">
            <div class="scoring-header">
                <h3>üèÜ Ë©ïÂàÜÊéíË°åÊ¶ú</h3>
                <button onclick="toggleScoringPanel()" class="btn btn-secondary">ÈóúÈñâ</button>
            </div>
            
            <div class="standings-container">
                <div class="standings-list" id="standingsList">
                    <!-- ÊéíÂêçÂ∞áÂú®ÈÄôË£°ÂãïÊÖãÁîüÊàê -->
                </div>
            </div>
            
            <div class="scoring-details" id="scoringDetails">
                <!-- Ë©≥Á¥∞Ë©ïÂàÜÂ∞áÂú®ÈÄôË£°È°ØÁ§∫ -->
            </div>
        </div>

        <!-- Âú®ÊéßÂà∂Èù¢ÊùøÁöÑÊúÄÂæåÂä†ÂÖ•Ë©ïÂàÜÊåâÈàï -->
        <div class="tool-group" style="border-left: 4px solid #f39c12;">
            <h3>üìä ÈÅäÊà≤Áµ±Ë®à</h3>
            <button onclick="showCurrentStandings()" class="btn btn-warning" style="width: 100%;">
                üèÜ Êü•ÁúãÁï∂ÂâçÊéíÂêç
            </button>
        </div>
    </div>

    <!-- ÂÖßÂµåÊâÄÊúâ JavaScript Á®ãÂºèÁ¢º -->
    <script>
        console.log('üéÆ ÈñãÂßãËºâÂÖ•Â§ÆË°åÊ®°Êì¨Âô®...');

        // ===== 1. Âø´Ë®äÁ≥ªÁµ± =====
        function NewsAlertSystem() {
            this.alertContainer = null;
            this.currentAlert = null;
            this.autoCloseTimeout = null;
            this.isReady = false;
            
            console.log('üîß ÂàùÂßãÂåñÂø´Ë®äÁ≥ªÁµ±...');
            this.init();
        }

        NewsAlertSystem.prototype.init = function() {
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', () => {
                    this.setupSystem();
                });
            } else {
                this.setupSystem();
            }
        };

        NewsAlertSystem.prototype.setupSystem = function() {
            this.createAlertContainer();
            this.isReady = true;
            console.log('‚úÖ Âø´Ë®äÁ≥ªÁµ±ÂàùÂßãÂåñÂÆåÊàê');
        };

        NewsAlertSystem.prototype.createAlertContainer = function() {
            const existing = document.getElementById('news-alert-container');
            if (existing) {
                existing.remove();
            }
            
            this.alertContainer = document.createElement('div');
            this.alertContainer.id = 'news-alert-container';
            this.alertContainer.className = 'news-alert-container';
            this.alertContainer.style.display = 'none';
            
            document.body.appendChild(this.alertContainer);
            console.log('üì¶ Âø´Ë®äÂÆπÂô®Â∑≤ÂâµÂª∫');
        };

        NewsAlertSystem.prototype.showAlert = function(event) {
            if (!this.isReady) {
                console.warn('‚ö†Ô∏è Âø´Ë®äÁ≥ªÁµ±Â∞öÊú™Ê∫ñÂÇôÂ∞±Á∑íÔºåÁ®çÂæåÈáçË©¶...');
                setTimeout(() => this.showAlert(event), 500);
                return;
            }

            console.log('üì¢ È°ØÁ§∫Âø´Ë®ä:', event.name);
            
            if (this.currentAlert) {
                this.closeAlert();
            }
            
            const alertClass = this.getAlertClass(event);
            const typeIcon = this.getTypeIcon(event);
            const effectsHtml = this.formatEffects(event.effects);
            
            const alertElement = document.createElement('div');
            alertElement.className = 'news-alert ' + alertClass;
            
            alertElement.innerHTML = `
                <div class="news-alert-header">
                    <h3 class="news-alert-title">${typeIcon} ${event.name}</h3>
                    <button class="news-alert-close" onclick="window.newsAlertSystem.closeAlert()">√ó</button>
                </div>
                <div class="news-alert-description">${event.description}</div>
                ${effectsHtml}
                <div class="news-alert-progress"></div>
            `;
            
            this.alertContainer.innerHTML = '';
            this.alertContainer.appendChild(alertElement);
            this.alertContainer.style.display = 'block';
            this.currentAlert = alertElement;
            
            setTimeout(() => {
                const progressBar = alertElement.querySelector('.news-alert-progress');
                if (progressBar) {
                    progressBar.style.width = '0%';
                }
            }, 100);
            
            this.autoCloseTimeout = setTimeout(() => {
                this.closeAlert();
            }, 5000);
            
            console.log('‚úÖ Âø´Ë®äÈ°ØÁ§∫ÊàêÂäü');
        };

        NewsAlertSystem.prototype.closeAlert = function() {
            if (this.autoCloseTimeout) {
                clearTimeout(this.autoCloseTimeout);
                this.autoCloseTimeout = null;
            }
            
            if (this.alertContainer && this.currentAlert) {
                this.alertContainer.style.display = 'none';
                this.alertContainer.innerHTML = '';
            }
            
            this.currentAlert = null;
            console.log('üì™ Âø´Ë®äÂ∑≤ÈóúÈñâ');
        };

        NewsAlertSystem.prototype.getAlertClass = function(event) {
            console.log('üé® Ê±∫ÂÆöÂø´Ë®äÊ®£Âºè:', event.type, event.category);
            
            if (event.type === 'global') {
                return event.category === 'good' ? 'global-good' : 'global-bad';
            } else if (event.type === 'country') {
                return event.category === 'good' ? 'country-good' : 'country-bad';
            } else {
                // È†êË®≠ÁÇ∫ÂÖ®ÁêÉÂ•ΩÊ∂àÊÅØ
                return 'global-good';
            }
        };

        NewsAlertSystem.prototype.getTypeIcon = function(event) {
            if (event.type === 'global') {
                return event.category === 'good' ? 'üåçüìà' : 'üåç‚ö†Ô∏è';
            } else {
                const countryFlags = {
                    "‰∏≠Âúã": "üá®üá≥", "ÁæéÂúã": "üá∫üá∏", "Êó•Êú¨": "üáØüáµ",
                    "Âè∞ÁÅ£": "üáπüáº", "Ê≤ôÁÉèÂú∞ÈòøÊãâ‰ºØ": "üá∏üá¶", "Â∑¥Ë•ø": "üáßüá∑"
                };
                const flag = countryFlags[event.country] || "üè≥Ô∏è";
                const indicator = event.category === 'good' ? 'üìà' : 'üìâ';
                return flag + indicator;
            }
        };

        NewsAlertSystem.prototype.formatEffects = function(effects) {
            if (!effects || Object.keys(effects).length === 0) {
                return '';
            }
            
            const effectTags = [];
            
            if (effects.gdp) {
                const sign = effects.gdp > 0 ? '+' : '';
                effectTags.push(`<span class="effect-tag">GDP ${sign}${effects.gdp.toFixed(1)}%</span>`);
            }
            
            if (effects.confidence) {
                const sign = effects.confidence > 0 ? '+' : '';
                effectTags.push(`<span class="effect-tag">‰ø°ÂøÉ ${sign}${effects.confidence}</span>`);
            }
            
            if (effects.inflation) {
                const sign = effects.inflation > 0 ? '+' : '';
                effectTags.push(`<span class="effect-tag">ÈÄöËÜ® ${sign}${effects.inflation.toFixed(1)}%</span>`);
            }
            
            return effectTags.length > 0 ? `<div class="news-alert-effects">${effectTags.join('')}</div>` : '';
        };

        // ===== 2. ÈÅäÊà≤ÁãÄÊÖãÁÆ°ÁêÜ =====
        let socket;
        let gameState = {
            playerId: null,
            gameId: null,
            playerData: null,
            isHost: false,
            selectedCountry: null,
            policyCooldowns: {},
            allPlayers: {}
        };

        // ===== 3. ÂàùÂßãÂåñ Socket ÈÄ£Êé• =====
        function initializeSocket() {
            socket = io();
            
            socket.on('connected', function(data) {
                gameState.playerId = data.player_id;
                console.log('üîó ÈÄ£Êé•ÊàêÂäüÔºåÁé©ÂÆ∂ID:', gameState.playerId);
            });

            socket.on('game_created', function(data) {
                console.log('üéØ ÈÅäÊà≤ÂâµÂª∫ÊàêÂäü:', data);
                gameState.gameId = data.game_id;
                gameState.playerData = data.player_data;
                gameState.isHost = true;
                showWaitingLobby();
                showSuccess('ÈÅäÊà≤ÊàøÈñìÂâµÂª∫ÊàêÂäüÔºÅÊàøÈñì‰ª£Á¢ºÔºö' + data.game_id);
            });

            socket.on('player_joined', function(data) {
                console.log('üë• Áé©ÂÆ∂Âä†ÂÖ•:', data);
                updatePlayersList(data.all_players);
                if (!gameState.isHost) {
                    showWaitingLobby();
                }
            });

            socket.on('game_started', function() {
                console.log('üöÄ ÈÅäÊà≤ÈñãÂßã');
                showGamePlay();
                showSuccess('ÈÅäÊà≤ÈñãÂßãÔºÅÁ¨¨1Â≠£Ë®àÊôÇÂô®Â∑≤ÂïüÂãï');
                
                // üÜï È°çÂ§ñÁöÑÂª∂ÈÅ≤Âà∑Êñ∞ÔºåÁ¢∫‰øùÊâÄÊúâÊï∏ÊìöÈÉΩÂ∑≤ËºâÂÖ•
                setTimeout(function() {
                    if (gameState.playerData) {
                        forceRefreshPlayerPanel();
                        console.log('üéØ ÈÅäÊà≤ÈñãÂßãÂæåÈ°çÂ§ñÂà∑Êñ∞ÂÆåÊàê');
                    }
                }, 2000);
            });

            socket.on('realtime_update', function(data) {
                updateTimeDisplay(data.progress, data.remaining_time);
                
                if (data.global_oil_price !== undefined) {
                    updateGlobalOilPrice(data.global_oil_price);
                }
                
                if (data.players_cooldowns) {
                    var myPlayerCooldown = data.players_cooldowns.find(function(p) {
                        return p.player_id === gameState.playerId;
                    });
                    if (myPlayerCooldown) {
                        updatePolicyCooldowns(myPlayerCooldown.cooldown_status);
                    }
                }
                
                if (data.players) {
                    updateAllPlayersRealtime(data.players);
                }
            });

            socket.on('quarter_advanced', function(data) {
                console.log('üìÖ Êî∂Âà∞Â≠£Â∫¶Êé®ÈÄ≤‰∫ã‰ª∂ÔºåÂÆåÊï¥Êï∏Êìö:', data);
                
                updateQuarter(data.quarter);
                
                // ‰ΩøÁî®ÂÆåÊï¥Êó•Ë™åËÄå‰∏çÊòØÊà™Êñ∑ÁâàÊú¨
                var logsToShow = data.full_game_log || data.game_log || [];
                updateGameLog(logsToShow);
                
                updateAllPlayers(data.players);
                
                if (data.global_oil_price !== undefined) {
                    updateGlobalOilPrice(data.global_oil_price);
                }
                
                // üéØ ‰øÆÊ≠£ÔºöÊ™¢Êü•‰∫ã‰ª∂Êï∏ÊìöÁµêÊßã‰∏¶ÈÅéÊøæÈ°ØÁ§∫
                console.log('üîç Ê™¢Êü•‰∫ã‰ª∂Êï∏Êìö:', {
                    hasTriggeredEvents: !!data.triggered_events,
                    eventsType: typeof data.triggered_events,
                    eventsIsArray: Array.isArray(data.triggered_events),
                    eventsLength: Array.isArray(data.triggered_events) ? data.triggered_events.length : 'N/A',
                    eventsContent: data.triggered_events
                });
                
                // Ê™¢Êü•‰∫ã‰ª∂Êï∏ÊìöÊ†ºÂºè
                var validEvents = [];
                if (data.triggered_events) {
                    if (Array.isArray(data.triggered_events)) {
                        validEvents = data.triggered_events;
                    } else if (typeof data.triggered_events === 'boolean' && data.triggered_events === true) {
                        console.error('‚ùå ÂæåÁ´ØÈåØË™§Ôºötriggered_events ÊòØÂ∏ÉÊûóÂÄºËÄå‰∏çÊòØÈô£ÂàóÔºÅË´ãÊ™¢Êü• app.py');
                        showError('ÂæåÁ´Ø‰∫ã‰ª∂Êï∏ÊìöÊ†ºÂºèÈåØË™§ÔºåË´ãÊ™¢Êü• app.py ‰∏≠ÁöÑ advance_quarter ÂáΩÊï∏');
                    } else {
                        console.warn('‚ö†Ô∏è Êú™È†êÊúüÁöÑ‰∫ã‰ª∂Êï∏ÊìöÊ†ºÂºè:', typeof data.triggered_events);
                    }
                }
                
                if (validEvents.length > 0) {
                    console.log(`üéØ Á¨¨${data.quarter}Â≠£Êî∂Âà∞ ${validEvents.length} ÂÄãÊúâÊïà‰∫ã‰ª∂`);
                    
                    // üÜï ÈÅéÊøæ‰∫ã‰ª∂ÔºöÂè™È°ØÁ§∫ÂÖ®ÁêÉ‰∫ã‰ª∂ÂíåËá™Â∑±ÂúãÂÆ∂ÁöÑ‰∫ã‰ª∂
                    var eventsToShow = validEvents.filter(function(event) {
                        if (event.type === 'global') {
                            return true; // ÂÖ®ÁêÉ‰∫ã‰ª∂È°ØÁ§∫Áµ¶ÊâÄÊúâ‰∫∫
                        } else if (event.type === 'country') {
                            // ÂúãÂÆ∂‰∫ã‰ª∂Âè™È°ØÁ§∫Áµ¶Â∞çÊáâÂúãÂÆ∂ÁöÑÁé©ÂÆ∂
                            var myCountryName = getCountryNameChinese(gameState.playerData?.country_code);
                            return event.country === myCountryName;
                        }
                        return false;
                    });
                    
                    console.log(`üì¢ ÈÅéÊøæÂæåÈ°ØÁ§∫ ${eventsToShow.length} ÂÄã‰∫ã‰ª∂Áµ¶Áï∂ÂâçÁé©ÂÆ∂`);
                    
                    // ÈÄêÂÄãËôïÁêÜÈÅéÊøæÂæåÁöÑ‰∫ã‰ª∂
                    eventsToShow.forEach(function(event, index) {
                        console.log(`üì¢ ËôïÁêÜ‰∫ã‰ª∂ ${index + 1}:`, event);
                        
                        // È©óË≠â‰∫ã‰ª∂Ê†ºÂºè
                        if (!event.name || !event.description) {
                            console.warn('‚ö†Ô∏è ‰∫ã‰ª∂Ê†ºÂºè‰∏çÂÆåÊï¥:', event);
                            return;
                        }
                        
                        // Âª∂ÈÅ≤È°ØÁ§∫ÔºåÈÅøÂÖçÂø´Ë®äÈáçÁñä
                        setTimeout(function() {
                            if (window.newsAlertSystem && window.newsAlertSystem.isReady) {
                                try {
                                    window.newsAlertSystem.showAlert(event);
                                    console.log('‚úÖ Âø´Ë®äÈ°ØÁ§∫ÊàêÂäü:', event.name);
                                } catch (error) {
                                    console.error('‚ùå Âø´Ë®äÈ°ØÁ§∫ÈåØË™§:', error);
                                    // ÂÇôÁî®ÊñπÊ°à
                                    showSuccess(`üì∞ ${event.name}: ${event.description}`);
                                }
                            } else {
                                console.warn('‚ö†Ô∏è Âø´Ë®äÁ≥ªÁµ±Êú™Â∞±Á∑íÔºå‰ΩøÁî®ÂÇôÁî®È°ØÁ§∫');
                                showSuccess(`üì∞ ${event.name}: ${event.description}`);
                            }
                        }, index * 1500); // ÊØèÂÄã‰∫ã‰ª∂ÈñìÈöî1.5Áßí
                    });
                } else {
                    console.log(`üîÑ Á¨¨${data.quarter}Â≠£Ê≤íÊúâËß∏ÁôºÁâπÊÆä‰∫ã‰ª∂`);
                }
                
                showQuarterTransition(data.quarter);
            });

            socket.on('game_update', function(data) {
                updateAllPlayers(data.players);
                updateGameLog(data.game_log);
                
                if (data.global_oil_price !== undefined) {
                    updateGlobalOilPrice(data.global_oil_price);
                }
            });

            socket.on('error', function(data) {
                showError(data.message);
            });

                // üî• Âú®ÈÄôË£°Ê∑ªÂä†Ë©ïÂàÜÁ≥ªÁµ±Áõ£ËÅΩÂô®
            socket.on('standings_update', function(data) {
                console.log('üìà Êî∂Âà∞ÊéíÂêçÊõ¥Êñ∞:', data);
                updateStandingsDisplay(data.standings, data.quarter);
            });

            socket.on('game_ended', function(data) {
                console.log('üèÅ ÈÅäÊà≤ÁµêÊùü:', data);
                showFinalResults(data.final_scores);
            });

            socket.on('game_duration_set', function(data) {
                console.log('‚è±Ô∏è ÈÅäÊà≤ÊôÇÈï∑Ë®≠ÂÆöÁÇ∫:', data.quarters + 'Â≠£');
                showSuccess(`ÈÅäÊà≤ÊôÇÈï∑Ë®≠ÂÆöÁÇ∫ ${data.quarters} Â≠£`);
            });
        }

        function getCountryNameChinese(countryCode) {
            var mapping = {
                'USA': 'ÁæéÂúã',
                'CHN': '‰∏≠Âúã', 
                'JPN': 'Êó•Êú¨',
                'TWN': 'Âè∞ÁÅ£',
                'SAU': 'Ê≤ôÁÉèÂú∞ÈòøÊãâ‰ºØ',
                'BRA': 'Â∑¥Ë•ø'
            };
            return mapping[countryCode] || countryCode;
        }        

        // ===== 4. ÊîøÁ≠ñÂü∑Ë°åÂáΩÊï∏ =====
        function executePolicy(actionType, additionalData) {
            if (!additionalData) additionalData = {};
            
            if (gameState.policyCooldowns) {
                var globalCooldown = gameState.policyCooldowns.global_policy_cooldown || 0;
                var activeSkillCooldown = gameState.policyCooldowns.active_skill || 0;
                
                var activeSkills = ['taiwan_bet', 'brazil_anticorruption', 'saudi_transformation', 
                                   'usa_trade_war', 'china_mass_mobilization', 'japan_aging_solution'];
                
                if (activeSkills.indexOf(actionType) !== -1) {
                    if (activeSkillCooldown > 0) {
                        showError('ÊäÄËÉΩÂÜ∑Âçª‰∏≠ÔºåÈÇÑÈúÄÁ≠âÂæÖ ' + activeSkillCooldown + ' Â≠£');
                        return;
                    }
                } else {
                    if (globalCooldown > 0) {
                        var remaining = Math.ceil(globalCooldown);
                        showError('ÊîøÁ≠ñÂÜ∑Âçª‰∏≠ÔºåÈÇÑÈúÄÁ≠âÂæÖ ' + remaining + ' ÁßíÊâçËÉΩÁôºÂãï‰∏ãÂÄãÊîøÁ≠ñ');
                        return;
                    }
                }
            }
            
            var policyData = {
                action_type: actionType
            };
            
            for (var key in additionalData) {
                policyData[key] = additionalData[key];
            }
            
            socket.emit('policy_action', policyData);
            console.log('üéØ Âü∑Ë°åÊîøÁ≠ñ:', policyData);
        }

        // ===== 5. ÂúãÂÆ∂ÈÅ∏ÊìáËôïÁêÜ =====
        function setupCountrySelection() {
            var countryCards = document.querySelectorAll('.country-card');
            for (var i = 0; i < countryCards.length; i++) {
                countryCards[i].addEventListener('click', function() {
                    var allCards = document.querySelectorAll('.country-card');
                    for (var j = 0; j < allCards.length; j++) {
                        allCards[j].classList.remove('selected');
                    }
                    this.classList.add('selected');
                    gameState.selectedCountry = this.dataset.country;
                    console.log('üåç ÈÅ∏ÊìáÂúãÂÆ∂:', gameState.selectedCountry);
                });
            }
        }

        // ===== 6. ÈÅäÊà≤ÊàøÈñìÊéßÂà∂ÂáΩÊï∏ =====
        function createGame() {
            var playerName = document.getElementById('playerNameInput').value.trim();
            
            if (!playerName) {
                showError('Ë´ãËº∏ÂÖ•Áé©ÂÆ∂ÂêçÁ®±');
                return;
            }
            
            if (!gameState.selectedCountry) {
                showError('Ë´ãÈÅ∏Êìá‰∏ÄÂÄãÂúãÂÆ∂');
                return;
            }
            
            socket.emit('create_game', {
                player_name: playerName,
                country_code: gameState.selectedCountry
            });
            
            console.log('üéÆ ÂâµÂª∫ÈÅäÊà≤:', { playerName: playerName, country: gameState.selectedCountry });
        }

        function joinGame() {
            var playerName = document.getElementById('playerNameInput').value.trim();
            var gameId = document.getElementById('gameIdInput').value.trim();
            
            if (!playerName) {
                showError('Ë´ãËº∏ÂÖ•Áé©ÂÆ∂ÂêçÁ®±');
                return;
            }
            
            if (!gameId) {
                showError('Ë´ãËº∏ÂÖ•ÈÅäÊà≤ÊàøÈñì‰ª£Á¢º');
                return;
            }
            
            if (!gameState.selectedCountry) {
                showError('Ë´ãÈÅ∏Êìá‰∏ÄÂÄãÂúãÂÆ∂');
                return;
            }
            
            socket.emit('join_game', {
                game_id: gameId,
                player_name: playerName,
                country_code: gameState.selectedCountry
            });
            
            console.log('üö™ Âä†ÂÖ•ÈÅäÊà≤:', { gameId: gameId, playerName: playerName, country: gameState.selectedCountry });
        }

        function startGame() {
            if (!gameState.isHost) {
                showError('Âè™ÊúâÊàø‰∏ªÂèØ‰ª•ÈñãÂßãÈÅäÊà≤');
                return;
            }
            
            socket.emit('start_game');
            console.log('üöÄ Êàø‰∏ªÈñãÂßãÈÅäÊà≤');
        }

        // ===== 7. ÁïåÈù¢Êõ¥Êñ∞ÂáΩÊï∏ =====
        function showWaitingLobby() {
            document.getElementById('countrySelection').style.display = 'none';
            document.getElementById('waitingLobby').style.display = 'block';
            document.getElementById('gameContent').style.display = 'none';
            
            var roomCodeElement = document.getElementById('roomCode');
            if (roomCodeElement) {
                roomCodeElement.textContent = gameState.gameId;
            }
            
            var startBtn = document.getElementById('startGameBtn');
            if (startBtn) {
                startBtn.disabled = !gameState.isHost;
                startBtn.textContent = gameState.isHost ? 'ÈñãÂßãÈÅäÊà≤' : 'Á≠âÂæÖÊàø‰∏ªÈñãÂßã...';
            }
        }

        function showGamePlay() {
            document.getElementById('countrySelection').style.display = 'none';
            document.getElementById('waitingLobby').style.display = 'none';
            document.getElementById('gameContent').style.display = 'block';
            
            // üÜï Â¢ûÂä†Â§öÊ¨°Âà∑Êñ∞Á¢∫‰øùÊ≠£Á¢∫È°ØÁ§∫
            setTimeout(function() {
                forceRefreshPlayerPanel();
            }, 100);
            
            setTimeout(function() {
                forceRefreshPlayerPanel();
            }, 500);
            
            setTimeout(function() {
                forceRefreshPlayerPanel();
            }, 1000);
            
            console.log('üéÆ ÈÅäÊà≤ÁïåÈù¢Â∑≤ËºâÂÖ•');
        }

        // üÜï Êñ∞Â¢ûÂº∑Âà∂Âà∑Êñ∞ÂáΩÊï∏
        function forceRefreshPlayerPanel() {
            console.log('üîÑ Âº∑Âà∂Âà∑Êñ∞Áé©ÂÆ∂Èù¢Êùø');
            
            if (!gameState.playerData) {
                console.warn('‚ö†Ô∏è Áé©ÂÆ∂Êï∏ÊìöÂ∞öÊú™ËºâÂÖ•ÔºåË∑≥ÈÅéÂà∑Êñ∞');
                return;
            }
            
            updateMyCountryPanel();
            setupCountrySpecificPanels();
            updateActiveSkillPanel();
            
            // Á¢∫‰øùÊªëÊ°øÂÄºÊ≠£Á¢∫
            var data = gameState.playerData.country_data;
            if (data) {
                var interestSlider = document.getElementById('interestRateSlider');
                var interestValue = document.getElementById('interestRateValue');
                if (interestSlider && interestValue) {
                    interestSlider.value = data.interest_rate;
                    interestValue.textContent = data.interest_rate.toFixed(2) + '%';
                }
                
                var reserveSlider = document.getElementById('reserveRatioSlider');
                var reserveValue = document.getElementById('reserveRatioValue');
                if (reserveSlider && reserveValue) {
                    reserveSlider.value = data.reserve_ratio;
                    reserveValue.textContent = data.reserve_ratio.toFixed(1) + '%';
                }
            }
            
            console.log('‚úÖ Èù¢ÊùøÂà∑Êñ∞ÂÆåÊàêÔºåÁï∂ÂâçÂúãÂÆ∂:', gameState.playerData.country_code);
        }

        function updatePlayersList(players) {
            var container = document.getElementById('playersInLobby');
            if (!container) return;
            
            container.innerHTML = '';
            for (var i = 0; i < players.length; i++) {
                var player = players[i];
                var playerCard = document.createElement('div');
                var isHost = player.id === gameState.playerId && gameState.isHost;
                playerCard.className = 'player-card' + (isHost ? ' host' : '');
                playerCard.innerHTML = 
                    '<div style="font-size: 2em; margin-bottom: 10px;">' + player.country_flag + '</div>' +
                    '<div style="font-weight: bold;">' + player.name + '</div>' +
                    '<div style="color: #666;">' + player.country_name + '</div>' +
                    (isHost ? '<div style="color: #e74c3c; font-weight: bold;">Êàø‰∏ª</div>' : '');
                container.appendChild(playerCard);
            }
        }

        function updateAllPlayers(players) {
            gameState.allPlayers = {};
            for (var i = 0; i < players.length; i++) {
                var player = players[i];
                gameState.allPlayers[player.id] = player;
                if (player.id === gameState.playerId) {
                    gameState.playerData = player;
                }
            }
            
            updateOtherPlayersList(players);
            updateMyCountryPanel();
            
            // üÜï Â¶ÇÊûúÊòØÁ¨¨‰∏ÄÊ¨°ËºâÂÖ•ÔºåÂº∑Âà∂Âà∑Êñ∞Èù¢Êùø
            if (document.getElementById('gameContent').style.display === 'block') {
                updateActiveSkillPanel();
            }
        }

        function updateAllPlayersRealtime(players) {
            for (var i = 0; i < players.length; i++) {
                var player = players[i];
                if (gameState.allPlayers && gameState.allPlayers[player.id]) {
                    for (var key in player) {
                        gameState.allPlayers[player.id][key] = player[key];
                    }
                }
                if (player.id === gameState.playerId) {
                    for (var key in player) {
                        gameState.playerData[key] = player[key];
                    }
                }
            }
            
            updateOtherPlayersList(players);
            updateMyCountryPanel();
        }

        function updateOtherPlayersList(players) {
            var container = document.getElementById('otherPlayersList');
            if (!container) return;
            
            container.innerHTML = '';
            for (var i = 0; i < players.length; i++) {
                var player = players[i];
                if (player.id !== gameState.playerId) {
                    var playerDiv = document.createElement('div');
                    playerDiv.className = 'other-player';
                    
                    var opponentStockReturn = ((player.country_data.stock_index - 100) / 100) * 100;
                    var formattedStockReturn = opponentStockReturn >= 0 ? 
                        '+' + opponentStockReturn.toFixed(1) + '%' : 
                        opponentStockReturn.toFixed(1) + '%';
                    
                    playerDiv.innerHTML = 
                        '<div class="player-name">' + player.country_flag + ' ' + player.name + '</div>' +
                        '<div class="player-stats">' +
                            '<div class="stat">Â§ßÁõ§: ' + formattedStockReturn + '</div>' +
                            '<div class="stat">GDP: ' + player.country_data.gdp_growth.toFixed(1) + '%</div>' +
                            '<div class="stat">ÈÄöËÜ®: ' + player.country_data.inflation.toFixed(1) + '%</div>' +
                            '<div class="stat confidential">Â§±Ê•≠: Ê©üÂØÜ</div>' +
                            '<div class="stat confidential">‰ø°ÂøÉ: Ê©üÂØÜ</div>' +
                            '<div class="stat confidential">Âà©Áéá: Ê©üÂØÜ</div>' +
                        '</div>';
                    container.appendChild(playerDiv);
                }
            }
        }

        function updateMyCountryPanel() {
            if (!gameState.playerData) return;
            
            var data = gameState.playerData.country_data;
            
            var title = document.getElementById('myCountryTitle');
            if (title) {
                title.textContent = gameState.playerData.country_flag + ' ' + gameState.playerData.country_name + 'Â§ÆË°å';
            }
            
            updateIndicator('gdpGrowth', data.gdp_growth, '%', 'gdpIndicator');
            updateIndicator('inflation', data.inflation, '%', 'inflationIndicator');
            updateIndicator('unemployment', data.unemployment, '%', 'unemploymentIndicator');
            updateIndicator('confidence', data.confidence, '', 'confidenceIndicator');
            updateIndicator('deficit', data.fiscal_deficit, '%', 'deficitIndicator');
            
            var stockReturn = ((data.stock_index - 100) / 100) * 100;
            updateStockIndicator('stockIndex', stockReturn, '%', 'stockIndicator');
            
            updateSliderSafely('interestRateSlider', 'interestRateValue', data.interest_rate, '%');
            updateSliderSafely('reserveRatioSlider', 'reserveRatioValue', data.reserve_ratio, '%');
            
            updateActiveSkillPanel();
        }

        function updateIndicator(elementId, value, suffix, containerId) {
            var element = document.getElementById(elementId);
            var container = document.getElementById(containerId);
            
            if (element) {
                if (typeof value === 'number') {
                    element.textContent = value.toFixed(1) + suffix;
                } else {
                    element.textContent = value + suffix;
                }
            }
            
            if (container) {
                container.classList.remove('positive', 'negative');
                if (typeof value === 'number') {
                    if (elementId === 'gdpGrowth' || elementId === 'confidence') {
                        if (value > 0) {
                            container.classList.add('positive');
                        } else if (value < 0) {
                            container.classList.add('negative');
                        }
                    } else if (elementId === 'inflation' || elementId === 'unemployment') {
                        if (value > 3) {
                            container.classList.add('negative');
                        } else if (value < 2) {
                            container.classList.add('positive');
                        }
                    } else if (elementId === 'deficit') {
                        if (value > 0) {
                            container.classList.add('negative'); // Ëµ§Â≠óÊòØË≤†Èù¢ÁöÑ
                        } else {
                            container.classList.add('positive'); // ÁõàÈ§òÊòØÊ≠£Èù¢ÁöÑ
                        }
                    }
                }
            }
        }

        function updateStockIndicator(elementId, value, suffix, containerId) {
            var element = document.getElementById(elementId);
            var container = document.getElementById(containerId);
            
            if (element) {
                var formattedValue = value >= 0 ? '+' + value.toFixed(1) : value.toFixed(1);
                element.textContent = formattedValue + suffix;
            }
            
            if (container) {
                container.classList.remove('positive', 'negative', 'neutral');
                
                if (value > 2) {
                    container.classList.add('positive');
                } else if (value < -2) {
                    container.classList.add('negative');
                } else {
                    container.classList.add('neutral');
                }
            }
        }

        function updateSliderSafely(sliderId, valueId, newValue, suffix) {
            var slider = document.getElementById(sliderId);
            var valueDisplay = document.getElementById(valueId);
            
            if (!slider || !valueDisplay) return;
            
            // Ê™¢Êü•ÊªëÊ°øÊòØÂê¶Ê≠£Âú®Ë¢´Áî®Êà∂Êìç‰Ωú
            if (slider.dataset.userInteracting === 'true') {
                console.log('üéõÔ∏è ÊªëÊ°øÊ≠£Âú®Ë¢´Áî®Êà∂Êìç‰ΩúÔºåË∑≥ÈÅéËá™ÂãïÊõ¥Êñ∞:', sliderId);
                return;
            }
            
            // ÂÆâÂÖ®Êõ¥Êñ∞ÊªëÊ°ø
            var currentValue = parseFloat(slider.value);
            var difference = Math.abs(currentValue - newValue);
            
            // Âè™ÊúâÂú®Â∑ÆÁï∞ËºÉÂ§ßÊôÇÊâçÊõ¥Êñ∞ÔºåÈÅøÂÖçÈ†ªÁπÅÂõûÂΩà
            if (difference > 0.5) {
                slider.value = newValue;
                valueDisplay.textContent = newValue.toFixed(sliderId === 'reserveRatioSlider' ? 1 : 2) + suffix;
                console.log('üîÑ ÂêåÊ≠•ÊªëÊ°ø:', sliderId, 'Êñ∞ÂÄº:', newValue);
            }
        }

        function setupCountrySpecificPanels() {
            var countryCode = gameState.playerData ? gameState.playerData.country_code : null;
            updateActiveSkillPanel();
        }

        function updateActiveSkillPanel() {
            var countryCode = gameState.playerData ? gameState.playerData.country_code : null;
            var skillTitle = document.getElementById('skillTitle');
            var skillDescription = document.getElementById('skillDescription');
            var saudiOilControls = document.getElementById('saudiOilControls'); // ‚úÖ ‰øÆÂæ©ÔºöÊ≠£Á¢∫Áç≤ÂèñÂÖÉÁ¥†
            
            var skillConfig = {
                'USA': {
                    title: '‚öîÔ∏è ÁôºÂãïË≤øÊòìÊà∞Áà≠',
                    description: 'Â∞çÁõÆÊ®ôÂúãÂÆ∂ÁôºÂãïË≤øÊòìÊà∞ÔºåÈÄ†ÊàêÈáçÂ§ßÁ∂ìÊøüÊêçÂ§±Ôºå‰ΩÜÊúâ35%Ê©üÁéáÂèçÂô¨Ëá™Ë∫´'
                },
                'CHN': {
                    title: 'üöÄ ‰∫∫Â§öÂ•ΩËæ¶‰∫ã',
                    description: 'ÈõÜ‰∏≠ÂäõÈáèËæ¶Â§ß‰∫ãÔºåÂØ¶ÁèæÈáçÂ§ßÁßëÊäÄÁ™ÅÁ†¥ÔºåÂ§ßÂπÖÊèêÂçáGDPÊàêÈï∑ÂíåÊ∞ëÁúæ‰ø°ÂøÉÔºåÁÑ°ÊòéÈ°ØÂâØ‰ΩúÁî®'
                },
                'JPN': {
                    title: 'üéØ ÊîπÂñÑËÄÅ‰∫∫Â∞±Ê•≠ÂïèÈ°å',
                    description: 'ÈÄèÈÅéÊï∏‰ΩçÂåñÂüπË®ìÂíåÂΩàÊÄßÂ∑•‰ΩúÂà∂Â∫¶ÔºåÊèêÂçáÈ´òÈΩ°ÂãûÂãïÂèÉËàáÁéáÔºåËß£Ê±∫ÈÄöÁ∏ÆÂíå‰ø°ÂøÉÂïèÈ°å'
                },
                'TWN': {
                    title: 'üé≤ Â§æÁ∏´‰∏≠Ê±ÇÁîüÂ≠ò',
                    description: 'ÈÅ∏ÊìáÊê≠‰πòÊüêÂúãÁ∂ìÊøüÈ†ÜÈ¢®ËªäÔºåËã•Ë©≤ÂúãË°®ÁèæËâØÂ•ΩÂâáÁç≤ÂæóÈ°çÂ§ñÊî∂ÁõäÔºåÈ´îÁèæÂ∞èÂúãÈùàÊ¥ªÂ§ñ‰∫§'
                },
                'BRA': {
                    title: '‚öñÔ∏è ÂèçË≤™ËÖêË°åÂãï',
                    description: 'ÁôºÂãïÂ§ßË¶èÊ®°ÂèçË≤™ËÖêÈÅãÂãïÔºåÂ§ßÂπÖÊèêÂçáÊîøÂ∫úÊïàËÉΩÂíåÊ∞ëÁúæ‰ø°ÂøÉÔºåÊîπÂñÑË≤°ÊîøÁãÄÊ≥Å'
                },
                'SAU': {
                    title: 'üè≠ Áî¢Ê•≠ËΩâÂûã',
                    description: 'Êé®ÈÄ≤Á∂ìÊøüÂ§öÂÖÉÂåñÔºåÈÄêÊ≠•Èôç‰ΩéÁü≥Ê≤π‰æùË≥¥Â∫¶ÔºåÂª∫Á´ãÂèØÊåÅÁ∫åÁôºÂ±ïÁöÑÁ∂ìÊøüÁµêÊßã'
                }
            };
            
            var config = skillConfig[countryCode];
            if (config) {
                if (skillTitle) skillTitle.textContent = config.title;
                if (skillDescription) skillDescription.textContent = config.description;
            }
            
            // ‚úÖ È°ØÁ§∫ÊàñÈö±ËóèÊ≤ôÁÉèÂú∞Áü≥Ê≤πÊéßÂà∂ÊåâÈàï
            if (saudiOilControls) {
                if (countryCode === 'SAU') {
                    saudiOilControls.style.display = 'block';
                } else {
                    saudiOilControls.style.display = 'none';
                }
            }

            console.log('‚úÖ ‰∏ªÂãïÊäÄËÉΩÈù¢ÊùøÂ∑≤Êõ¥Êñ∞ÁÇ∫:', countryCode, config ? config.title : 'Êú™Áü•');
        }

        function updateTimeDisplay(progress, remainingTime) {
            var progressFill = document.getElementById('progressFill');
            var timeRemaining = document.getElementById('timeRemaining');
            
            if (progressFill) {
                var percentage = Math.min(progress * 100, 100);
                progressFill.style.width = percentage + '%';
                
                if (remainingTime <= 5) {
                    progressFill.style.backgroundColor = '#e74c3c';
                } else if (remainingTime <= 10) {
                    progressFill.style.backgroundColor = '#f39c12';
                } else {
                    progressFill.style.backgroundColor = '#3498db';
                }
            }
            
            if (timeRemaining) {
                var minutes = Math.floor(remainingTime / 60);
                var seconds = Math.floor(remainingTime % 60);
                timeRemaining.textContent = minutes + ':' + (seconds < 10 ? '0' : '') + seconds;
                
                if (remainingTime <= 5) {
                    timeRemaining.style.color = '#e74c3c';
                    timeRemaining.style.fontWeight = 'bold';
                } else {
                    timeRemaining.style.color = '';
                    timeRemaining.style.fontWeight = '';
                }
            }
        }

        function updateQuarter(quarter) {
            var element = document.getElementById('currentQuarter');
            if (element) {
                element.textContent = quarter;
            }
        }

        function updateGlobalOilPrice(price) {
            var element = document.getElementById('globalOilPrice');
            if (element) {
                element.textContent = '$' + price.toFixed(1);
            }
        }

        function updateGameLog(logs) {
            var container = document.getElementById('gameLogContainer');
            if (!container) return;
            
            var wasAtBottom = container.scrollHeight - container.clientHeight <= container.scrollTop + 1;
            
            container.innerHTML = '';
            
            // È°ØÁ§∫ÊúÄÊñ∞ÁöÑ 10 Ê¢ùÁ¥ÄÈåÑÔºåËÄå‰∏çÊòØÂè™Êúâ 3 Ê¢ù
            var displayLogs = logs.slice(-10);
            
            for (var i = 0; i < displayLogs.length; i++) {
                var log = displayLogs[i];
                var logDiv = document.createElement('div');
                logDiv.className = 'log-entry';
                
                // Ê∑ªÂä†ÊôÇÈñìÊà≥È°ØÁ§∫
                var timeStamp = '';
                if (log.timestamp) {
                    var date = new Date(log.timestamp * 1000);
                    timeStamp = date.toLocaleTimeString('zh-TW', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        second: '2-digit'
                    });
                    timeStamp = ' [' + timeStamp + ']';
                }
                
                logDiv.innerHTML = '<strong>Q' + log.quarter + '</strong>' + timeStamp + ' ' + log.message;
                container.appendChild(logDiv);
            }
            
            // Â¶ÇÊûúÁî®Êà∂Âú®Â∫ïÈÉ®ÔºåËá™ÂãïÊªæÂãï
            if (wasAtBottom) {
                container.scrollTop = container.scrollHeight;
            }
            
            console.log('üì∞ ÈÅäÊà≤Êó•Ë™åÂ∑≤Êõ¥Êñ∞ÔºåÈ°ØÁ§∫', displayLogs.length, 'Ê¢ùÁ¥ÄÈåÑ');
        }

        function updatePolicyCooldowns(cooldownStatus) {
            gameState.policyCooldowns = cooldownStatus;
            
            var globalCooldown = cooldownStatus.global_policy_cooldown || 0;
            var activeSkillCooldown = cooldownStatus.active_skill || 0;
            
            updateActiveSkillCooldown(activeSkillCooldown);
            
            var policyButtons = [
                { btnId: 'interestRateBtn', cooldownId: 'interestRateCooldown', progressId: 'interestRateProgress' },
                { btnId: 'reserveRatioBtn', cooldownId: 'reserveRatioCooldown', progressId: 'reserveRatioProgress' },
                { btnId: 'increaseSpendingBtn', cooldownId: 'increaseSpendingCooldown', progressId: 'increaseSpendingProgress' },
                { btnId: 'decreaseSpendingBtn', cooldownId: 'decreaseSpendingCooldown', progressId: 'decreaseSpendingProgress' },
                { btnId: 'qeBtn', cooldownId: 'qeCooldown', progressId: 'qeProgress' },
                { btnId: 'qtBtn', cooldownId: 'qtCooldown', progressId: 'qtProgress' },
                { btnId: 'cashDistributionBtn', cooldownId: 'cashDistributionCooldown', progressId: 'cashDistributionProgress' },
                // üÜï Ê∑ªÂä†Áü≥Ê≤πÊéßÂà∂ÊåâÈàï
                { btnId: 'increaseOilBtn', cooldownId: 'increaseOilCooldown', progressId: 'increaseOilProgress' },
                { btnId: 'decreaseOilBtn', cooldownId: 'decreaseOilCooldown', progressId: 'decreaseOilProgress' }
            ];
            
            policyButtons.forEach(function(config) {
                updateButtonCooldown(config.btnId, config.cooldownId, config.progressId, globalCooldown, 10);
            });
        }

        function updateActiveSkillCooldown(remaining) {
            var btn = document.getElementById('activeSkillBtn');
            var cooldownOverlay = document.getElementById('activeSkillCooldown');
            var progressBar = document.getElementById('activeSkillProgress');
            
            if (!btn || !cooldownOverlay || !progressBar) return;
            
            if (remaining > 0) {
                btn.disabled = true;
                btn.classList.add('btn-cooldown');
                
                cooldownOverlay.textContent = remaining + 'Â≠£';
                cooldownOverlay.style.width = '100%';
                progressBar.style.width = '100%';
            } else {
                btn.disabled = false;
                btn.classList.remove('btn-cooldown');
                cooldownOverlay.style.width = '0%';
                progressBar.style.width = '0%';
                cooldownOverlay.textContent = '';
            }
        }

        function updateButtonCooldown(btnId, cooldownId, progressId, remaining, maxCooldown) {
            var btn = document.getElementById(btnId);
            var cooldownOverlay = document.getElementById(cooldownId);
            var progressBar = document.getElementById(progressId);
            
            if (!btn || !cooldownOverlay || !progressBar) return;
            
            if (remaining > 0) {
                btn.disabled = true;
                btn.classList.add('btn-cooldown');
                
                var seconds = Math.ceil(remaining);
                cooldownOverlay.textContent = seconds + 's';
                cooldownOverlay.style.width = '100%';
                progressBar.style.width = '100%';
                
                if (maxCooldown > 0) {
                    var percentage = (remaining / maxCooldown) * 100;
                    cooldownOverlay.style.width = percentage + '%';
                    progressBar.style.width = percentage + '%';
                }
            } else {
                btn.disabled = false;
                btn.classList.remove('btn-cooldown');
                cooldownOverlay.style.width = '0%';
                progressBar.style.width = '0%';
                cooldownOverlay.textContent = '';
            }
        }

        // ===== 8. Ë®≠ÁΩÆÊåâÈàï‰∫ã‰ª∂Áõ£ËÅΩÂô® =====
        function setupPolicyButtons() {
            // Âà©ÁéáÊîøÁ≠ñ
            var interestRateBtn = document.getElementById('interestRateBtn');
            if (interestRateBtn) {
                interestRateBtn.addEventListener('click', function() {
                    var slider = document.getElementById('interestRateSlider');
                    if (slider) {
                        var rate = parseFloat(slider.value);
                        console.log('üí∞ Âü∑Ë°åÂà©ÁéáÊîøÁ≠ñÔºåÊï∏ÂÄº:', rate);
                        executePolicy('interest_rate', { value: rate });
                    }
                });
            }

            // Â≠òÊ¨æÊ∫ñÂÇôÈáëÁéá
            var reserveRatioBtn = document.getElementById('reserveRatioBtn');
            if (reserveRatioBtn) {
                reserveRatioBtn.addEventListener('click', function() {
                    var slider = document.getElementById('reserveRatioSlider');
                    if (slider) {
                        var ratio = parseFloat(slider.value);
                        console.log('üè¶ Âü∑Ë°åÊ∫ñÂÇôÈáëÁéáÊîøÁ≠ñÔºåÊï∏ÂÄº:', ratio);
                        executePolicy('reserve_ratio', { value: ratio });
                    }
                });
            }

            // Ë≤°ÊîøÊîøÁ≠ñÊåâÈàï
            var increaseSpendingBtn = document.getElementById('increaseSpendingBtn');
            if (increaseSpendingBtn) {
                increaseSpendingBtn.addEventListener('click', function() {
                    executePolicy('fiscal_policy', { policy_type: 'increase_spending' });
                });
            }

            var decreaseSpendingBtn = document.getElementById('decreaseSpendingBtn');
            if (decreaseSpendingBtn) {
                decreaseSpendingBtn.addEventListener('click', function() {
                    executePolicy('fiscal_policy', { policy_type: 'decrease_spending' });
                });
            }

            // ÈáèÂåñÂØ¨È¨ÜÊîøÁ≠ñÊåâÈàï
            var qeBtn = document.getElementById('qeBtn');
            if (qeBtn) {
                qeBtn.addEventListener('click', function() {
                    executePolicy('quantitative_easing', { direction: 'easing' });
                });
            }

            var qtBtn = document.getElementById('qtBtn');
            if (qtBtn) {
                qtBtn.addEventListener('click', function() {
                    executePolicy('quantitative_easing', { direction: 'tightening' });
                });
            }

            // ÊôÆÁôºÁèæÈáë
            var cashDistributionBtn = document.getElementById('cashDistributionBtn');
            if (cashDistributionBtn) {
                cashDistributionBtn.addEventListener('click', function() {
                    executePolicy('cash_distribution');
                });
            }

            // ‰∏ªÂãïÊäÄËÉΩÊåâÈàï
            var activeSkillBtn = document.getElementById('activeSkillBtn');
            if (activeSkillBtn) {
                activeSkillBtn.addEventListener('click', function() {
                    handleActiveSkillClick();
                });
            }

            // üÜï Ê≤ôÁÉèÂú∞Áü≥Ê≤πÊéßÂà∂ÊåâÈàï
            var increaseOilBtn = document.getElementById('increaseOilBtn');
            if (increaseOilBtn) {
                increaseOilBtn.addEventListener('click', function() {
                    executePolicy('oil_control', { direction: 'increase' });
                });
            }

            var decreaseOilBtn = document.getElementById('decreaseOilBtn');
            if (decreaseOilBtn) {
                decreaseOilBtn.addEventListener('click', function() {
                    executePolicy('oil_control', { direction: 'decrease' });
                });
            }            

            // Ë®≠ÁΩÆÊªëÊ°øÂç≥ÊôÇÊõ¥Êñ∞
            setupSliders();
        }

        function setupSliders() {
            console.log('üéõÔ∏è Ë®≠ÁΩÆÊªëÊ°ø‰∫ã‰ª∂Áõ£ËÅΩÂô®');
            
            function setupSlider(sliderId, valueId, decimals, suffix) {
                var slider = document.getElementById(sliderId);
                var valueDisplay = document.getElementById(valueId);
                
                if (slider && valueDisplay) {
                    // Ê®ôË®òÁî®Êà∂ÈñãÂßãÊìç‰Ωú
                    slider.addEventListener('mousedown', function() {
                        slider.dataset.userInteracting = 'true';
                    });
                    
                    slider.addEventListener('touchstart', function() {
                        slider.dataset.userInteracting = 'true';
                    });
                    
                    // Ê®ôË®òÁî®Êà∂ÁµêÊùüÊìç‰Ωú
                    slider.addEventListener('mouseup', function() {
                        setTimeout(function() {
                            slider.dataset.userInteracting = 'false';
                        }, 1000); // 1ÁßíÂæåÂÖÅË®±Ëá™ÂãïÊõ¥Êñ∞
                    });
                    
                    slider.addEventListener('touchend', function() {
                        setTimeout(function() {
                            slider.dataset.userInteracting = 'false';
                        }, 1000);
                    });
                    
                    // Âç≥ÊôÇÊõ¥Êñ∞È°ØÁ§∫ÂÄº
                    slider.addEventListener('input', function(e) {
                        var value = parseFloat(e.target.value);
                        valueDisplay.textContent = value.toFixed(decimals) + suffix;
                        console.log('üìä ÊªëÊ°øË™øÊï¥:', sliderId, value + suffix);
                    });
                }
            }
            
            // Ë®≠ÁΩÆÂà©ÁéáÊªëÊ°øÔºà2‰ΩçÂ∞èÊï∏Ôºâ
            setupSlider('interestRateSlider', 'interestRateValue', 2, '%');
            
            // Ë®≠ÁΩÆÊ∫ñÂÇôÈáëÁéáÊªëÊ°øÔºà1‰ΩçÂ∞èÊï∏Ôºâ
            setupSlider('reserveRatioSlider', 'reserveRatioValue', 1, '%');
            
            console.log('‚úÖ ÊªëÊ°ø‰∫ã‰ª∂Áõ£ËÅΩÂô®Ë®≠ÁΩÆÂÆåÊàê');
        }

        function handleActiveSkillClick() {
            var countryCode = gameState.playerData ? gameState.playerData.country_code : null;
            
            switch (countryCode) {
                case 'USA':
                    handleUSATradeWar();
                    break;
                case 'CHN':
                    executePolicy('china_mass_mobilization');
                    break;
                case 'JPN':
                    executePolicy('japan_aging_solution');
                    break;
                case 'TWN':
                    handleTaiwanBet();
                    break;
                case 'BRA':
                    executePolicy('brazil_anticorruption');
                    break;
                case 'SAU':
                    executePolicy('saudi_transformation');
                    break;
                default:
                    showError('Êú™Áü•ÁöÑÂúãÂÆ∂‰ª£Á¢º');
            }
        }

        function handleUSATradeWar() {
            var otherCountries = [];
            for (var playerId in gameState.allPlayers) {
                var player = gameState.allPlayers[playerId];
                if (player.country_code !== 'USA') {
                    otherCountries.push({
                        code: player.country_code,
                        name: player.country_name,
                        flag: player.country_flag
                    });
                }
            }
            
            if (otherCountries.length === 0) {
                showError('Ê≤íÊúâÂèØ‰ª•ÁôºÂãïË≤øÊòìÊà∞Áà≠ÁöÑÁõÆÊ®ôÂúãÂÆ∂');
                return;
            }
            
            createCountryDropdown(otherCountries, 'üö® ÈÅ∏ÊìáË≤øÊòìÊà∞Áà≠ÁõÆÊ®ôÂúãÂÆ∂').then(function(target) {
                if (target) {
                    executePolicy('usa_trade_war', { target_country: target });
                }
            });
        }

        function handleTaiwanBet() {
            var otherCountries = [];
            for (var playerId in gameState.allPlayers) {
                var player = gameState.allPlayers[playerId];
                if (player.country_code !== 'TWN') {
                    otherCountries.push({
                        code: player.country_code,
                        name: player.country_name,
                        flag: player.country_flag
                    });
                }
            }
            
            if (otherCountries.length === 0) {
                showError('Ê≤íÊúâÂèØ‰ª•Êê≠È†ÜÈ¢®ËªäÁöÑÂúãÂÆ∂');
                return;
            }
            
            createCountryDropdown(otherCountries, 'üé≤ ÈÅ∏ÊìáË¶ÅÊê≠È†ÜÈ¢®ËªäÁöÑÂúãÂÆ∂').then(function(target) {
                if (target) {
                    executePolicy('taiwan_bet', { target_country: target });
                }
            });
        }

        function createCountryDropdown(countries, title) {
            return new Promise(function(resolve) {
                // ÂâµÂª∫Ê®°ÊÖãÂ∞çË©±Ê°Ü
                var modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.7);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                `;
                
                var dialog = document.createElement('div');
                dialog.style.cssText = `
                    background: white;
                    border-radius: 15px;
                    padding: 30px;
                    max-width: 400px;
                    width: 90%;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                `;
                
                dialog.innerHTML = `
                    <h3 style="margin-bottom: 20px; color: #2c3e50; text-align: center;">${title}</h3>
                    <select id="countrySelect" style="
                        width: 100%;
                        padding: 12px;
                        border: 2px solid #3498db;
                        border-radius: 8px;
                        font-size: 16px;
                        margin-bottom: 20px;
                        background: white;
                    ">
                        <option value="">Ë´ãÈÅ∏ÊìáÂúãÂÆ∂...</option>
                        ${countries.map(country => 
                            `<option value="${country.code}">${country.flag} ${country.name}</option>`
                        ).join('')}
                    </select>
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button id="confirmBtn" style="
                            padding: 10px 20px;
                            background: #27ae60;
                            color: white;
                            border: none;
                            border-radius: 6px;
                            cursor: pointer;
                            font-weight: bold;
                        ">Á¢∫Ë™ç</button>
                        <button id="cancelBtn" style="
                            padding: 10px 20px;
                            background: #95a5a6;
                            color: white;
                            border: none;
                            border-radius: 6px;
                            cursor: pointer;
                            font-weight: bold;
                        ">ÂèñÊ∂à</button>
                    </div>
                `;
                
                modal.appendChild(dialog);
                document.body.appendChild(modal);
                
                var select = dialog.querySelector('#countrySelect');
                var confirmBtn = dialog.querySelector('#confirmBtn');
                var cancelBtn = dialog.querySelector('#cancelBtn');
                
                confirmBtn.addEventListener('click', function() {
                    var selectedValue = select.value;
                    document.body.removeChild(modal);
                    resolve(selectedValue || null);
                });
                
                cancelBtn.addEventListener('click', function() {
                    document.body.removeChild(modal);
                    resolve(null);
                });
                
                // ESC ÈçµÈóúÈñâ
                modal.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape') {
                        document.body.removeChild(modal);
                        resolve(null);
                    }
                });
                
                // ËÅöÁÑ¶Âà∞ÈÅ∏ÊìáÊ°Ü
                setTimeout(function() {
                    select.focus();
                }, 100);
            });
        }

        // ===== 9. ÊèêÁ§∫ÂíåÂèçÈ•ãÁ≥ªÁµ± =====
        function showQuarterTransition(quarter) {
            var alerts = document.getElementById('economicAlerts');
            var transitionDiv = document.createElement('div');
            transitionDiv.className = 'prosperity-notice';
            transitionDiv.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            transitionDiv.innerHTML = 'üìÖ Á¨¨ ' + quarter + ' Â≠£ÈñãÂßãÔºÅÁ∂ìÊøüÊåáÊ®ôÂ∑≤Êõ¥Êñ∞';
            alerts.appendChild(transitionDiv);
            
            setTimeout(function() {
                if (transitionDiv.parentNode) {
                    transitionDiv.parentNode.removeChild(transitionDiv);
                }
            }, 3000);
        }

        function showSuccess(message) {
            var alerts = document.getElementById('economicAlerts');
            var successDiv = document.createElement('div');
            successDiv.className = 'prosperity-notice success-notice';
            successDiv.innerHTML = '‚úÖ ' + message;
            alerts.appendChild(successDiv);
            
            setTimeout(function() {
                if (successDiv.parentNode) {
                    successDiv.parentNode.removeChild(successDiv);
                }
            }, 3000);
        }

        function showError(message) {
            var alerts = document.getElementById('economicAlerts');
            var errorDiv = document.createElement('div');
            errorDiv.className = 'prosperity-notice error-notice';
            errorDiv.innerHTML = '‚ùå ' + message;
            alerts.appendChild(errorDiv);
            
            setTimeout(function() {
                if (errorDiv.parentNode) {
                    errorDiv.parentNode.removeChild(errorDiv);
                }
            }, 5000);
        }

        // ===== 10. ÂàùÂßãÂåñÁ®ãÂ∫è =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéÆ ÈÅäÊà≤ÂàùÂßãÂåñÈñãÂßã');
            
            // ÂâµÂª∫Âø´Ë®äÁ≥ªÁµ±ÂØ¶‰æã
            window.NewsAlertSystem = NewsAlertSystem;
            window.newsAlertSystem = new NewsAlertSystem();
            
            // ÂàùÂßãÂåñSocketÈÄ£Êé•
            initializeSocket();
            
            // Ë®≠ÁΩÆÊîøÁ≠ñÊåâÈàï‰∫ã‰ª∂
            setupPolicyButtons();
            
            // Ë®≠ÁΩÆÂúãÂÆ∂ÈÅ∏Êìá‰∫ã‰ª∂
            setupCountrySelection();
            
            console.log('‚úÖ ÈÅäÊà≤ÂàùÂßãÂåñÂÆåÊàêÔºåÁ≠âÂæÖÁî®Êà∂Êìç‰Ωú');
            
            // Ê∏¨Ë©¶Âø´Ë®äÁ≥ªÁµ±
            setTimeout(function() {
                if (window.newsAlertSystem && window.newsAlertSystem.isReady) {
                    window.newsAlertSystem.showAlert({
                        type: 'global',
                        category: 'good',
                        name: 'üéÆ Â§ÆË°åÊ®°Êì¨Âô®ÂïüÂãï',
                        description: 'Ê≠°Ëøé‰æÜÂà∞ÂÖ®ÁêÉÂ§ÆË°åÊ®°Êì¨Âô®ÔºÅÂø´Ë®äÁ≥ªÁµ±Â∑≤ÊàêÂäüËºâÂÖ•„ÄÇ',
                        effects: {},
                        season: 1
                    });
                    console.log('‚úÖ Ê∏¨Ë©¶Âø´Ë®äÈ°ØÁ§∫ÊàêÂäü');
                } else {
                    console.warn('‚ö†Ô∏è Âø´Ë®äÁ≥ªÁµ±ÂàùÂßãÂåñÊú™ÂÆåÊàê');
                }
            }, 2000);
        });
        // ===== 11. Èô§ÈåØÂ∑•ÂÖ∑ÔºàÊï¥ÂêàÁâàÊú¨ÔºåÂèñ‰ª£ÂéüÊúâÁöÑÈáçË§áÈÉ®ÂàÜÔºâ=====

        window.debugTools = {
            // Ê™¢Êü•Á≥ªÁµ±ÁãÄÊÖã
            checkSystem: function() {
                console.log('=== üîç Á≥ªÁµ±ÁãÄÊÖãÊ™¢Êü• ===');
                console.log('Socket ÈÄ£Êé•:', socket && socket.connected ? '‚úÖ Â∑≤ÈÄ£Êé•' : '‚ùå Êú™ÈÄ£Êé•');
                console.log('Âø´Ë®äÁ≥ªÁµ±:', window.newsAlertSystem && window.newsAlertSystem.isReady ? '‚úÖ Â∞±Á∑í' : '‚ùå Êú™Â∞±Á∑í');
                console.log('ÈÅäÊà≤ÁãÄÊÖã:', gameState.gameId ? '‚úÖ ÈÅäÊà≤‰∏≠' : '‚ùå Êú™ÈñãÂßã');
                console.log('Áé©ÂÆ∂ID:', gameState.playerId || 'Êú™Ë®≠ÂÆö');
                console.log('ÈÅ∏ÊìáÂúãÂÆ∂:', gameState.selectedCountry || 'Êú™ÈÅ∏Êìá');
                
                if (gameState.gameId) {
                    console.log('ÊàøÈñì‰ª£Á¢º:', gameState.gameId);
                    console.log('Áï∂ÂâçÂ≠£Â∫¶:', document.getElementById('currentQuarter')?.textContent || 'Êú™Áü•');
                    console.log('Áé©ÂÆ∂Êï∏Êìö:', gameState.playerData ? '‚úÖ Â∑≤ËºâÂÖ•' : '‚ùå Êú™ËºâÂÖ•');
                }
                
                return {
                    socket: socket && socket.connected,
                    newsSystem: window.newsAlertSystem && window.newsAlertSystem.isReady,
                    inGame: !!gameState.gameId,
                    playerData: !!gameState.playerData
                };
            },

            // Ê®°Êì¨ÂêÑÁ®Æ‰∫ã‰ª∂
            simulateEvent: function(type = 'global') {
                if (!window.newsAlertSystem || !window.newsAlertSystem.isReady) {
                    console.error('‚ùå Âø´Ë®äÁ≥ªÁµ±‰∏çÂèØÁî®');
                    return false;
                }

                var events = {
                    global_good: {
                        type: 'global',
                        category: 'good',
                        name: 'üåç ÂÖ®ÁêÉÁ∂ìÊøüÂæ©Áî¶',
                        description: 'ÂêÑÂúãÁ∂ìÊøüÊîøÁ≠ñÂçîË™øÊúâÊïàÔºåÂÖ®ÁêÉÁ∂ìÊøüÂ±ïÁèæÂº∑ÂãÅÂæ©Áî¶ÂãïËÉΩ',
                        effects: { gdp: 1.5, confidence: 15, inflation: -0.5 },
                        season: 3
                    },
                    global_bad: {
                        type: 'global',
                        category: 'bad',
                        name: 'üåç ÂÖ®ÁêÉË≤øÊòìÊà∞Áà≠',
                        description: '‰∏ªË¶ÅÁ∂ìÊøüÈ´îË≤øÊòìÊë©Êì¶Âä†ÂäáÔºåÂÖ®ÁêÉ‰æõÊáâÈèàÂèóÂà∞Âö¥ÈáçË°ùÊìä',
                        effects: { gdp: -2.0, confidence: -20, inflation: 1.5 },
                        season: 3
                    },
                    country: {
                        type: 'country',
                        country: gameState.playerData?.country_name || 'ÁæéÂúã',
                        category: 'good',
                        name: 'üè≥Ô∏è ÊîøÁ≠ñÊîπÈù©ÊàêÂäü',
                        description: 'ÈáçÂ§ßÁ∂ìÊøüÊîπÈù©ÂèñÂæóÈ°ØËëóÊàêÊïàÔºåÂúãÈöõË©ïÁ¥öÊ©üÊßã‰∏äË™ø‰ø°Áî®Ë©ïÁ¥ö',
                        effects: { gdp: 1.8, confidence: 12, deficit: -1.0 },
                        season: 3
                    }
                };

                var eventToShow;
                switch(type) {
                    case 'global_good':
                        eventToShow = events.global_good;
                        break;
                    case 'global_bad':
                        eventToShow = events.global_bad;
                        break;
                    case 'country':
                        eventToShow = events.country;
                        break;
                    default:
                        eventToShow = events.global_good;
                }

                console.log('üéÆ Ê®°Êì¨‰∫ã‰ª∂:', eventToShow.name);
                window.newsAlertSystem.showAlert(eventToShow);
                return true;
            },

            // Âº∑Âà∂Âà∑Êñ∞ÈÅäÊà≤ÁãÄÊÖã
            forceRefresh: function() {
                console.log('üîÑ Âº∑Âà∂Âà∑Êñ∞ÈÅäÊà≤ÁãÄÊÖã...');
                if (gameState.playerData) {
                    updateMyCountryPanel();
                    updateActiveSkillPanel();
                    console.log('‚úÖ Âà∑Êñ∞ÂÆåÊàê');
                } else {
                    console.warn('‚ö†Ô∏è ÁÑ°Áé©ÂÆ∂Êï∏ÊìöÂèØÂà∑Êñ∞');
                }
            },

            // Ê∏¨Ë©¶ÂÜ∑ÂçªÁ≥ªÁµ±
            testCooldowns: function() {
                console.log('üß™ Ê∏¨Ë©¶ÂÜ∑ÂçªÁ≥ªÁµ±...');
                var testCooldowns = {
                    global_policy_cooldown: 5,
                    active_skill: 2
                };
                updatePolicyCooldowns(testCooldowns);
                console.log('‚úÖ ÂÜ∑ÂçªÊ∏¨Ë©¶ÂÆåÊàêÔºå5ÁßíÂæåËá™ÂãïÈáçÁΩÆ');
                setTimeout(function() {
                    updatePolicyCooldowns({ global_policy_cooldown: 0, active_skill: 0 });
                    console.log('üîÑ ÂÜ∑ÂçªÁ≥ªÁµ±Â∑≤ÈáçÁΩÆ');
                }, 5000);
            }
        };

        // ÁÇ∫‰∫ÜÂêëÂæåÁõ∏ÂÆπÔºå‰øùÁïô‰∏Ä‰∫õËàäÁöÑÂáΩÊï∏Âêç
        window.checkEventSystem = window.debugTools.checkSystem;
        window.debugGameState = window.debugTools.checkSystem;
        window.simulateGameEvent = function() { return window.debugTools.simulateEvent('global_good'); };
        window.testNewsAlert = function() { return window.debugTools.simulateEvent('country'); };

        // Âè™‰øùÁïô‰∏ÄÊ¨°ËºâÂÖ•ÂÆåÊàêË®äÊÅØ
        console.log('üéØ Â§ÆË°åÊ®°Êì¨Âô®ËºâÂÖ•ÂÆåÊàêÔºÅ');
        console.log('üí° Èô§ÈåØÊåá‰ª§Ôºö');
        console.log('  - debugTools.checkSystem() Ê™¢Êü•Á≥ªÁµ±ÁãÄÊÖã');
        console.log('  - debugTools.simulateEvent("global_good") Ê®°Êì¨ÂÖ®ÁêÉÂ•Ω‰∫ã‰ª∂');
        console.log('  - debugTools.simulateEvent("global_bad") Ê®°Êì¨ÂÖ®ÁêÉÂ£û‰∫ã‰ª∂');
        console.log('  - debugTools.simulateEvent("country") Ê®°Êì¨ÂúãÂÆ∂‰∫ã‰ª∂');
        console.log('  - debugTools.forceRefresh() Âº∑Âà∂Âà∑Êñ∞ÁïåÈù¢');
        console.log('  - debugTools.testCooldowns() Ê∏¨Ë©¶ÂÜ∑ÂçªÁ≥ªÁµ±');
        console.log('üöÄ ÈñãÂßãÊÇ®ÁöÑÂ§ÆË°åË°åÈï∑‰πãÊóÖÔºÅ');

        // Ë©ïÂàÜÁ≥ªÁµ±Áõ∏ÈóúÂáΩÊï∏
        function showCurrentStandings() {
            console.log('üìä Ë´ãÊ±ÇÁï∂ÂâçÊéíÂêç');
            socket.emit('request_standings');
            document.getElementById('scoringPanel').style.display = 'block';
        }

        function toggleScoringPanel() {
            const panel = document.getElementById('scoringPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        function setGameDuration() {
            const duration = document.getElementById('gameDuration').value;
            socket.emit('set_game_duration', { quarters: parseInt(duration) });
        }

        function updateStandingsDisplay(standings, quarter) {
            const standingsList = document.getElementById('standingsList');
            if (!standingsList) {
                console.error('‚ùå Êâæ‰∏çÂà∞ÊéíÂêçÂàóË°®ÂÆπÂô®');
                return;
            }
            
            standingsList.innerHTML = '';
            
            if (!standings || standings.length === 0) {
                standingsList.innerHTML = '<div style="text-align: center; color: #6c757d; padding: 20px;">Êö´ÁÑ°Ë©ïÂàÜÊï∏Êìö</div>';
                return;
            }
            
            standings.forEach((player, index) => {
                const standingItem = document.createElement('div');
                standingItem.className = 'standing-item';
                standingItem.style.cssText = `
                    display: flex;
                    align-items: center;
                    padding: 15px;
                    margin-bottom: 10px;
                    background: #f8f9fa;
                    border-radius: 8px;
                    border-left: 4px solid #007bff;
                    cursor: pointer;
                    transition: all 0.3s;
                `;
                
                // Ë®≠ÁΩÆË©ïÁ¥öÈ°èËâ≤
                const gradeColors = {
                    'S': '#ffd700',
                    'A': '#c0c0c0', 
                    'B': '#cd7f32',
                    'C': '#4CAF50',
                    'D': '#ff9800',
                    'F': '#f44336'
                };
                const gradeTextColors = {
                    'S': '#000', 'A': '#000', 'B': '#fff',
                    'C': '#fff', 'D': '#fff', 'F': '#fff'
                };
                
                standingItem.innerHTML = `
                    <div class="ranking">
                        <span class="rank">#${index + 1}</span>
                        <span class="grade grade-${player.grade}" style="
                            padding: 4px 8px;
                            border-radius: 4px;
                            font-size: 12px;
                            font-weight: bold;
                            margin-left: 8px;
                            background: ${gradeColors[player.grade] || '#6c757d'};
                            color: ${gradeTextColors[player.grade] || '#fff'};
                        ">${player.grade}</span>
                    </div>
                    <div class="player-info">
                        <span class="flag">${player.country_flag || 'üè≥Ô∏è'}</span>
                        <span class="name">${player.player_name || 'Êú™Áü•Áé©ÂÆ∂'}</span>
                        <span class="country">${player.country_name || 'Êú™Áü•ÂúãÂÆ∂'}</span>
                    </div>
                    <div class="score">
                        <span class="total-score">${(player.total_score || 0).toFixed(1)}</span>
                        <span class="score-label">ÂàÜ</span>
                        <div style="font-size: 12px; color: #6c757d;">Á¨¨${quarter}Â≠£</div>
                    </div>
                `;
                
                // Ê∑ªÂä†hoverÊïàÊûú
                standingItem.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = '#e9ecef';
                    this.style.transform = 'translateY(-2px)';
                });
                
                standingItem.addEventListener('mouseleave', function() {
                    this.style.backgroundColor = '#f8f9fa';
                    this.style.transform = 'translateY(0)';
                });
                
                // ÈªûÊìäÈ°ØÁ§∫Ë©≥Á¥∞Ë©ïÂàÜ
                standingItem.addEventListener('click', () => {
                    showScoreDetails(player);
                });
                
                standingsList.appendChild(standingItem);
            });
            
            console.log('‚úÖ ÊéíÂêçÈ°ØÁ§∫Êõ¥Êñ∞ÂÆåÊàê');
        }


        function showScoreDetails(player) {
            const details = player.details || {};
            const detailsContainer = document.getElementById('scoringDetails');
            
            if (!detailsContainer) {
                console.error('‚ùå Êâæ‰∏çÂà∞Ë©ïÂàÜË©≥ÊÉÖÂÆπÂô®');
                return;
            }
            
            detailsContainer.innerHTML = `
                <div style="padding: 20px; background: white; border-radius: 8px; margin-top: 15px; border: 1px solid #dee2e6;">
                    <h4 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                        <span style="font-size: 24px; margin-right: 10px;">${player.country_flag || 'üè≥Ô∏è'}</span>
                        ${player.player_name || 'Êú™Áü•Áé©ÂÆ∂'} Ë©≥Á¥∞Ë©ïÂàÜ
                    </h4>
                    <div class="score-breakdown">
                        <div class="score-section" style="margin-bottom: 15px;">
                            <h5 style="color: #007bff; margin-bottom: 10px;">üìä ÂÖ±ÈÄöÊåáÊ®ô (490ÂàÜ)</h5>
                            <div class="score-item">GDPÊàêÈï∑Áéá: ${(details.gdp_growth || 0).toFixed(1)}/98ÂàÜ</div>
                            <div class="score-item">ÈÄöËÜ®Áéá: ${(details.inflation || 0).toFixed(1)}/98ÂàÜ</div>
                            <div class="score-item">Â§±Ê•≠Áéá: ${(details.unemployment || 0).toFixed(1)}/74ÂàÜ</div>
                            <div class="score-item">Ê∞ëÁúæ‰ø°ÂøÉ: ${(details.confidence || 0).toFixed(1)}/74ÂàÜ</div>
                            <div class="score-item">ÈáëËûçÁ©©ÂÆö: ${(details.financial_stability || 0).toFixed(1)}/49ÂàÜ</div>
                            <div class="score-item">Ë≤°ÊîøÁãÄÊ≥Å: ${(details.fiscal_deficit || 0).toFixed(1)}/49ÂàÜ</div>
                            <div class="score-item">CPIÁ©©ÂÆö: ${(details.cpi_stability || 0).toFixed(1)}/49ÂàÜ</div>
                        </div>
                        <div class="score-section" style="margin-bottom: 15px;">
                            <h5 style="color: #ffc107; margin-bottom: 10px;">üåü ÂúãÂÆ∂ÁâπËâ≤ (210ÂàÜ)</h5>
                            <div class="score-item">ÁâπËâ≤Âä†ÂàÜ: ${(details.country_bonus || 0).toFixed(1)}/210ÂàÜ</div>
                        </div>
                        <div class="score-section" style="margin-bottom: 15px;">
                            <h5 style="color: #28a745; margin-bottom: 10px;">üèÖ Áõ∏Â∞çË°®ÁèæÁçéÂãµ</h5>
                            <div class="score-item">Áõ∏Â∞çÁçéÂãµ: +${(details.relative_bonus || 0).toFixed(1)}ÂàÜ</div>
                        </div>
                        <div class="total-section" style="padding: 15px; background: #f8f9fa; border-radius: 6px; text-align: center; border: 2px solid #007bff;">
                            <strong style="font-size: 18px; color: #007bff;">
                                Á∏ΩÂàÜ: ${(player.total_score || 0).toFixed(1)}/700ÂàÜ (${player.grade || 'F'}Á¥ö)
                            </strong>
                        </div>
                    </div>
                </div>
            `;
            
            console.log('‚úÖ Ë©≥Á¥∞Ë©ïÂàÜÈ°ØÁ§∫ÂÆåÊàê');
        }

        function showFinalResults(finalScores) {
            // ÂâµÂª∫ÊúÄÁµÇÁµêÊûúÂΩàÁ™ó
            const modal = document.createElement('div');
            modal.className = 'final-results-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2>üèÜ ÊúÄÁµÇË©ïÂàÜÁµêÊûú</h2>
                    <div class="final-standings">
                        ${finalScores.map((player, index) => `
                            <div class="final-ranking ${index === 0 ? 'winner' : ''}">
                                <span class="position">${index + 1}</span>
                                <span class="flag">${player.country_flag}</span>
                                <span class="name">${player.player_name}</span>
                                <span class="score">${player.total_score.toFixed(1)}ÂàÜ</span>
                                <span class="grade grade-${player.grade}">${player.grade}Á¥ö</span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="modal-actions">
                        <button onclick="closeModal(this)" class="btn btn-primary">ÈóúÈñâ</button>
                        <button onclick="location.reload()" class="btn btn-success">ÈáçÊñ∞ÈñãÂßã</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function closeModal(button) {
            const modal = button.closest('.final-results-modal');
            if (modal) {
                document.body.removeChild(modal);
            }
        }

        // Âú®ÁèæÊúâÁöÑÂàùÂßãÂåñÂáΩÊï∏‰∏≠Á¢∫‰øùË©ïÂàÜÊåâÈàïÂèØÁî®
        document.addEventListener('DOMContentLoaded', function() {
            // ÁèæÊúâÁöÑÂàùÂßãÂåñ‰ª£Á¢º...
            
            // Á¢∫‰øùË©ïÂàÜÊåâÈàïÂú®ÈÅäÊà≤ÈñãÂßãÂæåÂèØË¶ã
            console.log('üéØ Ë©ïÂàÜÁ≥ªÁµ±ÂàùÂßãÂåñÂÆåÊàê');
        });
    </script>
</body>
</html>