<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¦ å…¨çƒå¤®è¡Œæ¨¡æ“¬å™¨</title>
    
    <!-- Socket.IO CDN -->
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #2c3e50;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* éŠæˆ²ä¸»ä»‹é¢ä½ˆå±€ */
        .game-content {
            display: none;
        }

        .game-interface {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 20px;
            margin-top: 20px;
        }

        .side-panel, .main-panel, .controls-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            height: fit-content;
        }

        /* æ™‚é–“é¡¯ç¤º */
        .time-display {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border-radius: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255,255,255,0.3);
            border-radius: 6px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #fff;
            border-radius: 6px;
            transition: all 0.3s ease;
            width: 0%;
        }

        /* å…¨å±€ç‹€æ…‹ */
        .global-status {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }

        /* ä¸»å‹•æŠ€èƒ½é¢æ¿ */
        .active-skill-panel {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 3px solid #3498db;
        }

        .skill-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* æŒ‡æ¨™ç¶²æ ¼ */
        .indicators-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .indicator {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .indicator.positive {
            border-color: #27ae60;
            background: linear-gradient(135deg, #d5f4e6, #f8f9fa);
        }

        .indicator.negative {
            border-color: #e74c3c;
            background: linear-gradient(135deg, #fadbd8, #f8f9fa);
        }

        .indicator-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
        }

        .indicator-value {
            font-size: 1.4em;
            font-weight: bold;
            color: #2c3e50;
        }

        /* æ”¿ç­–å·¥å…·é¢æ¿ */
        .tool-group {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #3498db;
        }

        .tool-group h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .tool-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .tool-controls label {
            min-width: 80px;
            font-weight: bold;
        }

        .tool-controls input[type="range"] {
            flex: 1;
            margin: 0 10px;
        }

        .value-display {
            min-width: 80px;
            text-align: center;
            font-weight: bold;
            color: #3498db;
            background: #f8f9fa;
            padding: 5px 10px;
            border-radius: 6px;
            border: 2px solid #3498db;
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 5px;
            position: relative;
            overflow: hidden;
            width: 100%;
        }

        .btn-primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-skill {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
            color: white;
            font-size: 1em;
            padding: 15px 20px;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-cooldown {
            background: #95a5a6 !important;
            cursor: not-allowed !important;
            position: relative;
            overflow: hidden;
        }

        /* å†·å»ç³»çµ±æ¨£å¼ */
        .cooldown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: rgba(231, 76, 60, 0.9);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            font-weight: bold;
            transition: width 0.1s linear;
            z-index: 2;
        }

        .cooldown-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 4px;
            background: #e74c3c;
            transition: width 0.1s linear;
            z-index: 1;
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        /* åœ‹å®¶é¸æ“‡ç•«é¢ */
        .country-selection {
            text-align: center;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }

        .country-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .country-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }

        .country-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            border-color: #3498db;
        }

        .country-card.selected {
            border-color: #e74c3c;
            background: linear-gradient(135deg, #fff, #f8f9fa);
        }

        .country-flag-large {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .country-card h2 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .skill-preview {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: left;
        }

        .skill-preview h4 {
            color: #e74c3c;
            margin-bottom: 8px;
        }

        .btn-start {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 30px;
        }

        .btn-start:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-start:not(:disabled):hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(39, 174, 96, 0.4);
        }

        /* ç­‰å¾…å¤§å»³ */
        .waiting-lobby {
            display: none;
            text-align: center;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }

        .players-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .player-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #3498db;
        }

        .player-card.host {
            border-left-color: #e74c3c;
            background: linear-gradient(135deg, #fff, #ffe6e6);
        }

        /* éŠæˆ²æ—¥èªŒ */
        .game-log {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
        }

        .log-entry {
            padding: 8px;
            margin-bottom: 5px;
            background: white;
            border-radius: 6px;
            border-left: 3px solid #3498db;
            font-size: 0.9em;
        }

        /* å…¶ä»–ç©å®¶åˆ—è¡¨ */
        .other-player {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #3498db;
        }

        .player-name {
            font-weight: bold;
            margin-bottom: 8px;
        }

        .player-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 0.85em;
        }

        .stat {
            background: white;
            padding: 5px;
            border-radius: 4px;
            text-align: center;
        }

        .stat.confidential {
            background: #95a5a6 !important;
            color: white !important;
            font-style: italic;
        }

        /* ç¶“æ¿Ÿè­¦å ± */
        #economicAlerts {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 300px;
            z-index: 1000;
        }

        .prosperity-notice {
            padding: 12px 16px;
            margin: 5px 0;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            animation: slideInFromRight 0.3s ease-out;
        }

        .success-notice {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        }

        .error-notice {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
        }

        @keyframes slideInFromRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* å¿«è¨Šç³»çµ±æ¨£å¼ */
        .news-alert-container {
            position: fixed !important;
            top: 20px !important;
            left: 50% !important;
            transform: translateX(-50%) !important;
            z-index: 10000 !important;
            max-width: 500px !important;
            width: 90% !important;
        }
        
        .news-alert {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: newsSlideDown 0.5s ease-out;
            position: relative;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .news-alert.global-good {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        }
        
        .news-alert.global-bad {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
        }
        
        .news-alert.country-good {
            background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%);
        }
        
        .news-alert.country-bad {
            background: linear-gradient(135deg, #F44336 0%, #E91E63 100%);
        }
        
        @keyframes newsSlideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .news-alert-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .news-alert-title {
            font-size: 18px;
            font-weight: bold;
            margin: 0;
            line-height: 1.3;
            flex: 1;
        }
        
        .news-alert-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            color: white;
            font-size: 16px;
            font-weight: bold;
            margin-left: 10px;
            transition: background 0.2s;
        }
        
        .news-alert-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .news-alert-description {
            font-size: 15px;
            line-height: 1.4;
            margin-bottom: 15px;
            opacity: 0.95;
        }
        
        .news-alert-effects {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .effect-tag {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .news-alert-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 4px;
            background: rgba(255, 255, 255, 0.5);
            transition: width 5s linear;
            width: 100%;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 1200px) {
            .game-interface {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            .indicators-grid {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                flex-direction: column;
            }
        }

       /* è©•åˆ†é¢æ¿æ¨£å¼ */
        .scoring-panel {
            position: fixed;
            top: 10%;
            right: 20px;
            width: 400px;
            max-height: 80vh;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            overflow-y: auto;
        }

        .scoring-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 2px solid #eee;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px 10px 0 0;
        }

        .standing-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .standing-item:hover {
            background-color: #e9ecef !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .ranking {
            display: flex;
            align-items: center;
            min-width: 60px;
        }

        .rank {
            font-weight: bold;
            font-size: 18px;
            margin-right: 8px;
        }

        .grade {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .grade-S { background: #ffd700; color: #000; }
        .grade-A { background: #c0c0c0; color: #000; }
        .grade-B { background: #cd7f32; color: #fff; }
        .grade-C { background: #4CAF50; color: #fff; }
        .grade-D { background: #ff9800; color: #fff; }
        .grade-F { background: #f44336; color: #fff; }

        .player-info {
            flex: 1;
            margin-left: 10px;
        }

        .player-info .flag {
            font-size: 20px;
        }
        
        .player-info .name {
            font-weight: bold;
        }
        
        .player-info .country {
            color: #6c757d;
        }

        .score {
            text-align: right;
            font-weight: bold;
            font-size: 16px;
            color: #007bff;
        }
        .score-breakdown {
            padding: 15px;
        }

        .score-section {
            margin-bottom: 15px;
        }

        .score-item {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }

        .final-results-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            min-width: 500px;
            max-width: 90vw;
        }

        .final-ranking.winner {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
            font-weight: bold;
            border-radius: 8px;
            margin-bottom: 5px;
            padding: 10px;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ç¶“æ¿Ÿè­¦å ±å€åŸŸ -->
        <div id="economicAlerts"></div>

        <!-- åœ‹å®¶é¸æ“‡ç•«é¢ -->
        <div class="country-selection" id="countrySelection">
            <h1>ğŸŒ é¸æ“‡ä½ è¦æ‰®æ¼”çš„åœ‹å®¶</h1>
            <div class="country-cards">
                <div class="country-card" data-country="USA">
                    <div class="country-flag-large">ğŸ‡ºğŸ‡¸</div>
                    <h2>ç¾åœ‹</h2>
                    <div class="country-description">
                        <p><strong>ç‰¹è‰²ï¼š</strong>å…¨çƒéœ¸ä¸»ï¼Œæ”¿ç­–å½±éŸ¿å…¨ä¸–ç•Œ</p>
                        <p><strong>å„ªå‹¢ï¼š</strong>ç¾å…ƒéœ¸æ¬Šï¼Œæ”¿ç­–å‚³å°åŠ›å¼·</p>
                        <p><strong>æŒ‘æˆ°ï¼š</strong>å…¨çƒè²¬ä»»é‡å¤§ï¼Œæ”¿ç­–å¤±èª¤å½±éŸ¿å»£</p>
                        <div class="skill-preview">
                            <h4>âš”ï¸ å°ˆå±¬æŠ€èƒ½ï¼šç¶“æ¿Ÿåˆ¶è£</h4>
                            <p>å°ç›®æ¨™åœ‹å®¶å¯¦æ–½åš´å²åˆ¶è£ï¼Œé€ æˆæŒçºŒ2å­£çš„é¡¯è‘—è² é¢å½±éŸ¿ï¼Œä½†æœ‰35%æ©Ÿç‡åå™¬è‡ªèº«</p>
                        </div>
                    </div>
                </div>
                
                <div class="country-card" data-country="CHN">
                    <div class="country-flag-large">ğŸ‡¨ğŸ‡³</div>
                    <h2>ä¸­åœ‹</h2>
                    <div class="country-description">
                        <p><strong>ç‰¹è‰²ï¼š</strong>ä¸–ç•Œå·¥å» ï¼Œé«˜é€Ÿç™¼å±•ä¸­ç¶“æ¿Ÿé«”</p>
                        <p><strong>å„ªå‹¢ï¼š</strong>æ”¿ç­–åŸ·è¡ŒåŠ›å¼·ï¼Œæˆé•·æ½›åŠ›å¤§</p>
                        <p><strong>æŒ‘æˆ°ï¼š</strong>çµæ§‹è½‰å‹å£“åŠ›ï¼Œå¤–éƒ¨ä¾è³´åº¦é«˜</p>
                        <div class="skill-preview">
                            <h4>ğŸš€ å°ˆå±¬æŠ€èƒ½ï¼šäººå¤šå¥½è¾¦äº‹</h4>
                            <p>é›†ä¸­åŠ›é‡è¾¦å¤§äº‹ï¼Œå¯¦ç¾é‡å¤§ç§‘æŠ€çªç ´ï¼Œå¤§å¹…æå‡GDPæˆé•·å’Œæ°‘çœ¾ä¿¡å¿ƒï¼Œç„¡æ˜é¡¯å‰¯ä½œç”¨</p>
                        </div>
                    </div>
                </div>
                
                <div class="country-card" data-country="JPN">
                    <div class="country-flag-large">ğŸ‡¯ğŸ‡µ</div>
                    <h2>æ—¥æœ¬</h2>
                    <div class="country-description">
                        <p><strong>ç‰¹è‰²ï¼š</strong>æˆç†Ÿç™¼é”ç¶“æ¿Ÿé«”ï¼ŒæŠ€è¡“å…ˆé€²</p>
                        <p><strong>å„ªå‹¢ï¼š</strong>è²¨å¹£æ”¿ç­–ç¶“é©—è±å¯Œï¼ŒæŠ€è¡“é ˜å…ˆ</p>
                        <p><strong>æŒ‘æˆ°ï¼š</strong>äººå£è€åŒ–ï¼Œé€šç¸®é¢¨éšª</p>
                        <div class="skill-preview">
                            <h4>ğŸ¯ å°ˆå±¬æŠ€èƒ½ï¼šæ”¹å–„è€äººå°±æ¥­å•é¡Œ</h4>
                            <p>é€éæ•¸ä½åŒ–åŸ¹è¨“å’Œå½ˆæ€§å·¥ä½œåˆ¶åº¦ï¼Œæå‡é«˜é½¡å‹å‹•åƒèˆ‡ç‡ï¼Œè§£æ±ºé€šç¸®å’Œä¿¡å¿ƒå•é¡Œ</p>
                        </div>
                    </div>
                </div>

                <div class="country-card" data-country="TWN">
                    <div class="country-flag-large">ğŸ‡¹ğŸ‡¼</div>
                    <h2>å°ç£</h2>
                    <div class="country-description">
                        <p><strong>ç‰¹è‰²ï¼š</strong>å°è€Œç¾ç¶“æ¿Ÿé«”ï¼Œéˆæ´»æ‡‰è®Š</p>
                        <p><strong>å„ªå‹¢ï¼š</strong>ç§‘æŠ€è£½é€ æ¥­ç™¼é”ï¼Œæ”¿ç­–å½ˆæ€§é«˜</p>
                        <p><strong>æŒ‘æˆ°ï¼š</strong>æ˜“å—å¤–éƒ¨è¡æ“Šï¼Œå…§éœ€å¸‚å ´å°</p>
                        <div class="skill-preview">
                            <h4>ğŸ² å°ˆå±¬æŠ€èƒ½ï¼šå¤¾ç¸«ä¸­æ±‚ç”Ÿå­˜</h4>
                            <p>é¸æ“‡æ­ä¹˜æŸåœ‹ç¶“æ¿Ÿé †é¢¨è»Šï¼Œè‹¥è©²åœ‹è¡¨ç¾è‰¯å¥½å‰‡ç²å¾—é¡å¤–æ”¶ç›Šï¼Œé«”ç¾å°åœ‹éˆæ´»å¤–äº¤</p>
                        </div>
                    </div>
                </div>

                <div class="country-card" data-country="BRA">
                    <div class="country-flag-large">ğŸ‡§ğŸ‡·</div>
                    <h2>å·´è¥¿</h2>
                    <div class="country-description">
                        <p><strong>ç‰¹è‰²ï¼š</strong>æ–°èˆˆå¸‚å ´ä»£è¡¨ï¼Œè³‡æºè±å¯Œ</p>
                        <p><strong>å„ªå‹¢ï¼š</strong>è‡ªç„¶è³‡æºè±å¯Œï¼Œå…§éœ€å¸‚å ´é¾å¤§</p>
                        <p><strong>æŒ‘æˆ°ï¼š</strong>è²ªè…å•é¡Œåš´é‡ï¼Œæ”¿ç­–ä¸ç©©å®š</p>
                        <div class="skill-preview">
                            <h4>âš–ï¸ å°ˆå±¬æŠ€èƒ½ï¼šåè²ªè…è¡Œå‹•</h4>
                            <p>ç™¼å‹•å¤§è¦æ¨¡åè²ªè…é‹å‹•ï¼Œå¤§å¹…æå‡æ”¿åºœæ•ˆèƒ½å’Œæ°‘çœ¾ä¿¡å¿ƒï¼Œæ”¹å–„è²¡æ”¿ç‹€æ³</p>
                        </div>
                    </div>
                </div>

                <div class="country-card" data-country="SAU">
                    <div class="country-flag-large">ğŸ‡¸ğŸ‡¦</div>
                    <h2>æ²™çƒåœ°é˜¿æ‹‰ä¼¯</h2>
                    <div class="country-description">
                        <p><strong>ç‰¹è‰²ï¼š</strong>çŸ³æ²¹å¤§åœ‹ï¼Œè½‰å‹ä¸­ç¶“æ¿Ÿ</p>
                        <p><strong>å„ªå‹¢ï¼š</strong>çŸ³æ²¹è³‡æºæ§åˆ¶åŠ›ï¼Œè²¡æ”¿å……è£•</p>
                        <p><strong>æŒ‘æˆ°ï¼š</strong>éåº¦ä¾è³´çŸ³æ²¹ï¼Œå¤šå…ƒåŒ–æ€¥éœ€</p>
                        <div class="skill-preview">
                            <h4>ğŸ­ å°ˆå±¬æŠ€èƒ½ï¼šç”¢æ¥­è½‰å‹</h4>
                            <p>æ¨é€²ç¶“æ¿Ÿå¤šå…ƒåŒ–ï¼Œé€æ­¥é™ä½çŸ³æ²¹ä¾è³´åº¦ï¼Œå»ºç«‹å¯æŒçºŒç™¼å±•çš„ç¶“æ¿Ÿçµæ§‹</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="game-room-controls">
                <div style="margin: 20px 0;">
                    <input type="text" id="playerNameInput" placeholder="è¼¸å…¥ä½ çš„åç¨±" style="padding: 10px; margin-right: 10px; border-radius: 8px; border: 2px solid #ddd;">
                    <button onclick="createGame()" class="btn btn-primary" id="createGameBtn">å‰µå»ºéŠæˆ²</button>
                </div>
                <div style="margin: 20px 0;">
                    <input type="text" id="gameIdInput" placeholder="è¼¸å…¥éŠæˆ²æˆ¿é–“ä»£ç¢¼" style="padding: 10px; margin-right: 10px; border-radius: 8px; border: 2px solid #ddd;">
                    <button onclick="joinGame()" class="btn btn-success" id="joinGameBtn">åŠ å…¥éŠæˆ²</button>
                </div>
            </div>
        </div>

        <!-- ç­‰å¾…å¤§å»³ -->
        <div class="waiting-lobby" id="waitingLobby">
            <h1>ğŸ® éŠæˆ²å¤§å»³</h1>
            <p>æˆ¿é–“ä»£ç¢¼ï¼š<strong id="roomCode">-</strong></p>
            <p>ç­‰å¾…å…¶ä»–ç©å®¶åŠ å…¥...</p>
            
            <h3>å·²åŠ å…¥ç©å®¶</h3>
            <div class="players-list" id="playersInLobby">
                <!-- å‹•æ…‹ç”Ÿæˆ -->
            </div>
            
            <button class="btn-start" id="startGameBtn" onclick="startGame()" disabled>é–‹å§‹éŠæˆ²</button>
        </div>

        <!-- éŠæˆ²ä¸»ç•Œé¢ -->
        <div class="game-content" id="gameContent">
            <h1 id="gameTitle">ğŸ¦ å…¨çƒå¤®è¡Œæ¨¡æ“¬å™¨</h1>
            
            <div class="game-interface">
                <!-- å·¦å´é¢æ¿ -->
                <div class="side-panel">
                    <div class="time-display">
                        <h3>â° ç¬¬ <span id="currentQuarter">1</span> å­£</h3>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <p>å‰©é¤˜æ™‚é–“ï¼š<span id="timeRemaining">0:30</span></p>
                    </div>

                    <div class="global-status">
                        <h4>ğŸ›¢ï¸ å…¨çƒçŸ³æ²¹åƒ¹æ ¼</h4>
                        <p id="globalOilPrice">$80.0</p>
                    </div>
                    
                    <h3>ğŸŒ å…¶ä»–ç©å®¶</h3>
                    <div id="otherPlayersList">
                        <!-- å‹•æ…‹ç”Ÿæˆ -->
                    </div>

                    <h3>ğŸ“° éŠæˆ²å‹•æ…‹</h3>
                    <div class="game-log" id="gameLogContainer">
                        <!-- å‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- ä¸­é–“é¢æ¿ -->
                <div class="main-panel">
                    <h2 id="myCountryTitle">ğŸ‡ºğŸ‡¸ ç¾åœ‹å¤®è¡Œ</h2>
                    
                    <div class="active-skill-panel" id="activeSkillPanel">
                        <h3 id="skillTitle">âš”ï¸ ç™¼å‹•è²¿æ˜“æˆ°çˆ­</h3>
                        <div class="skill-description" id="skillDescription">
                            å°ç›®æ¨™åœ‹å®¶ç™¼å‹•è²¿æ˜“æˆ°ï¼Œé€ æˆé‡å¤§ç¶“æ¿Ÿæå¤±ï¼Œä½†æœ‰35%æ©Ÿç‡åå™¬è‡ªèº«
                        </div>
                        <div class="skill-controls" id="skillControls">
                            <button class="btn btn-skill" id="activeSkillBtn">
                                <span class="cooldown-text">âš”ï¸ ç™¼å‹•æŠ€èƒ½</span>
                                <div class="cooldown-overlay" id="activeSkillCooldown" style="width: 0%;"></div>
                                <div class="cooldown-progress" id="activeSkillProgress" style="width: 0%;"></div>
                            </button>
                            
                            <!-- æ²™çƒåœ°å°ˆå±¬çŸ³æ²¹æ§åˆ¶æŒ‰éˆ•ï¼ˆé»˜èªéš±è—ï¼‰-->
                            <div id="saudiOilControls" style="display: none; margin-top: 15px;">
                                <h4 style="color: white; margin-bottom: 10px;">ğŸ›¢ï¸ çŸ³æ²¹ç”¢é‡æ§åˆ¶</h4>
                                <div style="display: flex; gap: 10px;">
                                    <button class="btn btn-warning" id="increaseOilBtn" style="flex: 1;">
                                        <span class="cooldown-text">ğŸ“ˆ å¢ç”¢é™åƒ¹</span>
                                        <div class="cooldown-overlay" id="increaseOilCooldown" style="width: 0%;"></div>
                                        <div class="cooldown-progress" id="increaseOilProgress" style="width: 0%;"></div>
                                    </button>
                                    <button class="btn btn-danger" id="decreaseOilBtn" style="flex: 1;">
                                        <span class="cooldown-text">ğŸ“‰ æ¸›ç”¢å‡åƒ¹</span>
                                        <div class="cooldown-overlay" id="decreaseOilCooldown" style="width: 0%;"></div>
                                        <div class="cooldown-progress" id="decreaseOilProgress" style="width: 0%;"></div>
                                    </button>
                                </div>
                                <p style="color: rgba(255,255,255,0.8); font-size: 0.9em; margin-top: 8px; text-align: center;">
                                    æ§åˆ¶å…¨çƒçŸ³æ²¹åƒ¹æ ¼ï¼Œå½±éŸ¿æ‰€æœ‰åœ‹å®¶ç¶“æ¿Ÿ
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="indicators-grid">
                        <div class="indicator" id="gdpIndicator">
                            <div class="indicator-label">ğŸ“Š GDPæˆé•·ç‡</div>
                            <div class="indicator-value" id="gdpGrowth">2.8%</div>
                        </div>
                        <div class="indicator" id="inflationIndicator">
                            <div class="indicator-label">ğŸ’¹ é€šè†¨ç‡</div>
                            <div class="indicator-value" id="inflation">2.1%</div>
                        </div>
                        <div class="indicator" id="unemploymentIndicator">
                            <div class="indicator-label">ğŸ‘¥ å¤±æ¥­ç‡</div>
                            <div class="indicator-value" id="unemployment">4.2%</div>
                        </div>
                        <div class="indicator" id="confidenceIndicator">
                            <div class="indicator-label">ğŸ˜Š æ°‘çœ¾ä¿¡å¿ƒ</div>
                            <div class="indicator-value" id="confidence">65</div>
                        </div>
                        <div class="indicator" id="deficitIndicator">
                            <div class="indicator-label">ğŸ’° è²¡æ”¿èµ¤å­—</div>
                            <div class="indicator-value" id="deficit">3.2%</div>
                        </div>
                        <div class="indicator" id="stockIndicator">
                            <div class="indicator-label">ğŸ“ˆ è‚¡åƒ¹æŒ‡æ•¸è®ŠåŒ–ç‡</div>
                            <div class="indicator-value" id="stockIndex">+2.5%</div>
                        </div>
                    </div>
                </div>

                <!-- å³å´é¢æ¿ -->
                <div class="controls-panel">
                    <h2>ğŸ› ï¸ æ”¿ç­–å·¥å…·</h2>
                    
                    <!-- åˆ©ç‡æ”¿ç­– -->
                    <div class="tool-group">
                        <h3>ğŸ’° åˆ©ç‡æ”¿ç­–</h3>
                        <div class="tool-controls">
                            <div class="value-display" id="interestRateValue">2.5%</div>
                            <input type="range" id="interestRateSlider" min="-2" max="20" step="0.25" value="2.5">
                        </div>
                        <button class="btn btn-primary" id="interestRateBtn">
                            <span class="cooldown-text">ğŸ¯ èª¿æ•´åˆ©ç‡</span>
                            <div class="cooldown-overlay" id="interestRateCooldown" style="width: 0%;"></div>
                            <div class="cooldown-progress" id="interestRateProgress" style="width: 0%;"></div>
                        </button>
                    </div>

                    <!-- å­˜æ¬¾æº–å‚™é‡‘ç‡ -->
                    <div class="tool-group">
                        <h3>ğŸ¦ å­˜æ¬¾æº–å‚™é‡‘ç‡</h3>
                        <div class="tool-controls">
                            <div class="value-display" id="reserveRatioValue">10%</div>
                            <input type="range" id="reserveRatioSlider" min="0" max="30" step="0.5" value="10">
                        </div>
                        <button class="btn btn-primary" id="reserveRatioBtn">
                            <span class="cooldown-text">ğŸ¦ èª¿æ•´æº–å‚™é‡‘ç‡</span>
                            <div class="cooldown-overlay" id="reserveRatioCooldown" style="width: 0%;"></div>
                            <div class="cooldown-progress" id="reserveRatioProgress" style="width: 0%;"></div>
                        </button>
                    </div>

                    <!-- è²¡æ”¿æ”¿ç­– -->
                    <div class="tool-group">
                        <h3>ğŸ›ï¸ è²¡æ”¿æ”¿ç­–</h3>
                        <div class="btn-group">
                            <button class="btn btn-success" id="increaseSpendingBtn">
                                <span class="cooldown-text">ğŸ“ˆ å¢åŠ æ”¯å‡º</span>
                                <div class="cooldown-overlay" id="increaseSpendingCooldown" style="width: 0%;"></div>
                                <div class="cooldown-progress" id="increaseSpendingProgress" style="width: 0%;"></div>
                            </button>
                            <button class="btn btn-warning" id="decreaseSpendingBtn">
                                <span class="cooldown-text">ğŸ“‰ æ¸›å°‘æ”¯å‡º</span>
                                <div class="cooldown-overlay" id="decreaseSpendingCooldown" style="width: 0%;"></div>
                                <div class="cooldown-progress" id="decreaseSpendingProgress" style="width: 0%;"></div>
                            </button>
                        </div>
                    </div>

                    <!-- é‡åŒ–å¯¬é¬†æ”¿ç­– -->
                    <div class="tool-group">
                        <h3>ğŸ›ï¸ é‡åŒ–å¯¬é¬†æ”¿ç­–</h3>
                        <div class="btn-group">
                            <button class="btn btn-success" id="qeBtn">
                                <span class="cooldown-text">ğŸ’¸ é‡åŒ–å¯¬é¬†</span>
                                <div class="cooldown-overlay" id="qeCooldown" style="width: 0%;"></div>
                                <div class="cooldown-progress" id="qeProgress" style="width: 0%;"></div>
                            </button>
                            <button class="btn btn-warning" id="qtBtn">
                                <span class="cooldown-text">ğŸ”’ é‡åŒ–ç·Šç¸®</span>
                                <div class="cooldown-overlay" id="qtCooldown" style="width: 0%;"></div>
                                <div class="cooldown-progress" id="qtProgress" style="width: 0%;"></div>
                            </button>
                        </div>
                    </div>

                    <!-- ç·Šæ€¥å·¥å…· -->
                    <div class="tool-group" style="background: linear-gradient(135deg, #ff6b6b, #ee5a24); color: white;">
                        <h3>ğŸš¨ ç·Šæ€¥æ”¿ç­–å·¥å…·</h3>
                        <button class="btn btn-danger" id="cashDistributionBtn">
                            <span class="cooldown-text">ğŸ’° ç·Šæ€¥æ™®ç™¼ç¾é‡‘</span>
                            <div class="cooldown-overlay" id="cashDistributionCooldown" style="width: 0%;"></div>
                            <div class="cooldown-progress" id="cashDistributionProgress" style="width: 0%;"></div>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- è©•åˆ†é¢æ¿ -->
        <div class="scoring-panel" id="scoringPanel" style="display: none;">
            <div class="scoring-header">
                <h3>ğŸ† è©•åˆ†æ’è¡Œæ¦œ</h3>
                <button onclick="toggleScoringPanel()" class="btn btn-secondary">é—œé–‰</button>
            </div>
            
            <div class="standings-container">
                <div class="standings-list" id="standingsList">
                    <!-- æ’åå°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
            
            <div class="scoring-details" id="scoringDetails">
                <!-- è©³ç´°è©•åˆ†å°‡åœ¨é€™è£¡é¡¯ç¤º -->
            </div>
        </div>

        <!-- åœ¨æ§åˆ¶é¢æ¿çš„æœ€å¾ŒåŠ å…¥è©•åˆ†æŒ‰éˆ• -->
        <div class="tool-group" style="border-left: 4px solid #f39c12;">
            <h3>ğŸ“Š éŠæˆ²çµ±è¨ˆ</h3>
            <button onclick="showCurrentStandings()" class="btn btn-warning" style="width: 100%;">
                ğŸ† æŸ¥çœ‹ç•¶å‰æ’å
            </button>
        </div>
    </div>

    <!-- å…§åµŒæ‰€æœ‰ JavaScript ç¨‹å¼ç¢¼ -->
    <script>
        console.log('ğŸ® é–‹å§‹è¼‰å…¥å¤®è¡Œæ¨¡æ“¬å™¨...');

        // ===== 1. å¿«è¨Šç³»çµ± =====
        function NewsAlertSystem() {
            this.alertContainer = null;
            this.currentAlert = null;
            this.autoCloseTimeout = null;
            this.isReady = false;
            
            console.log('ğŸ”§ åˆå§‹åŒ–å¿«è¨Šç³»çµ±...');
            this.init();
        }

        NewsAlertSystem.prototype.init = function() {
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', () => {
                    this.setupSystem();
                });
            } else {
                this.setupSystem();
            }
        };

        NewsAlertSystem.prototype.setupSystem = function() {
            this.createAlertContainer();
            this.isReady = true;
            console.log('âœ… å¿«è¨Šç³»çµ±åˆå§‹åŒ–å®Œæˆ');
        };

        NewsAlertSystem.prototype.createAlertContainer = function() {
            const existing = document.getElementById('news-alert-container');
            if (existing) {
                existing.remove();
            }
            
            this.alertContainer = document.createElement('div');
            this.alertContainer.id = 'news-alert-container';
            this.alertContainer.className = 'news-alert-container';
            this.alertContainer.style.display = 'none';
            
            document.body.appendChild(this.alertContainer);
            console.log('ğŸ“¦ å¿«è¨Šå®¹å™¨å·²å‰µå»º');
        };

        NewsAlertSystem.prototype.showAlert = function(event) {
            if (!this.isReady) {
                console.warn('âš ï¸ å¿«è¨Šç³»çµ±å°šæœªæº–å‚™å°±ç·’ï¼Œç¨å¾Œé‡è©¦...');
                setTimeout(() => this.showAlert(event), 500);
                return;
            }

            console.log('ğŸ“¢ é¡¯ç¤ºå¿«è¨Š:', event.name);
            
            if (this.currentAlert) {
                this.closeAlert();
            }
            
            const alertClass = this.getAlertClass(event);
            const typeIcon = this.getTypeIcon(event);
            const effectsHtml = this.formatEffects(event.effects);
            
            const alertElement = document.createElement('div');
            alertElement.className = 'news-alert ' + alertClass;
            
            alertElement.innerHTML = `
                <div class="news-alert-header">
                    <h3 class="news-alert-title">${typeIcon} ${event.name}</h3>
                    <button class="news-alert-close" onclick="window.newsAlertSystem.closeAlert()">Ã—</button>
                </div>
                <div class="news-alert-description">${event.description}</div>
                ${effectsHtml}
                <div class="news-alert-progress"></div>
            `;
            
            this.alertContainer.innerHTML = '';
            this.alertContainer.appendChild(alertElement);
            this.alertContainer.style.display = 'block';
            this.currentAlert = alertElement;
            
            setTimeout(() => {
                const progressBar = alertElement.querySelector('.news-alert-progress');
                if (progressBar) {
                    progressBar.style.width = '0%';
                }
            }, 100);
            
            this.autoCloseTimeout = setTimeout(() => {
                this.closeAlert();
            }, 5000);
            
            console.log('âœ… å¿«è¨Šé¡¯ç¤ºæˆåŠŸ');
        };

        NewsAlertSystem.prototype.closeAlert = function() {
            if (this.autoCloseTimeout) {
                clearTimeout(this.autoCloseTimeout);
                this.autoCloseTimeout = null;
            }
            
            if (this.alertContainer && this.currentAlert) {
                this.alertContainer.style.display = 'none';
                this.alertContainer.innerHTML = '';
            }
            
            this.currentAlert = null;
            console.log('ğŸ“ª å¿«è¨Šå·²é—œé–‰');
        };

        NewsAlertSystem.prototype.getAlertClass = function(event) {
            console.log('ğŸ¨ æ±ºå®šå¿«è¨Šæ¨£å¼:', event.type, event.category);
            
            if (event.type === 'global') {
                return event.category === 'good' ? 'global-good' : 'global-bad';
            } else if (event.type === 'country') {
                return event.category === 'good' ? 'country-good' : 'country-bad';
            } else {
                // é è¨­ç‚ºå…¨çƒå¥½æ¶ˆæ¯
                return 'global-good';
            }
        };

        NewsAlertSystem.prototype.getTypeIcon = function(event) {
            if (event.type === 'global') {
                return event.category === 'good' ? 'ğŸŒğŸ“ˆ' : 'ğŸŒâš ï¸';
            } else {
                const countryFlags = {
                    "ä¸­åœ‹": "ğŸ‡¨ğŸ‡³", "ç¾åœ‹": "ğŸ‡ºğŸ‡¸", "æ—¥æœ¬": "ğŸ‡¯ğŸ‡µ",
                    "å°ç£": "ğŸ‡¹ğŸ‡¼", "æ²™çƒåœ°é˜¿æ‹‰ä¼¯": "ğŸ‡¸ğŸ‡¦", "å·´è¥¿": "ğŸ‡§ğŸ‡·"
                };
                const flag = countryFlags[event.country] || "ğŸ³ï¸";
                const indicator = event.category === 'good' ? 'ğŸ“ˆ' : 'ğŸ“‰';
                return flag + indicator;
            }
        };

        NewsAlertSystem.prototype.formatEffects = function(effects) {
            if (!effects || Object.keys(effects).length === 0) {
                return '';
            }
            
            const effectTags = [];
            
            if (effects.gdp) {
                const sign = effects.gdp > 0 ? '+' : '';
                effectTags.push(`<span class="effect-tag">GDP ${sign}${effects.gdp.toFixed(1)}%</span>`);
            }
            
            if (effects.confidence) {
                const sign = effects.confidence > 0 ? '+' : '';
                effectTags.push(`<span class="effect-tag">ä¿¡å¿ƒ ${sign}${effects.confidence}</span>`);
            }
            
            if (effects.inflation) {
                const sign = effects.inflation > 0 ? '+' : '';
                effectTags.push(`<span class="effect-tag">é€šè†¨ ${sign}${effects.inflation.toFixed(1)}%</span>`);
            }
            
            return effectTags.length > 0 ? `<div class="news-alert-effects">${effectTags.join('')}</div>` : '';
        };

        // ===== 2. éŠæˆ²ç‹€æ…‹ç®¡ç† =====
        let socket;
        let gameState = {
            playerId: null,
            gameId: null,
            playerData: null,
            isHost: false,
            selectedCountry: null,
            policyCooldowns: {},
            allPlayers: {}
        };

        // ===== 3. åˆå§‹åŒ– Socket é€£æ¥ =====
        function initializeSocket() {
            socket = io();
            
            socket.on('connected', function(data) {
                gameState.playerId = data.player_id;
                console.log('ğŸ”— é€£æ¥æˆåŠŸï¼Œç©å®¶ID:', gameState.playerId);
            });

            socket.on('game_created', function(data) {
                console.log('ğŸ¯ éŠæˆ²å‰µå»ºæˆåŠŸ:', data);
                gameState.gameId = data.game_id;
                gameState.playerData = data.player_data;
                gameState.isHost = true;
                showWaitingLobby();
                showSuccess('éŠæˆ²æˆ¿é–“å‰µå»ºæˆåŠŸï¼æˆ¿é–“ä»£ç¢¼ï¼š' + data.game_id);
            });

            socket.on('player_joined', function(data) {
                console.log('ğŸ‘¥ ç©å®¶åŠ å…¥:', data);
                updatePlayersList(data.all_players);
                if (!gameState.isHost) {
                    showWaitingLobby();
                }
            });

            socket.on('game_started', function() {
                console.log('ğŸš€ éŠæˆ²é–‹å§‹');
                showGamePlay();
                showSuccess('éŠæˆ²é–‹å§‹ï¼ç¬¬1å­£è¨ˆæ™‚å™¨å·²å•Ÿå‹•');
                
                // ğŸ†• é¡å¤–çš„å»¶é²åˆ·æ–°ï¼Œç¢ºä¿æ‰€æœ‰æ•¸æ“šéƒ½å·²è¼‰å…¥
                setTimeout(function() {
                    if (gameState.playerData) {
                        forceRefreshPlayerPanel();
                        console.log('ğŸ¯ éŠæˆ²é–‹å§‹å¾Œé¡å¤–åˆ·æ–°å®Œæˆ');
                    }
                }, 2000);
            });

            socket.on('realtime_update', function(data) {
                updateTimeDisplay(data.progress, data.remaining_time);
                
                if (data.global_oil_price !== undefined) {
                    updateGlobalOilPrice(data.global_oil_price);
                }
                
                if (data.players_cooldowns) {
                    var myPlayerCooldown = data.players_cooldowns.find(function(p) {
                        return p.player_id === gameState.playerId;
                    });
                    if (myPlayerCooldown) {
                        updatePolicyCooldowns(myPlayerCooldown.cooldown_status);
                    }
                }
                
                if (data.players) {
                    updateAllPlayersRealtime(data.players);
                }
            });

            socket.on('quarter_advanced', function(data) {
                console.log('ğŸ“… æ”¶åˆ°å­£åº¦æ¨é€²äº‹ä»¶ï¼Œå®Œæ•´æ•¸æ“š:', data);
                
                updateQuarter(data.quarter);
                
                // ä½¿ç”¨å®Œæ•´æ—¥èªŒè€Œä¸æ˜¯æˆªæ–·ç‰ˆæœ¬
                var logsToShow = data.full_game_log || data.game_log || [];
                updateGameLog(logsToShow);
                
                updateAllPlayers(data.players);
                
                if (data.global_oil_price !== undefined) {
                    updateGlobalOilPrice(data.global_oil_price);
                }
                
                // ğŸ¯ ä¿®æ­£ï¼šæª¢æŸ¥äº‹ä»¶æ•¸æ“šçµæ§‹ä¸¦éæ¿¾é¡¯ç¤º
                console.log('ğŸ” æª¢æŸ¥äº‹ä»¶æ•¸æ“š:', {
                    hasTriggeredEvents: !!data.triggered_events,
                    eventsType: typeof data.triggered_events,
                    eventsIsArray: Array.isArray(data.triggered_events),
                    eventsLength: Array.isArray(data.triggered_events) ? data.triggered_events.length : 'N/A',
                    eventsContent: data.triggered_events
                });
                
                // æª¢æŸ¥äº‹ä»¶æ•¸æ“šæ ¼å¼
                var validEvents = [];
                if (data.triggered_events) {
                    if (Array.isArray(data.triggered_events)) {
                        validEvents = data.triggered_events;
                    } else if (typeof data.triggered_events === 'boolean' && data.triggered_events === true) {
                        console.error('âŒ å¾Œç«¯éŒ¯èª¤ï¼štriggered_events æ˜¯å¸ƒæ—å€¼è€Œä¸æ˜¯é™£åˆ—ï¼è«‹æª¢æŸ¥ app.py');
                        showError('å¾Œç«¯äº‹ä»¶æ•¸æ“šæ ¼å¼éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ app.py ä¸­çš„ advance_quarter å‡½æ•¸');
                    } else {
                        console.warn('âš ï¸ æœªé æœŸçš„äº‹ä»¶æ•¸æ“šæ ¼å¼:', typeof data.triggered_events);
                    }
                }
                
                if (validEvents.length > 0) {
                    console.log(`ğŸ¯ ç¬¬${data.quarter}å­£æ”¶åˆ° ${validEvents.length} å€‹æœ‰æ•ˆäº‹ä»¶`);
                    
                    // ğŸ†• éæ¿¾äº‹ä»¶ï¼šåªé¡¯ç¤ºå…¨çƒäº‹ä»¶å’Œè‡ªå·±åœ‹å®¶çš„äº‹ä»¶
                    var eventsToShow = validEvents.filter(function(event) {
                        if (event.type === 'global') {
                            return true; // å…¨çƒäº‹ä»¶é¡¯ç¤ºçµ¦æ‰€æœ‰äºº
                        } else if (event.type === 'country') {
                            // åœ‹å®¶äº‹ä»¶åªé¡¯ç¤ºçµ¦å°æ‡‰åœ‹å®¶çš„ç©å®¶
                            var myCountryName = getCountryNameChinese(gameState.playerData?.country_code);
                            return event.country === myCountryName;
                        }
                        return false;
                    });
                    
                    console.log(`ğŸ“¢ éæ¿¾å¾Œé¡¯ç¤º ${eventsToShow.length} å€‹äº‹ä»¶çµ¦ç•¶å‰ç©å®¶`);
                    
                    // é€å€‹è™•ç†éæ¿¾å¾Œçš„äº‹ä»¶
                    eventsToShow.forEach(function(event, index) {
                        console.log(`ğŸ“¢ è™•ç†äº‹ä»¶ ${index + 1}:`, event);
                        
                        // é©—è­‰äº‹ä»¶æ ¼å¼
                        if (!event.name || !event.description) {
                            console.warn('âš ï¸ äº‹ä»¶æ ¼å¼ä¸å®Œæ•´:', event);
                            return;
                        }
                        
                        // å»¶é²é¡¯ç¤ºï¼Œé¿å…å¿«è¨Šé‡ç–Š
                        setTimeout(function() {
                            if (window.newsAlertSystem && window.newsAlertSystem.isReady) {
                                try {
                                    window.newsAlertSystem.showAlert(event);
                                    console.log('âœ… å¿«è¨Šé¡¯ç¤ºæˆåŠŸ:', event.name);
                                } catch (error) {
                                    console.error('âŒ å¿«è¨Šé¡¯ç¤ºéŒ¯èª¤:', error);
                                    // å‚™ç”¨æ–¹æ¡ˆ
                                    showSuccess(`ğŸ“° ${event.name}: ${event.description}`);
                                }
                            } else {
                                console.warn('âš ï¸ å¿«è¨Šç³»çµ±æœªå°±ç·’ï¼Œä½¿ç”¨å‚™ç”¨é¡¯ç¤º');
                                showSuccess(`ğŸ“° ${event.name}: ${event.description}`);
                            }
                        }, index * 1500); // æ¯å€‹äº‹ä»¶é–“éš”1.5ç§’
                    });
                } else {
                    console.log(`ğŸ”„ ç¬¬${data.quarter}å­£æ²’æœ‰è§¸ç™¼ç‰¹æ®Šäº‹ä»¶`);
                }
                
                showQuarterTransition(data.quarter);
            });

            socket.on('game_update', function(data) {
                updateAllPlayers(data.players);
                updateGameLog(data.game_log);
                
                if (data.global_oil_price !== undefined) {
                    updateGlobalOilPrice(data.global_oil_price);
                }
            });

            socket.on('error', function(data) {
                showError(data.message);
            });

                // ğŸ”¥ åœ¨é€™è£¡æ·»åŠ è©•åˆ†ç³»çµ±ç›£è½å™¨
            socket.on('standings_update', function(data) {
                console.log('ğŸ“ˆ æ”¶åˆ°æ’åæ›´æ–°:', data);
                updateStandingsDisplay(data.standings, data.quarter);
            });

            socket.on('game_ended', function(data) {
                console.log('ğŸ éŠæˆ²çµæŸ:', data);
                showFinalResults(data.final_scores);
            });

            socket.on('game_duration_set', function(data) {
                console.log('â±ï¸ éŠæˆ²æ™‚é•·è¨­å®šç‚º:', data.quarters + 'å­£');
                showSuccess(`éŠæˆ²æ™‚é•·è¨­å®šç‚º ${data.quarters} å­£`);
            });
        }

        function getCountryNameChinese(countryCode) {
            var mapping = {
                'USA': 'ç¾åœ‹',
                'CHN': 'ä¸­åœ‹', 
                'JPN': 'æ—¥æœ¬',
                'TWN': 'å°ç£',
                'SAU': 'æ²™çƒåœ°é˜¿æ‹‰ä¼¯',
                'BRA': 'å·´è¥¿'
            };
            return mapping[countryCode] || countryCode;
        }        

        // ===== 4. æ”¿ç­–åŸ·è¡Œå‡½æ•¸ =====
        function executePolicy(actionType, additionalData) {
            if (!additionalData) additionalData = {};
            
            if (gameState.policyCooldowns) {
                var globalCooldown = gameState.policyCooldowns.global_policy_cooldown || 0;
                var activeSkillCooldown = gameState.policyCooldowns.active_skill || 0;
                
                var activeSkills = ['taiwan_bet', 'brazil_anticorruption', 'saudi_transformation', 
                                   'usa_trade_war', 'china_mass_mobilization', 'japan_aging_solution'];
                
                if (activeSkills.indexOf(actionType) !== -1) {
                    if (activeSkillCooldown > 0) {
                        showError('æŠ€èƒ½å†·å»ä¸­ï¼Œé‚„éœ€ç­‰å¾… ' + activeSkillCooldown + ' å­£');
                        return;
                    }
                } else {
                    if (globalCooldown > 0) {
                        var remaining = Math.ceil(globalCooldown);
                        showError('æ”¿ç­–å†·å»ä¸­ï¼Œé‚„éœ€ç­‰å¾… ' + remaining + ' ç§’æ‰èƒ½ç™¼å‹•ä¸‹å€‹æ”¿ç­–');
                        return;
                    }
                }
            }
            
            var policyData = {
                action_type: actionType
            };
            
            for (var key in additionalData) {
                policyData[key] = additionalData[key];
            }
            
            socket.emit('policy_action', policyData);
            console.log('ğŸ¯ åŸ·è¡Œæ”¿ç­–:', policyData);
        }

        // ===== 5. åœ‹å®¶é¸æ“‡è™•ç† =====
        function setupCountrySelection() {
            var countryCards = document.querySelectorAll('.country-card');
            for (var i = 0; i < countryCards.length; i++) {
                countryCards[i].addEventListener('click', function() {
                    var allCards = document.querySelectorAll('.country-card');
                    for (var j = 0; j < allCards.length; j++) {
                        allCards[j].classList.remove('selected');
                    }
                    this.classList.add('selected');
                    gameState.selectedCountry = this.dataset.country;
                    console.log('ğŸŒ é¸æ“‡åœ‹å®¶:', gameState.selectedCountry);
                });
            }
        }

        // ===== 6. éŠæˆ²æˆ¿é–“æ§åˆ¶å‡½æ•¸ =====
        function createGame() {
            var playerName = document.getElementById('playerNameInput').value.trim();
            
            if (!playerName) {
                showError('è«‹è¼¸å…¥ç©å®¶åç¨±');
                return;
            }
            
            if (!gameState.selectedCountry) {
                showError('è«‹é¸æ“‡ä¸€å€‹åœ‹å®¶');
                return;
            }
            
            socket.emit('create_game', {
                player_name: playerName,
                country_code: gameState.selectedCountry
            });
            
            console.log('ğŸ® å‰µå»ºéŠæˆ²:', { playerName: playerName, country: gameState.selectedCountry });
        }

        function joinGame() {
            var playerName = document.getElementById('playerNameInput').value.trim();
            var gameId = document.getElementById('gameIdInput').value.trim();
            
            if (!playerName) {
                showError('è«‹è¼¸å…¥ç©å®¶åç¨±');
                return;
            }
            
            if (!gameId) {
                showError('è«‹è¼¸å…¥éŠæˆ²æˆ¿é–“ä»£ç¢¼');
                return;
            }
            
            if (!gameState.selectedCountry) {
                showError('è«‹é¸æ“‡ä¸€å€‹åœ‹å®¶');
                return;
            }
            
            socket.emit('join_game', {
                game_id: gameId,
                player_name: playerName,
                country_code: gameState.selectedCountry
            });
            
            console.log('ğŸšª åŠ å…¥éŠæˆ²:', { gameId: gameId, playerName: playerName, country: gameState.selectedCountry });
        }

        function startGame() {
            if (!gameState.isHost) {
                showError('åªæœ‰æˆ¿ä¸»å¯ä»¥é–‹å§‹éŠæˆ²');
                return;
            }
            
            socket.emit('start_game');
            console.log('ğŸš€ æˆ¿ä¸»é–‹å§‹éŠæˆ²');
        }

        // ===== 7. ç•Œé¢æ›´æ–°å‡½æ•¸ =====
        function showWaitingLobby() {
            document.getElementById('countrySelection').style.display = 'none';
            document.getElementById('waitingLobby').style.display = 'block';
            document.getElementById('gameContent').style.display = 'none';
            
            var roomCodeElement = document.getElementById('roomCode');
            if (roomCodeElement) {
                roomCodeElement.textContent = gameState.gameId;
            }
            
            var startBtn = document.getElementById('startGameBtn');
            if (startBtn) {
                startBtn.disabled = !gameState.isHost;
                startBtn.textContent = gameState.isHost ? 'é–‹å§‹éŠæˆ²' : 'ç­‰å¾…æˆ¿ä¸»é–‹å§‹...';
            }
        }

        function showGamePlay() {
            document.getElementById('countrySelection').style.display = 'none';
            document.getElementById('waitingLobby').style.display = 'none';
            document.getElementById('gameContent').style.display = 'block';
            
            // ğŸ†• å¢åŠ å¤šæ¬¡åˆ·æ–°ç¢ºä¿æ­£ç¢ºé¡¯ç¤º
            setTimeout(function() {
                forceRefreshPlayerPanel();
            }, 100);
            
            setTimeout(function() {
                forceRefreshPlayerPanel();
            }, 500);
            
            setTimeout(function() {
                forceRefreshPlayerPanel();
            }, 1000);
            
            console.log('ğŸ® éŠæˆ²ç•Œé¢å·²è¼‰å…¥');
        }

        // ğŸ†• æ–°å¢å¼·åˆ¶åˆ·æ–°å‡½æ•¸
        function forceRefreshPlayerPanel() {
            console.log('ğŸ”„ å¼·åˆ¶åˆ·æ–°ç©å®¶é¢æ¿');
            
            if (!gameState.playerData) {
                console.warn('âš ï¸ ç©å®¶æ•¸æ“šå°šæœªè¼‰å…¥ï¼Œè·³éåˆ·æ–°');
                return;
            }
            
            updateMyCountryPanel();
            setupCountrySpecificPanels();
            updateActiveSkillPanel();
            
            // ç¢ºä¿æ»‘æ¡¿å€¼æ­£ç¢º
            var data = gameState.playerData.country_data;
            if (data) {
                var interestSlider = document.getElementById('interestRateSlider');
                var interestValue = document.getElementById('interestRateValue');
                if (interestSlider && interestValue) {
                    interestSlider.value = data.interest_rate;
                    interestValue.textContent = data.interest_rate.toFixed(2) + '%';
                }
                
                var reserveSlider = document.getElementById('reserveRatioSlider');
                var reserveValue = document.getElementById('reserveRatioValue');
                if (reserveSlider && reserveValue) {
                    reserveSlider.value = data.reserve_ratio;
                    reserveValue.textContent = data.reserve_ratio.toFixed(1) + '%';
                }
            }
            
            console.log('âœ… é¢æ¿åˆ·æ–°å®Œæˆï¼Œç•¶å‰åœ‹å®¶:', gameState.playerData.country_code);
        }

        function updatePlayersList(players) {
            var container = document.getElementById('playersInLobby');
            if (!container) return;
            
            container.innerHTML = '';
            for (var i = 0; i < players.length; i++) {
                var player = players[i];
                var playerCard = document.createElement('div');
                var isHost = player.id === gameState.playerId && gameState.isHost;
                playerCard.className = 'player-card' + (isHost ? ' host' : '');
                playerCard.innerHTML = 
                    '<div style="font-size: 2em; margin-bottom: 10px;">' + player.country_flag + '</div>' +
                    '<div style="font-weight: bold;">' + player.name + '</div>' +
                    '<div style="color: #666;">' + player.country_name + '</div>' +
                    (isHost ? '<div style="color: #e74c3c; font-weight: bold;">æˆ¿ä¸»</div>' : '');
                container.appendChild(playerCard);
            }
        }

        function updateAllPlayers(players) {
            gameState.allPlayers = {};
            for (var i = 0; i < players.length; i++) {
                var player = players[i];
                gameState.allPlayers[player.id] = player;
                if (player.id === gameState.playerId) {
                    gameState.playerData = player;
                }
            }
            
            updateOtherPlayersList(players);
            updateMyCountryPanel();
            
            // ğŸ†• å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¼‰å…¥ï¼Œå¼·åˆ¶åˆ·æ–°é¢æ¿
            if (document.getElementById('gameContent').style.display === 'block') {
                updateActiveSkillPanel();
            }
        }

        function updateAllPlayersRealtime(players) {
            for (var i = 0; i < players.length; i++) {
                var player = players[i];
                if (gameState.allPlayers && gameState.allPlayers[player.id]) {
                    for (var key in player) {
                        gameState.allPlayers[player.id][key] = player[key];
                    }
                }
                if (player.id === gameState.playerId) {
                    for (var key in player) {
                        gameState.playerData[key] = player[key];
                    }
                }
            }
            
            updateOtherPlayersList(players);
            updateMyCountryPanel();
        }

        function updateOtherPlayersList(players) {
            var container = document.getElementById('otherPlayersList');
            if (!container) return;
            
            container.innerHTML = '';
            for (var i = 0; i < players.length; i++) {
                var player = players[i];
                if (player.id !== gameState.playerId) {
                    var playerDiv = document.createElement('div');
                    playerDiv.className = 'other-player';
                    
                    var opponentStockReturn = ((player.country_data.stock_index - 100) / 100) * 100;
                    var formattedStockReturn = opponentStockReturn >= 0 ? 
                        '+' + opponentStockReturn.toFixed(1) + '%' : 
                        opponentStockReturn.toFixed(1) + '%';
                    
                    playerDiv.innerHTML = 
                        '<div class="player-name">' + player.country_flag + ' ' + player.name + '</div>' +
                        '<div class="player-stats">' +
                            '<div class="stat">å¤§ç›¤: ' + formattedStockReturn + '</div>' +
                            '<div class="stat">GDP: ' + player.country_data.gdp_growth.toFixed(1) + '%</div>' +
                            '<div class="stat">é€šè†¨: ' + player.country_data.inflation.toFixed(1) + '%</div>' +
                            '<div class="stat confidential">å¤±æ¥­: æ©Ÿå¯†</div>' +
                            '<div class="stat confidential">ä¿¡å¿ƒ: æ©Ÿå¯†</div>' +
                            '<div class="stat confidential">åˆ©ç‡: æ©Ÿå¯†</div>' +
                        '</div>';
                    container.appendChild(playerDiv);
                }
            }
        }

        function updateMyCountryPanel() {
            if (!gameState.playerData) return;
            
            var data = gameState.playerData.country_data;
            
            var title = document.getElementById('myCountryTitle');
            if (title) {
                title.textContent = gameState.playerData.country_flag + ' ' + gameState.playerData.country_name + 'å¤®è¡Œ';
            }
            
            updateIndicator('gdpGrowth', data.gdp_growth, '%', 'gdpIndicator');
            updateIndicator('inflation', data.inflation, '%', 'inflationIndicator');
            updateIndicator('unemployment', data.unemployment, '%', 'unemploymentIndicator');
            updateIndicator('confidence', data.confidence, '', 'confidenceIndicator');
            updateIndicator('deficit', data.fiscal_deficit, '%', 'deficitIndicator');
            
            var stockReturn = ((data.stock_index - 100) / 100) * 100;
            updateStockIndicator('stockIndex', stockReturn, '%', 'stockIndicator');
            
            updateSliderSafely('interestRateSlider', 'interestRateValue', data.interest_rate, '%');
            updateSliderSafely('reserveRatioSlider', 'reserveRatioValue', data.reserve_ratio, '%');
            
            updateActiveSkillPanel();
        }

        function updateIndicator(elementId, value, suffix, containerId) {
            var element = document.getElementById(elementId);
            var container = document.getElementById(containerId);
            
            if (element) {
                if (typeof value === 'number') {
                    element.textContent = value.toFixed(1) + suffix;
                } else {
                    element.textContent = value + suffix;
                }
            }
            
            if (container) {
                container.classList.remove('positive', 'negative');
                if (typeof value === 'number') {
                    if (elementId === 'gdpGrowth' || elementId === 'confidence') {
                        if (value > 0) {
                            container.classList.add('positive');
                        } else if (value < 0) {
                            container.classList.add('negative');
                        }
                    } else if (elementId === 'inflation' || elementId === 'unemployment') {
                        if (value > 3) {
                            container.classList.add('negative');
                        } else if (value < 2) {
                            container.classList.add('positive');
                        }
                    } else if (elementId === 'deficit') {
                        if (value > 0) {
                            container.classList.add('negative'); // èµ¤å­—æ˜¯è² é¢çš„
                        } else {
                            container.classList.add('positive'); // ç›ˆé¤˜æ˜¯æ­£é¢çš„
                        }
                    }
                }
            }
        }

        function updateStockIndicator(elementId, value, suffix, containerId) {
            var element = document.getElementById(elementId);
            var container = document.getElementById(containerId);
            
            if (element) {
                var formattedValue = value >= 0 ? '+' + value.toFixed(1) : value.toFixed(1);
                element.textContent = formattedValue + suffix;
            }
            
            if (container) {
                container.classList.remove('positive', 'negative', 'neutral');
                
                if (value > 2) {
                    container.classList.add('positive');
                } else if (value < -2) {
                    container.classList.add('negative');
                } else {
                    container.classList.add('neutral');
                }
            }
        }

        function updateSliderSafely(sliderId, valueId, newValue, suffix) {
            var slider = document.getElementById(sliderId);
            var valueDisplay = document.getElementById(valueId);
            
            if (!slider || !valueDisplay) return;
            
            // æª¢æŸ¥æ»‘æ¡¿æ˜¯å¦æ­£åœ¨è¢«ç”¨æˆ¶æ“ä½œ
            if (slider.dataset.userInteracting === 'true') {
                console.log('ğŸ›ï¸ æ»‘æ¡¿æ­£åœ¨è¢«ç”¨æˆ¶æ“ä½œï¼Œè·³éè‡ªå‹•æ›´æ–°:', sliderId);
                return;
            }
            
            // å®‰å…¨æ›´æ–°æ»‘æ¡¿
            var currentValue = parseFloat(slider.value);
            var difference = Math.abs(currentValue - newValue);
            
            // åªæœ‰åœ¨å·®ç•°è¼ƒå¤§æ™‚æ‰æ›´æ–°ï¼Œé¿å…é »ç¹å›å½ˆ
            if (difference > 0.5) {
                slider.value = newValue;
                valueDisplay.textContent = newValue.toFixed(sliderId === 'reserveRatioSlider' ? 1 : 2) + suffix;
                console.log('ğŸ”„ åŒæ­¥æ»‘æ¡¿:', sliderId, 'æ–°å€¼:', newValue);
            }
        }

        function setupCountrySpecificPanels() {
            var countryCode = gameState.playerData ? gameState.playerData.country_code : null;
            updateActiveSkillPanel();
        }

        function updateActiveSkillPanel() {
            var countryCode = gameState.playerData ? gameState.playerData.country_code : null;
            var skillTitle = document.getElementById('skillTitle');
            var skillDescription = document.getElementById('skillDescription');
            var saudiOilControls = document.getElementById('saudiOilControls'); // âœ… ä¿®å¾©ï¼šæ­£ç¢ºç²å–å…ƒç´ 
            
            var skillConfig = {
                'USA': {
                    title: 'âš”ï¸ ç™¼å‹•è²¿æ˜“æˆ°çˆ­',
                    description: 'å°ç›®æ¨™åœ‹å®¶ç™¼å‹•è²¿æ˜“æˆ°ï¼Œé€ æˆé‡å¤§ç¶“æ¿Ÿæå¤±ï¼Œä½†æœ‰35%æ©Ÿç‡åå™¬è‡ªèº«'
                },
                'CHN': {
                    title: 'ğŸš€ äººå¤šå¥½è¾¦äº‹',
                    description: 'é›†ä¸­åŠ›é‡è¾¦å¤§äº‹ï¼Œå¯¦ç¾é‡å¤§ç§‘æŠ€çªç ´ï¼Œå¤§å¹…æå‡GDPæˆé•·å’Œæ°‘çœ¾ä¿¡å¿ƒï¼Œç„¡æ˜é¡¯å‰¯ä½œç”¨'
                },
                'JPN': {
                    title: 'ğŸ¯ æ”¹å–„è€äººå°±æ¥­å•é¡Œ',
                    description: 'é€éæ•¸ä½åŒ–åŸ¹è¨“å’Œå½ˆæ€§å·¥ä½œåˆ¶åº¦ï¼Œæå‡é«˜é½¡å‹å‹•åƒèˆ‡ç‡ï¼Œè§£æ±ºé€šç¸®å’Œä¿¡å¿ƒå•é¡Œ'
                },
                'TWN': {
                    title: 'ğŸ² å¤¾ç¸«ä¸­æ±‚ç”Ÿå­˜',
                    description: 'é¸æ“‡æ­ä¹˜æŸåœ‹ç¶“æ¿Ÿé †é¢¨è»Šï¼Œè‹¥è©²åœ‹è¡¨ç¾è‰¯å¥½å‰‡ç²å¾—é¡å¤–æ”¶ç›Šï¼Œé«”ç¾å°åœ‹éˆæ´»å¤–äº¤'
                },
                'BRA': {
                    title: 'âš–ï¸ åè²ªè…è¡Œå‹•',
                    description: 'ç™¼å‹•å¤§è¦æ¨¡åè²ªè…é‹å‹•ï¼Œå¤§å¹…æå‡æ”¿åºœæ•ˆèƒ½å’Œæ°‘çœ¾ä¿¡å¿ƒï¼Œæ”¹å–„è²¡æ”¿ç‹€æ³'
                },
                'SAU': {
                    title: 'ğŸ­ ç”¢æ¥­è½‰å‹',
                    description: 'æ¨é€²ç¶“æ¿Ÿå¤šå…ƒåŒ–ï¼Œé€æ­¥é™ä½çŸ³æ²¹ä¾è³´åº¦ï¼Œå»ºç«‹å¯æŒçºŒç™¼å±•çš„ç¶“æ¿Ÿçµæ§‹'
                }
            };
            
            var config = skillConfig[countryCode];
            if (config) {
                if (skillTitle) skillTitle.textContent = config.title;
                if (skillDescription) skillDescription.textContent = config.description;
            }
            
            // âœ… é¡¯ç¤ºæˆ–éš±è—æ²™çƒåœ°çŸ³æ²¹æ§åˆ¶æŒ‰éˆ•
            if (saudiOilControls) {
                if (countryCode === 'SAU') {
                    saudiOilControls.style.display = 'block';
                } else {
                    saudiOilControls.style.display = 'none';
                }
            }

            console.log('âœ… ä¸»å‹•æŠ€èƒ½é¢æ¿å·²æ›´æ–°ç‚º:', countryCode, config ? config.title : 'æœªçŸ¥');
        }

        function updateTimeDisplay(progress, remainingTime) {
            var progressFill = document.getElementById('progressFill');
            var timeRemaining = document.getElementById('timeRemaining');
            
            if (progressFill) {
                var percentage = Math.min(progress * 100, 100);
                progressFill.style.width = percentage + '%';
                
                if (remainingTime <= 5) {
                    progressFill.style.backgroundColor = '#e74c3c';
                } else if (remainingTime <= 10) {
                    progressFill.style.backgroundColor = '#f39c12';
                } else {
                    progressFill.style.backgroundColor = '#3498db';
                }
            }
            
            if (timeRemaining) {
                var minutes = Math.floor(remainingTime / 60);
                var seconds = Math.floor(remainingTime % 60);
                timeRemaining.textContent = minutes + ':' + (seconds < 10 ? '0' : '') + seconds;
                
                if (remainingTime <= 5) {
                    timeRemaining.style.color = '#e74c3c';
                    timeRemaining.style.fontWeight = 'bold';
                } else {
                    timeRemaining.style.color = '';
                    timeRemaining.style.fontWeight = '';
                }
            }
        }

        function updateQuarter(quarter) {
            var element = document.getElementById('currentQuarter');
            if (element) {
                element.textContent = quarter;
            }
        }

        function updateGlobalOilPrice(price) {
            var element = document.getElementById('globalOilPrice');
            if (element) {
                element.textContent = '$' + price.toFixed(1);
            }
        }

        function updateGameLog(logs) {
            var container = document.getElementById('gameLogContainer');
            if (!container) return;
            
            var wasAtBottom = container.scrollHeight - container.clientHeight <= container.scrollTop + 1;
            
            container.innerHTML = '';
            
            // é¡¯ç¤ºæœ€æ–°çš„ 10 æ¢ç´€éŒ„ï¼Œè€Œä¸æ˜¯åªæœ‰ 3 æ¢
            var displayLogs = logs.slice(-10);
            
            for (var i = 0; i < displayLogs.length; i++) {
                var log = displayLogs[i];
                var logDiv = document.createElement('div');
                logDiv.className = 'log-entry';
                
                // æ·»åŠ æ™‚é–“æˆ³é¡¯ç¤º
                var timeStamp = '';
                if (log.timestamp) {
                    var date = new Date(log.timestamp * 1000);
                    timeStamp = date.toLocaleTimeString('zh-TW', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        second: '2-digit'
                    });
                    timeStamp = ' [' + timeStamp + ']';
                }
                
                logDiv.innerHTML = '<strong>Q' + log.quarter + '</strong>' + timeStamp + ' ' + log.message;
                container.appendChild(logDiv);
            }
            
            // å¦‚æœç”¨æˆ¶åœ¨åº•éƒ¨ï¼Œè‡ªå‹•æ»¾å‹•
            if (wasAtBottom) {
                container.scrollTop = container.scrollHeight;
            }
            
            console.log('ğŸ“° éŠæˆ²æ—¥èªŒå·²æ›´æ–°ï¼Œé¡¯ç¤º', displayLogs.length, 'æ¢ç´€éŒ„');
        }

        function updatePolicyCooldowns(cooldownStatus) {
            gameState.policyCooldowns = cooldownStatus;
            
            var globalCooldown = cooldownStatus.global_policy_cooldown || 0;
            var activeSkillCooldown = cooldownStatus.active_skill || 0;
            
            updateActiveSkillCooldown(activeSkillCooldown);
            
            var policyButtons = [
                { btnId: 'interestRateBtn', cooldownId: 'interestRateCooldown', progressId: 'interestRateProgress' },
                { btnId: 'reserveRatioBtn', cooldownId: 'reserveRatioCooldown', progressId: 'reserveRatioProgress' },
                { btnId: 'increaseSpendingBtn', cooldownId: 'increaseSpendingCooldown', progressId: 'increaseSpendingProgress' },
                { btnId: 'decreaseSpendingBtn', cooldownId: 'decreaseSpendingCooldown', progressId: 'decreaseSpendingProgress' },
                { btnId: 'qeBtn', cooldownId: 'qeCooldown', progressId: 'qeProgress' },
                { btnId: 'qtBtn', cooldownId: 'qtCooldown', progressId: 'qtProgress' },
                { btnId: 'cashDistributionBtn', cooldownId: 'cashDistributionCooldown', progressId: 'cashDistributionProgress' },
                // ğŸ†• æ·»åŠ çŸ³æ²¹æ§åˆ¶æŒ‰éˆ•
                { btnId: 'increaseOilBtn', cooldownId: 'increaseOilCooldown', progressId: 'increaseOilProgress' },
                { btnId: 'decreaseOilBtn', cooldownId: 'decreaseOilCooldown', progressId: 'decreaseOilProgress' }
            ];
            
            policyButtons.forEach(function(config) {
                updateButtonCooldown(config.btnId, config.cooldownId, config.progressId, globalCooldown, 10);
            });
        }

        function updateActiveSkillCooldown(remaining) {
            var btn = document.getElementById('activeSkillBtn');
            var cooldownOverlay = document.getElementById('activeSkillCooldown');
            var progressBar = document.getElementById('activeSkillProgress');
            
            if (!btn || !cooldownOverlay || !progressBar) return;
            
            if (remaining > 0) {
                btn.disabled = true;
                btn.classList.add('btn-cooldown');
                
                cooldownOverlay.textContent = remaining + 'å­£';
                cooldownOverlay.style.width = '100%';
                progressBar.style.width = '100%';
            } else {
                btn.disabled = false;
                btn.classList.remove('btn-cooldown');
                cooldownOverlay.style.width = '0%';
                progressBar.style.width = '0%';
                cooldownOverlay.textContent = '';
            }
        }

        function updateButtonCooldown(btnId, cooldownId, progressId, remaining, maxCooldown) {
            var btn = document.getElementById(btnId);
            var cooldownOverlay = document.getElementById(cooldownId);
            var progressBar = document.getElementById(progressId);
            
            if (!btn || !cooldownOverlay || !progressBar) return;
            
            if (remaining > 0) {
                btn.disabled = true;
                btn.classList.add('btn-cooldown');
                
                var seconds = Math.ceil(remaining);
                cooldownOverlay.textContent = seconds + 's';
                cooldownOverlay.style.width = '100%';
                progressBar.style.width = '100%';
                
                if (maxCooldown > 0) {
                    var percentage = (remaining / maxCooldown) * 100;
                    cooldownOverlay.style.width = percentage + '%';
                    progressBar.style.width = percentage + '%';
                }
            } else {
                btn.disabled = false;
                btn.classList.remove('btn-cooldown');
                cooldownOverlay.style.width = '0%';
                progressBar.style.width = '0%';
                cooldownOverlay.textContent = '';
            }
        }

        // ===== 8. è¨­ç½®æŒ‰éˆ•äº‹ä»¶ç›£è½å™¨ =====
        function setupPolicyButtons() {
            // åˆ©ç‡æ”¿ç­–
            var interestRateBtn = document.getElementById('interestRateBtn');
            if (interestRateBtn) {
                interestRateBtn.addEventListener('click', function() {
                    var slider = document.getElementById('interestRateSlider');
                    if (slider) {
                        var rate = parseFloat(slider.value);
                        console.log('ğŸ’° åŸ·è¡Œåˆ©ç‡æ”¿ç­–ï¼Œæ•¸å€¼:', rate);
                        executePolicy('interest_rate', { value: rate });
                    }
                });
            }

            // å­˜æ¬¾æº–å‚™é‡‘ç‡
            var reserveRatioBtn = document.getElementById('reserveRatioBtn');
            if (reserveRatioBtn) {
                reserveRatioBtn.addEventListener('click', function() {
                    var slider = document.getElementById('reserveRatioSlider');
                    if (slider) {
                        var ratio = parseFloat(slider.value);
                        console.log('ğŸ¦ åŸ·è¡Œæº–å‚™é‡‘ç‡æ”¿ç­–ï¼Œæ•¸å€¼:', ratio);
                        executePolicy('reserve_ratio', { value: ratio });
                    }
                });
            }

            // è²¡æ”¿æ”¿ç­–æŒ‰éˆ•
            var increaseSpendingBtn = document.getElementById('increaseSpendingBtn');
            if (increaseSpendingBtn) {
                increaseSpendingBtn.addEventListener('click', function() {
                    executePolicy('fiscal_policy', { policy_type: 'increase_spending' });
                });
            }

            var decreaseSpendingBtn = document.getElementById('decreaseSpendingBtn');
            if (decreaseSpendingBtn) {
                decreaseSpendingBtn.addEventListener('click', function() {
                    executePolicy('fiscal_policy', { policy_type: 'decrease_spending' });
                });
            }

            // é‡åŒ–å¯¬é¬†æ”¿ç­–æŒ‰éˆ•
            var qeBtn = document.getElementById('qeBtn');
            if (qeBtn) {
                qeBtn.addEventListener('click', function() {
                    executePolicy('quantitative_easing', { direction: 'easing' });
                });
            }

            var qtBtn = document.getElementById('qtBtn');
            if (qtBtn) {
                qtBtn.addEventListener('click', function() {
                    executePolicy('quantitative_easing', { direction: 'tightening' });
                });
            }

            // æ™®ç™¼ç¾é‡‘
            var cashDistributionBtn = document.getElementById('cashDistributionBtn');
            if (cashDistributionBtn) {
                cashDistributionBtn.addEventListener('click', function() {
                    executePolicy('cash_distribution');
                });
            }

            // ä¸»å‹•æŠ€èƒ½æŒ‰éˆ•
            var activeSkillBtn = document.getElementById('activeSkillBtn');
            if (activeSkillBtn) {
                activeSkillBtn.addEventListener('click', function() {
                    handleActiveSkillClick();
                });
            }

            // ğŸ†• æ²™çƒåœ°çŸ³æ²¹æ§åˆ¶æŒ‰éˆ•
            var increaseOilBtn = document.getElementById('increaseOilBtn');
            if (increaseOilBtn) {
                increaseOilBtn.addEventListener('click', function() {
                    executePolicy('oil_control', { direction: 'increase' });
                });
            }

            var decreaseOilBtn = document.getElementById('decreaseOilBtn');
            if (decreaseOilBtn) {
                decreaseOilBtn.addEventListener('click', function() {
                    executePolicy('oil_control', { direction: 'decrease' });
                });
            }            

            // è¨­ç½®æ»‘æ¡¿å³æ™‚æ›´æ–°
            setupSliders();
        }

        function setupSliders() {
            console.log('ğŸ›ï¸ è¨­ç½®æ»‘æ¡¿äº‹ä»¶ç›£è½å™¨');
            
            function setupSlider(sliderId, valueId, decimals, suffix) {
                var slider = document.getElementById(sliderId);
                var valueDisplay = document.getElementById(valueId);
                
                if (slider && valueDisplay) {
                    // æ¨™è¨˜ç”¨æˆ¶é–‹å§‹æ“ä½œ
                    slider.addEventListener('mousedown', function() {
                        slider.dataset.userInteracting = 'true';
                    });
                    
                    slider.addEventListener('touchstart', function() {
                        slider.dataset.userInteracting = 'true';
                    });
                    
                    // æ¨™è¨˜ç”¨æˆ¶çµæŸæ“ä½œ
                    slider.addEventListener('mouseup', function() {
                        setTimeout(function() {
                            slider.dataset.userInteracting = 'false';
                        }, 1000); // 1ç§’å¾Œå…è¨±è‡ªå‹•æ›´æ–°
                    });
                    
                    slider.addEventListener('touchend', function() {
                        setTimeout(function() {
                            slider.dataset.userInteracting = 'false';
                        }, 1000);
                    });
                    
                    // å³æ™‚æ›´æ–°é¡¯ç¤ºå€¼
                    slider.addEventListener('input', function(e) {
                        var value = parseFloat(e.target.value);
                        valueDisplay.textContent = value.toFixed(decimals) + suffix;
                        console.log('ğŸ“Š æ»‘æ¡¿èª¿æ•´:', sliderId, value + suffix);
                    });
                }
            }
            
            // è¨­ç½®åˆ©ç‡æ»‘æ¡¿ï¼ˆ2ä½å°æ•¸ï¼‰
            setupSlider('interestRateSlider', 'interestRateValue', 2, '%');
            
            // è¨­ç½®æº–å‚™é‡‘ç‡æ»‘æ¡¿ï¼ˆ1ä½å°æ•¸ï¼‰
            setupSlider('reserveRatioSlider', 'reserveRatioValue', 1, '%');
            
            console.log('âœ… æ»‘æ¡¿äº‹ä»¶ç›£è½å™¨è¨­ç½®å®Œæˆ');
        }

        function handleActiveSkillClick() {
            var countryCode = gameState.playerData ? gameState.playerData.country_code : null;
            
            switch (countryCode) {
                case 'USA':
                    handleUSATradeWar();
                    break;
                case 'CHN':
                    executePolicy('china_mass_mobilization');
                    break;
                case 'JPN':
                    executePolicy('japan_aging_solution');
                    break;
                case 'TWN':
                    handleTaiwanBet();
                    break;
                case 'BRA':
                    executePolicy('brazil_anticorruption');
                    break;
                case 'SAU':
                    executePolicy('saudi_transformation');
                    break;
                default:
                    showError('æœªçŸ¥çš„åœ‹å®¶ä»£ç¢¼');
            }
        }

        function handleUSATradeWar() {
            var otherCountries = [];
            for (var playerId in gameState.allPlayers) {
                var player = gameState.allPlayers[playerId];
                if (player.country_code !== 'USA') {
                    otherCountries.push({
                        code: player.country_code,
                        name: player.country_name,
                        flag: player.country_flag
                    });
                }
            }
            
            if (otherCountries.length === 0) {
                showError('æ²’æœ‰å¯ä»¥ç™¼å‹•è²¿æ˜“æˆ°çˆ­çš„ç›®æ¨™åœ‹å®¶');
                return;
            }
            
            createCountryDropdown(otherCountries, 'ğŸš¨ é¸æ“‡è²¿æ˜“æˆ°çˆ­ç›®æ¨™åœ‹å®¶').then(function(target) {
                if (target) {
                    executePolicy('usa_trade_war', { target_country: target });
                }
            });
        }

        function handleTaiwanBet() {
            var otherCountries = [];
            for (var playerId in gameState.allPlayers) {
                var player = gameState.allPlayers[playerId];
                if (player.country_code !== 'TWN') {
                    otherCountries.push({
                        code: player.country_code,
                        name: player.country_name,
                        flag: player.country_flag
                    });
                }
            }
            
            if (otherCountries.length === 0) {
                showError('æ²’æœ‰å¯ä»¥æ­é †é¢¨è»Šçš„åœ‹å®¶');
                return;
            }
            
            createCountryDropdown(otherCountries, 'ğŸ² é¸æ“‡è¦æ­é †é¢¨è»Šçš„åœ‹å®¶').then(function(target) {
                if (target) {
                    executePolicy('taiwan_bet', { target_country: target });
                }
            });
        }

        function createCountryDropdown(countries, title) {
            return new Promise(function(resolve) {
                // å‰µå»ºæ¨¡æ…‹å°è©±æ¡†
                var modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.7);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                `;
                
                var dialog = document.createElement('div');
                dialog.style.cssText = `
                    background: white;
                    border-radius: 15px;
                    padding: 30px;
                    max-width: 400px;
                    width: 90%;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                `;
                
                dialog.innerHTML = `
                    <h3 style="margin-bottom: 20px; color: #2c3e50; text-align: center;">${title}</h3>
                    <select id="countrySelect" style="
                        width: 100%;
                        padding: 12px;
                        border: 2px solid #3498db;
                        border-radius: 8px;
                        font-size: 16px;
                        margin-bottom: 20px;
                        background: white;
                    ">
                        <option value="">è«‹é¸æ“‡åœ‹å®¶...</option>
                        ${countries.map(country => 
                            `<option value="${country.code}">${country.flag} ${country.name}</option>`
                        ).join('')}
                    </select>
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button id="confirmBtn" style="
                            padding: 10px 20px;
                            background: #27ae60;
                            color: white;
                            border: none;
                            border-radius: 6px;
                            cursor: pointer;
                            font-weight: bold;
                        ">ç¢ºèª</button>
                        <button id="cancelBtn" style="
                            padding: 10px 20px;
                            background: #95a5a6;
                            color: white;
                            border: none;
                            border-radius: 6px;
                            cursor: pointer;
                            font-weight: bold;
                        ">å–æ¶ˆ</button>
                    </div>
                `;
                
                modal.appendChild(dialog);
                document.body.appendChild(modal);
                
                var select = dialog.querySelector('#countrySelect');
                var confirmBtn = dialog.querySelector('#confirmBtn');
                var cancelBtn = dialog.querySelector('#cancelBtn');
                
                confirmBtn.addEventListener('click', function() {
                    var selectedValue = select.value;
                    document.body.removeChild(modal);
                    resolve(selectedValue || null);
                });
                
                cancelBtn.addEventListener('click', function() {
                    document.body.removeChild(modal);
                    resolve(null);
                });
                
                // ESC éµé—œé–‰
                modal.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape') {
                        document.body.removeChild(modal);
                        resolve(null);
                    }
                });
                
                // èšç„¦åˆ°é¸æ“‡æ¡†
                setTimeout(function() {
                    select.focus();
                }, 100);
            });
        }

        // ===== 9. æç¤ºå’Œåé¥‹ç³»çµ± =====
        function showQuarterTransition(quarter) {
            var alerts = document.getElementById('economicAlerts');
            var transitionDiv = document.createElement('div');
            transitionDiv.className = 'prosperity-notice';
            transitionDiv.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            transitionDiv.innerHTML = 'ğŸ“… ç¬¬ ' + quarter + ' å­£é–‹å§‹ï¼ç¶“æ¿ŸæŒ‡æ¨™å·²æ›´æ–°';
            alerts.appendChild(transitionDiv);
            
            setTimeout(function() {
                if (transitionDiv.parentNode) {
                    transitionDiv.parentNode.removeChild(transitionDiv);
                }
            }, 3000);
        }

        function showSuccess(message) {
            var alerts = document.getElementById('economicAlerts');
            var successDiv = document.createElement('div');
            successDiv.className = 'prosperity-notice success-notice';
            successDiv.innerHTML = 'âœ… ' + message;
            alerts.appendChild(successDiv);
            
            setTimeout(function() {
                if (successDiv.parentNode) {
                    successDiv.parentNode.removeChild(successDiv);
                }
            }, 3000);
        }

        function showError(message) {
            var alerts = document.getElementById('economicAlerts');
            var errorDiv = document.createElement('div');
            errorDiv.className = 'prosperity-notice error-notice';
            errorDiv.innerHTML = 'âŒ ' + message;
            alerts.appendChild(errorDiv);
            
            setTimeout(function() {
                if (errorDiv.parentNode) {
                    errorDiv.parentNode.removeChild(errorDiv);
                }
            }, 5000);
        }

        // ===== 10. åˆå§‹åŒ–ç¨‹åº =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ® éŠæˆ²åˆå§‹åŒ–é–‹å§‹');
            
            // å‰µå»ºå¿«è¨Šç³»çµ±å¯¦ä¾‹
            window.NewsAlertSystem = NewsAlertSystem;
            window.newsAlertSystem = new NewsAlertSystem();
            
            // åˆå§‹åŒ–Socketé€£æ¥
            initializeSocket();
            
            // è¨­ç½®æ”¿ç­–æŒ‰éˆ•äº‹ä»¶
            setupPolicyButtons();
            
            // è¨­ç½®åœ‹å®¶é¸æ“‡äº‹ä»¶
            setupCountrySelection();
            
            console.log('âœ… éŠæˆ²åˆå§‹åŒ–å®Œæˆï¼Œç­‰å¾…ç”¨æˆ¶æ“ä½œ');
            
            // æ¸¬è©¦å¿«è¨Šç³»çµ±
            setTimeout(function() {
                if (window.newsAlertSystem && window.newsAlertSystem.isReady) {
                    window.newsAlertSystem.showAlert({
                        type: 'global',
                        category: 'good',
                        name: 'ğŸ® å¤®è¡Œæ¨¡æ“¬å™¨å•Ÿå‹•',
                        description: 'æ­¡è¿ä¾†åˆ°å…¨çƒå¤®è¡Œæ¨¡æ“¬å™¨ï¼å¿«è¨Šç³»çµ±å·²æˆåŠŸè¼‰å…¥ã€‚',
                        effects: {},
                        season: 1
                    });
                    console.log('âœ… æ¸¬è©¦å¿«è¨Šé¡¯ç¤ºæˆåŠŸ');
                } else {
                    console.warn('âš ï¸ å¿«è¨Šç³»çµ±åˆå§‹åŒ–æœªå®Œæˆ');
                }
            }, 2000);
        });
        // ===== 11. é™¤éŒ¯å·¥å…·ï¼ˆæ•´åˆç‰ˆæœ¬ï¼Œå–ä»£åŸæœ‰çš„é‡è¤‡éƒ¨åˆ†ï¼‰=====

        window.debugTools = {
            // æª¢æŸ¥ç³»çµ±ç‹€æ…‹
            checkSystem: function() {
                console.log('=== ğŸ” ç³»çµ±ç‹€æ…‹æª¢æŸ¥ ===');
                console.log('Socket é€£æ¥:', socket && socket.connected ? 'âœ… å·²é€£æ¥' : 'âŒ æœªé€£æ¥');
                console.log('å¿«è¨Šç³»çµ±:', window.newsAlertSystem && window.newsAlertSystem.isReady ? 'âœ… å°±ç·’' : 'âŒ æœªå°±ç·’');
                console.log('éŠæˆ²ç‹€æ…‹:', gameState.gameId ? 'âœ… éŠæˆ²ä¸­' : 'âŒ æœªé–‹å§‹');
                console.log('ç©å®¶ID:', gameState.playerId || 'æœªè¨­å®š');
                console.log('é¸æ“‡åœ‹å®¶:', gameState.selectedCountry || 'æœªé¸æ“‡');
                
                if (gameState.gameId) {
                    console.log('æˆ¿é–“ä»£ç¢¼:', gameState.gameId);
                    console.log('ç•¶å‰å­£åº¦:', document.getElementById('currentQuarter')?.textContent || 'æœªçŸ¥');
                    console.log('ç©å®¶æ•¸æ“š:', gameState.playerData ? 'âœ… å·²è¼‰å…¥' : 'âŒ æœªè¼‰å…¥');
                }
                
                return {
                    socket: socket && socket.connected,
                    newsSystem: window.newsAlertSystem && window.newsAlertSystem.isReady,
                    inGame: !!gameState.gameId,
                    playerData: !!gameState.playerData
                };
            },

            // æ¨¡æ“¬å„ç¨®äº‹ä»¶
            simulateEvent: function(type = 'global') {
                if (!window.newsAlertSystem || !window.newsAlertSystem.isReady) {
                    console.error('âŒ å¿«è¨Šç³»çµ±ä¸å¯ç”¨');
                    return false;
                }

                var events = {
                    global_good: {
                        type: 'global',
                        category: 'good',
                        name: 'ğŸŒ å…¨çƒç¶“æ¿Ÿå¾©ç”¦',
                        description: 'å„åœ‹ç¶“æ¿Ÿæ”¿ç­–å”èª¿æœ‰æ•ˆï¼Œå…¨çƒç¶“æ¿Ÿå±•ç¾å¼·å‹å¾©ç”¦å‹•èƒ½',
                        effects: { gdp: 1.5, confidence: 15, inflation: -0.5 },
                        season: 3
                    },
                    global_bad: {
                        type: 'global',
                        category: 'bad',
                        name: 'ğŸŒ å…¨çƒè²¿æ˜“æˆ°çˆ­',
                        description: 'ä¸»è¦ç¶“æ¿Ÿé«”è²¿æ˜“æ‘©æ“¦åŠ åŠ‡ï¼Œå…¨çƒä¾›æ‡‰éˆå—åˆ°åš´é‡è¡æ“Š',
                        effects: { gdp: -2.0, confidence: -20, inflation: 1.5 },
                        season: 3
                    },
                    country: {
                        type: 'country',
                        country: gameState.playerData?.country_name || 'ç¾åœ‹',
                        category: 'good',
                        name: 'ğŸ³ï¸ æ”¿ç­–æ”¹é©æˆåŠŸ',
                        description: 'é‡å¤§ç¶“æ¿Ÿæ”¹é©å–å¾—é¡¯è‘—æˆæ•ˆï¼Œåœ‹éš›è©•ç´šæ©Ÿæ§‹ä¸Šèª¿ä¿¡ç”¨è©•ç´š',
                        effects: { gdp: 1.8, confidence: 12, deficit: -1.0 },
                        season: 3
                    }
                };

                var eventToShow;
                switch(type) {
                    case 'global_good':
                        eventToShow = events.global_good;
                        break;
                    case 'global_bad':
                        eventToShow = events.global_bad;
                        break;
                    case 'country':
                        eventToShow = events.country;
                        break;
                    default:
                        eventToShow = events.global_good;
                }

                console.log('ğŸ® æ¨¡æ“¬äº‹ä»¶:', eventToShow.name);
                window.newsAlertSystem.showAlert(eventToShow);
                return true;
            },

            // å¼·åˆ¶åˆ·æ–°éŠæˆ²ç‹€æ…‹
            forceRefresh: function() {
                console.log('ğŸ”„ å¼·åˆ¶åˆ·æ–°éŠæˆ²ç‹€æ…‹...');
                if (gameState.playerData) {
                    updateMyCountryPanel();
                    updateActiveSkillPanel();
                    console.log('âœ… åˆ·æ–°å®Œæˆ');
                } else {
                    console.warn('âš ï¸ ç„¡ç©å®¶æ•¸æ“šå¯åˆ·æ–°');
                }
            },

            // æ¸¬è©¦å†·å»ç³»çµ±
            testCooldowns: function() {
                console.log('ğŸ§ª æ¸¬è©¦å†·å»ç³»çµ±...');
                var testCooldowns = {
                    global_policy_cooldown: 5,
                    active_skill: 2
                };
                updatePolicyCooldowns(testCooldowns);
                console.log('âœ… å†·å»æ¸¬è©¦å®Œæˆï¼Œ5ç§’å¾Œè‡ªå‹•é‡ç½®');
                setTimeout(function() {
                    updatePolicyCooldowns({ global_policy_cooldown: 0, active_skill: 0 });
                    console.log('ğŸ”„ å†·å»ç³»çµ±å·²é‡ç½®');
                }, 5000);
            }
        };

        // ç‚ºäº†å‘å¾Œç›¸å®¹ï¼Œä¿ç•™ä¸€äº›èˆŠçš„å‡½æ•¸å
        window.checkEventSystem = window.debugTools.checkSystem;
        window.debugGameState = window.debugTools.checkSystem;
        window.simulateGameEvent = function() { return window.debugTools.simulateEvent('global_good'); };
        window.testNewsAlert = function() { return window.debugTools.simulateEvent('country'); };

        // åªä¿ç•™ä¸€æ¬¡è¼‰å…¥å®Œæˆè¨Šæ¯
        console.log('ğŸ¯ å¤®è¡Œæ¨¡æ“¬å™¨è¼‰å…¥å®Œæˆï¼');
        console.log('ğŸ’¡ é™¤éŒ¯æŒ‡ä»¤ï¼š');
        console.log('  - debugTools.checkSystem() æª¢æŸ¥ç³»çµ±ç‹€æ…‹');
        console.log('  - debugTools.simulateEvent("global_good") æ¨¡æ“¬å…¨çƒå¥½äº‹ä»¶');
        console.log('  - debugTools.simulateEvent("global_bad") æ¨¡æ“¬å…¨çƒå£äº‹ä»¶');
        console.log('  - debugTools.simulateEvent("country") æ¨¡æ“¬åœ‹å®¶äº‹ä»¶');
        console.log('  - debugTools.forceRefresh() å¼·åˆ¶åˆ·æ–°ç•Œé¢');
        console.log('  - debugTools.testCooldowns() æ¸¬è©¦å†·å»ç³»çµ±');
        console.log('ğŸš€ é–‹å§‹æ‚¨çš„å¤®è¡Œè¡Œé•·ä¹‹æ—…ï¼');

        // è©•åˆ†ç³»çµ±ç›¸é—œå‡½æ•¸
        function showCurrentStandings() {
            console.log('ğŸ“Š è«‹æ±‚ç•¶å‰æ’å');
            socket.emit('request_standings');
            document.getElementById('scoringPanel').style.display = 'block';
        }

        function toggleScoringPanel() {
            const panel = document.getElementById('scoringPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        function setGameDuration() {
            const duration = document.getElementById('gameDuration').value;
            socket.emit('set_game_duration', { quarters: parseInt(duration) });
        }

        function updateStandingsDisplay(standings, quarter) {
            const standingsList = document.getElementById('standingsList');
            if (!standingsList) {
                console.error('âŒ æ‰¾ä¸åˆ°æ’ååˆ—è¡¨å®¹å™¨');
                return;
            }
            
            standingsList.innerHTML = '';
            
            if (!standings || standings.length === 0) {
                standingsList.innerHTML = '<div style="text-align: center; color: #6c757d; padding: 20px;">æš«ç„¡è©•åˆ†æ•¸æ“š</div>';
                return;
            }
            
            standings.forEach((player, index) => {
                const standingItem = document.createElement('div');
                standingItem.className = 'standing-item';
                standingItem.style.cssText = `
                    display: flex;
                    align-items: center;
                    padding: 15px;
                    margin-bottom: 10px;
                    background: #f8f9fa;
                    border-radius: 8px;
                    border-left: 4px solid #007bff;
                    cursor: pointer;
                    transition: all 0.3s;
                `;
                
                // è¨­ç½®è©•ç´šé¡è‰²
                const gradeColors = {
                    'S': '#ffd700',
                    'A': '#c0c0c0', 
                    'B': '#cd7f32',
                    'C': '#4CAF50',
                    'D': '#ff9800',
                    'F': '#f44336'
                };
                const gradeTextColors = {
                    'S': '#000', 'A': '#000', 'B': '#fff',
                    'C': '#fff', 'D': '#fff', 'F': '#fff'
                };
                
                standingItem.innerHTML = `
                    <div class="ranking">
                        <span class="rank">#${index + 1}</span>
                        <span class="grade grade-${player.grade}" style="
                            padding: 4px 8px;
                            border-radius: 4px;
                            font-size: 12px;
                            font-weight: bold;
                            margin-left: 8px;
                            background: ${gradeColors[player.grade] || '#6c757d'};
                            color: ${gradeTextColors[player.grade] || '#fff'};
                        ">${player.grade}</span>
                    </div>
                    <div class="player-info">
                        <span class="flag">${player.country_flag || 'ğŸ³ï¸'}</span>
                        <span class="name">${player.player_name || 'æœªçŸ¥ç©å®¶'}</span>
                        <span class="country">${player.country_name || 'æœªçŸ¥åœ‹å®¶'}</span>
                    </div>
                    <div class="score">
                        <span class="total-score">${(player.total_score || 0).toFixed(1)}</span>
                        <span class="score-label">åˆ†</span>
                        <div style="font-size: 12px; color: #6c757d;">ç¬¬${quarter}å­£</div>
                    </div>
                `;
                
                // æ·»åŠ hoveræ•ˆæœ
                standingItem.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = '#e9ecef';
                    this.style.transform = 'translateY(-2px)';
                });
                
                standingItem.addEventListener('mouseleave', function() {
                    this.style.backgroundColor = '#f8f9fa';
                    this.style.transform = 'translateY(0)';
                });
                
                // é»æ“Šé¡¯ç¤ºè©³ç´°è©•åˆ†
                standingItem.addEventListener('click', () => {
                    showScoreDetails(player);
                });
                
                standingsList.appendChild(standingItem);
            });
            
            console.log('âœ… æ’åé¡¯ç¤ºæ›´æ–°å®Œæˆ');
        }


        function showScoreDetails(player) {
            const details = player.details || {};
            const detailsContainer = document.getElementById('scoringDetails');
            
            if (!detailsContainer) {
                console.error('âŒ æ‰¾ä¸åˆ°è©•åˆ†è©³æƒ…å®¹å™¨');
                return;
            }
            
            detailsContainer.innerHTML = `
                <div style="padding: 20px; background: white; border-radius: 8px; margin-top: 15px; border: 1px solid #dee2e6;">
                    <h4 style="margin-bottom: 15px; color: #333; display: flex; align-items: center;">
                        <span style="font-size: 24px; margin-right: 10px;">${player.country_flag || 'ğŸ³ï¸'}</span>
                        ${player.player_name || 'æœªçŸ¥ç©å®¶'} è©³ç´°è©•åˆ†
                    </h4>
                    <div class="score-breakdown">
                        <div class="score-section" style="margin-bottom: 15px;">
                            <h5 style="color: #007bff; margin-bottom: 10px;">ğŸ“Š å…±é€šæŒ‡æ¨™ (490åˆ†)</h5>
                            <div class="score-item">GDPæˆé•·ç‡: ${(details.gdp_growth || 0).toFixed(1)}/98åˆ†</div>
                            <div class="score-item">é€šè†¨ç‡: ${(details.inflation || 0).toFixed(1)}/98åˆ†</div>
                            <div class="score-item">å¤±æ¥­ç‡: ${(details.unemployment || 0).toFixed(1)}/74åˆ†</div>
                            <div class="score-item">æ°‘çœ¾ä¿¡å¿ƒ: ${(details.confidence || 0).toFixed(1)}/74åˆ†</div>
                            <div class="score-item">é‡‘èç©©å®š: ${(details.financial_stability || 0).toFixed(1)}/49åˆ†</div>
                            <div class="score-item">è²¡æ”¿ç‹€æ³: ${(details.fiscal_deficit || 0).toFixed(1)}/49åˆ†</div>
                            <div class="score-item">CPIç©©å®š: ${(details.cpi_stability || 0).toFixed(1)}/49åˆ†</div>
                        </div>
                        <div class="score-section" style="margin-bottom: 15px;">
                            <h5 style="color: #ffc107; margin-bottom: 10px;">ğŸŒŸ åœ‹å®¶ç‰¹è‰² (210åˆ†)</h5>
                            <div class="score-item">ç‰¹è‰²åŠ åˆ†: ${(details.country_bonus || 0).toFixed(1)}/210åˆ†</div>
                        </div>
                        <div class="score-section" style="margin-bottom: 15px;">
                            <h5 style="color: #28a745; margin-bottom: 10px;">ğŸ… ç›¸å°è¡¨ç¾çå‹µ</h5>
                            <div class="score-item">ç›¸å°çå‹µ: +${(details.relative_bonus || 0).toFixed(1)}åˆ†</div>
                        </div>
                        <div class="total-section" style="padding: 15px; background: #f8f9fa; border-radius: 6px; text-align: center; border: 2px solid #007bff;">
                            <strong style="font-size: 18px; color: #007bff;">
                                ç¸½åˆ†: ${(player.total_score || 0).toFixed(1)}/700åˆ† (${player.grade || 'F'}ç´š)
                            </strong>
                        </div>
                    </div>
                </div>
            `;
            
            console.log('âœ… è©³ç´°è©•åˆ†é¡¯ç¤ºå®Œæˆ');
        }

        function showFinalResults(finalScores) {
            // å‰µå»ºæœ€çµ‚çµæœå½ˆçª—
            const modal = document.createElement('div');
            modal.className = 'final-results-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2>ğŸ† æœ€çµ‚è©•åˆ†çµæœ</h2>
                    <div class="final-standings">
                        ${finalScores.map((player, index) => `
                            <div class="final-ranking ${index === 0 ? 'winner' : ''}">
                                <span class="position">${index + 1}</span>
                                <span class="flag">${player.country_flag}</span>
                                <span class="name">${player.player_name}</span>
                                <span class="score">${player.total_score.toFixed(1)}åˆ†</span>
                                <span class="grade grade-${player.grade}">${player.grade}ç´š</span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="modal-actions">
                        <button onclick="closeModal(this)" class="btn btn-primary">é—œé–‰</button>
                        <button onclick="location.reload()" class="btn btn-success">é‡æ–°é–‹å§‹</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function closeModal(button) {
            const modal = button.closest('.final-results-modal');
            if (modal) {
                document.body.removeChild(modal);
            }
        }

        // åœ¨ç¾æœ‰çš„åˆå§‹åŒ–å‡½æ•¸ä¸­ç¢ºä¿è©•åˆ†æŒ‰éˆ•å¯ç”¨
        document.addEventListener('DOMContentLoaded', function() {
            // ç¾æœ‰çš„åˆå§‹åŒ–ä»£ç¢¼...
            
            // ç¢ºä¿è©•åˆ†æŒ‰éˆ•åœ¨éŠæˆ²é–‹å§‹å¾Œå¯è¦‹
            console.log('ğŸ¯ è©•åˆ†ç³»çµ±åˆå§‹åŒ–å®Œæˆ');
        });
    </script>
</body>
</html>